<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:material="using:Material.Icons.Avalonia"
             mc:Ignorable="d"
             d:DesignWidth="400"
             d:DesignHeight="600"
             x:Class="MTM_WIP_Application_Avalonia.Controls.CollapsiblePanel"
             MinWidth="240"
             MinHeight="48">

  <!-- Include MTM Professional Style System -->
  <UserControl.Styles>
    <StyleInclude Source="avares://MTM_WIP_Application_Avalonia/Resources/Styles/StyleSystem.axaml"/>

    <!-- Manufacturing-Grade CollapsiblePanel Styles with ResolutionIndependentSizing -->

    <!-- Professional Header Panel using MTM HeaderPanel Style -->
    <Style Selector="Border.collapsible-header">
      <!-- Enhanced professional gradient background -->
      <Setter Property="Background">
        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
          <GradientStop Offset="0" Color="{DynamicResource ThemeV2.Color.Action.Primary.Light}"/>
          <GradientStop Offset="0.5" Color="{DynamicResource ThemeV2.Color.Action.Primary}"/>
          <GradientStop Offset="1" Color="{DynamicResource ThemeV2.Color.Action.Primary.Dark}"/>
        </LinearGradientBrush>
      </Setter>
      <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Action.Primary}"/>
      <Setter Property="BorderThickness" Value="2"/>
      <Setter Property="CornerRadius" Value="{StaticResource ThemeV2.CornerRadius.Large}"/>
      <!-- Professional drop shadow -->
      <Setter Property="Effect">
        <DropShadowEffect Color="{DynamicResource ThemeV2.Color.Action.Primary}"
                          BlurRadius="8"
                          OffsetX="0"
                          OffsetY="3"
                          Opacity="0.4"/>
      </Setter>
      <!-- Smooth transitions -->
      <Setter Property="Transitions">
        <Transitions>
          <BrushTransition Property="Background" Duration="0:0:0.25"/>
          <BrushTransition Property="BorderBrush" Duration="0:0:0.25"/>
        </Transitions>
      </Setter>
    </Style>

    <!-- Enhanced Header Hover State with Professional Visual Feedback -->
    <Style Selector="Border.collapsible-header:pointerover">
      <Setter Property="Background">
        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
          <GradientStop Offset="0" Color="{DynamicResource ThemeV2.Color.Action.Secondary.Light}"/>
          <GradientStop Offset="0.5" Color="{DynamicResource ThemeV2.Color.Action.Secondary}"/>
          <GradientStop Offset="1" Color="{DynamicResource ThemeV2.Color.Action.Secondary.Dark}"/>
        </LinearGradientBrush>
      </Setter>
      <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Action.Secondary}"/>
      <Setter Property="Effect">
        <DropShadowEffect Color="{DynamicResource ThemeV2.Color.Action.Secondary}"
                          BlurRadius="12"
                          OffsetX="0"
                          OffsetY="4"
                          Opacity="0.5"/>
      </Setter>
    </Style>

    <!-- Manufacturing-Grade Toggle Button using MTM Icon Button Style -->
    <Style Selector="Button.collapsible-toggle">
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="BorderThickness" Value="2"/>
      <Setter Property="BorderBrush" Value="Transparent"/>
      <Setter Property="CornerRadius" Value="{StaticResource ThemeV2.CornerRadius.Medium}"/>
      <Setter Property="Padding" Value="8"/>
      <!-- Manufacturing touch target size will be set via code-behind -->
      <Setter Property="HorizontalContentAlignment" Value="Center"/>
      <Setter Property="VerticalContentAlignment" Value="Center"/>
      <Setter Property="Cursor" Value="Hand"/>
      <!-- Professional transitions -->
      <Setter Property="Transitions">
        <Transitions>
          <DoubleTransition Property="Opacity" Duration="0:0:0.2"/>
          <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.25"/>
          <BrushTransition Property="Background" Duration="0:0:0.2"/>
          <BrushTransition Property="BorderBrush" Duration="0:0:0.2"/>
        </Transitions>
      </Setter>
    </Style>

    <Style Selector="Button.collapsible-toggle:pointerover">
      <Setter Property="Background" Value="{DynamicResource ThemeV2.Background.Hover}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Border.Hover}"/>
      <Setter Property="RenderTransform" Value="scale(1.1)"/>
    </Style>

    <Style Selector="Button.collapsible-toggle:pressed">
      <Setter Property="Background" Value="{DynamicResource ThemeV2.Background.Pressed}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Border.Focus}"/>
      <Setter Property="RenderTransform" Value="scale(0.95)"/>
    </Style>

    <!-- Professional Content Container using MTM Card Style -->
    <Style Selector="Border.collapsible-content">
      <Setter Property="Background" Value="{DynamicResource ThemeV2.Background.Card}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Border.Default}"/>
      <Setter Property="BorderThickness" Value="2,0,2,2"/>
      <Setter Property="CornerRadius" Value="0,0,8,8"/>
      <!-- Reduced padding for better content utilization -->
      <Setter Property="Padding" Value="{StaticResource ThemeV2.Spacing.Small}"/>
      <!-- Subtle content shadow -->
      <Setter Property="Effect">
        <DropShadowEffect Color="{DynamicResource ThemeV2.Color.Gray.300}"
                          BlurRadius="6"
                          OffsetX="0"
                          OffsetY="2"
                          Opacity="0.2"/>
      </Setter>
    </Style>

    <!-- Manufacturing-Grade Root Container using MTM Card Style -->
    <Style Selector="Border.collapsible-root">
      <Setter Property="Background" Value="{DynamicResource ThemeV2.Background.Card}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Border.Default}"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="{StaticResource ThemeV2.CornerRadius.Large}"/>
      <!-- Professional elevation shadow -->
      <Setter Property="Effect">
        <DropShadowEffect Color="{DynamicResource ThemeV2.Color.Gray.500}"
                          BlurRadius="16"
                          OffsetX="0"
                          OffsetY="8"
                          Opacity="0.25"/>
      </Setter>
      <!-- Smooth hover transitions -->
      <Setter Property="Transitions">
        <Transitions>
          <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.3"/>
        </Transitions>
      </Setter>
    </Style>

    <Style Selector="Border.collapsible-root:pointerover">
      <Setter Property="Effect">
        <DropShadowEffect Color="{DynamicResource ThemeV2.Color.Gray.500}"
                          BlurRadius="20"
                          OffsetX="0"
                          OffsetY="10"
                          Opacity="0.3"/>
      </Setter>
    </Style>

    <!-- Professional Material Icon styling -->
    <Style Selector="Button.collapsible-toggle material|MaterialIcon">
      <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Content.OnColor}"/>
      <!-- Icon size will be set via code-behind based on ResolutionIndependentSizing -->
    </Style>

    <Style Selector="Button.collapsible-toggle:pointerover material|MaterialIcon">
      <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Content.Primary}"/>
    </Style>

    <!-- Enhanced Header Text Styling -->
    <Style Selector="Border.collapsible-header TextBlock, Border.collapsible-header ContentPresenter">
      <Setter Property="TextElement.Foreground" Value="{DynamicResource ThemeV2.Content.OnColor}"/>
      <Setter Property="TextElement.FontWeight" Value="{StaticResource ThemeV2.Typography.Heading6.FontWeight}"/>
      <!-- Font size will be set via code-behind based on ResolutionIndependentSizing -->
    </Style>

  </UserControl.Styles>

  <!-- Manufacturing-Grade Professional Template with MTM Style System Integration -->
  <UserControl.Template>
    <ControlTemplate>
      <!-- Manufacturing-Grade Root Container with Professional MTM Styling -->
      <Border x:Name="RootContainer" Classes="collapsible-root">

        <!-- Dynamic Responsive Grid Layout (configured by code-behind with ResolutionIndependentSizing) -->
        <Grid x:Name="RootGrid">

          <!-- Professional Header Bar with MTM Manufacturing Gradient -->
          <Border x:Name="HeaderArea"
                  Classes="collapsible-header">

            <!-- Manufacturing-Grade Header Content Layout with Responsive Design -->
            <Grid x:Name="HeaderContentGrid">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
              </Grid.ColumnDefinitions>

              <!-- Manufacturing Touch Target Toggle Button with Professional Animation -->
              <Button x:Name="ToggleButton"
                      Grid.Column="0"
                      Classes="collapsible-toggle"
                      Click="OnToggleClick"
                      ToolTip.Tip="Expand/Collapse Panel">

                <!-- Professional Material Icon with Manufacturing Visual Feedback -->
                <material:MaterialIcon x:Name="ToggleIcon"
                                       Kind="ChevronRight"
                                       Foreground="{DynamicResource ThemeV2.Content.OnColor}"/>
              </Button>

              <!-- Professional Header Content Presenter with Enhanced Typography -->
              <ContentPresenter x:Name="HeaderPresenter"
                              Grid.Column="1"
                              Content="{TemplateBinding Header}"
                              VerticalAlignment="Center"
                              HorizontalAlignment="Left"
                              Margin="12,0,12,0"/>

            </Grid>
          </Border>

          <!-- Professional Content Container with MTM Card Styling -->
          <Border x:Name="ContentArea"
                  Classes="collapsible-content">
            <!-- Enhanced Content Presenter with Professional Typography -->
            <ContentPresenter x:Name="ContentPresenter"
                            Content="{TemplateBinding Content}"
                            TextElement.Foreground="{DynamicResource ThemeV2.Content.Primary}"/>
          </Border>

        </Grid>
      </Border>
    </ControlTemplate>
  </UserControl.Template>

</UserControl>
