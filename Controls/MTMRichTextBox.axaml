<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:material="using:Material.Icons.Avalonia"
             x:Class="MTM_WIP_Application_Avalonia.Controls.MTMRichTextBox"
             x:CompileBindings="False">

  <UserControl.Resources>
    <!-- MTM Color Scheme -->
    <SolidColorBrush x:Key="PrimaryBrush" Color="#FFD700"/>           <!-- Gold -->
    <SolidColorBrush x:Key="PrimaryDarkBrush" Color="#DAA520"/>       <!-- Dark Gold -->
    <SolidColorBrush x:Key="SecondaryBrush" Color="#F5F5DC"/>         <!-- Beige -->
    <SolidColorBrush x:Key="AccentBrush" Color="#4169E1"/>            <!-- Royal Blue -->
    <SolidColorBrush x:Key="BorderBrush" Color="#E0E0E0"/>            <!-- Light Gray -->
    <SolidColorBrush x:Key="ErrorBrush" Color="#DC143C"/>             <!-- Crimson -->
    <SolidColorBrush x:Key="SuccessBrush" Color="#228B22"/>           <!-- Forest Green -->
    <SolidColorBrush x:Key="ToolbarBrush" Color="#F8F9FA"/>           <!-- Light Gray -->
  </UserControl.Resources>

  <Grid RowDefinitions="Auto,Auto,*,Auto" Margin="0">
    <!-- Label -->
    <TextBlock Grid.Row="0" 
               Text="{Binding Label, FallbackValue='Rich Text Editor', TargetNullValue='Rich Text Editor'}"
               FontWeight="SemiBold"
               Foreground="#333"
               Margin="0,0,0,4"
               IsVisible="{Binding ShowLabel, FallbackValue=True}" />

    <!-- Toolbar -->
    <Border Grid.Row="1"
            Background="{StaticResource ToolbarBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="2,2,2,0"
            CornerRadius="8,8,0,0"
            Padding="8,4"
            IsVisible="{Binding ShowToolbar, FallbackValue=True}">
      
      <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto">
        <!-- Formatting Buttons -->
        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="4">
          <!-- Bold -->
          <ToggleButton x:Name="BoldButton"
                        Width="32" Height="28"
                        Background="Transparent"
                        BorderThickness="1"
                        BorderBrush="{StaticResource BorderBrush}"
                        CornerRadius="4"
                        IsChecked="{Binding IsBold, Mode=TwoWay, FallbackValue=False}"
                        Command="{Binding ToggleBoldCommand}"
                        ToolTip.Tip="Bold (Ctrl+B)">
            <material:MaterialIcon Kind="FormatBold" Width="16" Height="16" />
          </ToggleButton>

          <!-- Italic -->
          <ToggleButton x:Name="ItalicButton"
                        Width="32" Height="28"
                        Background="Transparent"
                        BorderThickness="1"
                        BorderBrush="{StaticResource BorderBrush}"
                        CornerRadius="4"
                        IsChecked="{Binding IsItalic, Mode=TwoWay, FallbackValue=False}"
                        Command="{Binding ToggleItalicCommand}"
                        ToolTip.Tip="Italic (Ctrl+I)">
            <material:MaterialIcon Kind="FormatItalic" Width="16" Height="16" />
          </ToggleButton>

          <!-- Underline -->
          <ToggleButton x:Name="UnderlineButton"
                        Width="32" Height="28"
                        Background="Transparent"
                        BorderThickness="1"
                        BorderBrush="{StaticResource BorderBrush}"
                        CornerRadius="4"
                        IsChecked="{Binding IsUnderline, Mode=TwoWay, FallbackValue=False}"
                        Command="{Binding ToggleUnderlineCommand}"
                        ToolTip.Tip="Underline (Ctrl+U)">
            <material:MaterialIcon Kind="FormatUnderline" Width="16" Height="16" />
          </ToggleButton>
        </StackPanel>

        <!-- Separator -->
        <Rectangle Grid.Column="1" 
                   Width="1" 
                   Height="20"
                   Fill="{StaticResource BorderBrush}"
                   Margin="8,0" />

        <!-- Alignment and Lists -->
        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4">
          <!-- Bulleted List -->
          <Button x:Name="BulletListButton"
                  Width="32" Height="28"
                  Background="Transparent"
                  BorderThickness="1"
                  BorderBrush="{StaticResource BorderBrush}"
                  CornerRadius="4"
                  Command="{Binding ToggleBulletListCommand}"
                  ToolTip.Tip="Bullet List">
            <material:MaterialIcon Kind="FormatListBulleted" Width="16" Height="16" />
          </Button>

          <!-- Numbered List -->
          <Button x:Name="NumberListButton"
                  Width="32" Height="28"
                  Background="Transparent"
                  BorderThickness="1"
                  BorderBrush="{StaticResource BorderBrush}"
                  CornerRadius="4"
                  Command="{Binding ToggleNumberListCommand}"
                  ToolTip.Tip="Numbered List">
            <material:MaterialIcon Kind="FormatListNumbered" Width="16" Height="16" />
          </Button>
        </StackPanel>

        <!-- Word Count -->
        <TextBlock Grid.Column="3"
                   Text="{Binding WordCountText, FallbackValue='Words: 0', TargetNullValue='Words: 0'}"
                   FontSize="11"
                   Foreground="#666"
                   VerticalAlignment="Center"
                   Margin="8,0"
                   IsVisible="{Binding ShowWordCount, FallbackValue=True}" />

        <!-- Status/Actions -->
        <StackPanel Grid.Column="4" Orientation="Horizontal" Spacing="4">
          <!-- Save Button -->
          <Button x:Name="SaveButton"
                  Width="32" Height="28"
                  Background="Transparent"
                  BorderThickness="1"
                  BorderBrush="{StaticResource BorderBrush}"
                  CornerRadius="4"
                  Command="{Binding SaveCommand}"
                  IsVisible="{Binding ShowSaveButton, FallbackValue=False}"
                  ToolTip.Tip="Save (Ctrl+S)">
            <material:MaterialIcon Kind="ContentSave" Width="16" Height="16" />
          </Button>

          <!-- Menu -->
          <Button x:Name="MenuButton"
                  Width="32" Height="28"
                  Background="Transparent"
                  BorderThickness="1"
                  BorderBrush="{StaticResource BorderBrush}"
                  CornerRadius="4"
                  ToolTip.Tip="More options">
            <material:MaterialIcon Kind="DotsVertical" Width="16" Height="16" />
            <Button.Flyout>
              <MenuFlyout>
                <MenuItem Header="Cut" Command="{Binding CutCommand}">
                  <MenuItem.Icon>
                    <material:MaterialIcon Kind="ContentCut" Width="16" Height="16" />
                  </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Copy" Command="{Binding CopyCommand}">
                  <MenuItem.Icon>
                    <material:MaterialIcon Kind="ContentCopy" Width="16" Height="16" />
                  </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Paste" Command="{Binding PasteCommand}">
                  <MenuItem.Icon>
                    <material:MaterialIcon Kind="ContentPaste" Width="16" Height="16" />
                  </MenuItem.Icon>
                </MenuItem>
                <Separator />
                <MenuItem Header="Select All" Command="{Binding SelectAllCommand}">
                  <MenuItem.Icon>
                    <material:MaterialIcon Kind="SelectAll" Width="16" Height="16" />
                  </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Clear" Command="{Binding ClearCommand}">
                  <MenuItem.Icon>
                    <material:MaterialIcon Kind="Close" Width="16" Height="16" />
                  </MenuItem.Icon>
                </MenuItem>
                <Separator />
                <MenuItem Header="Export to HTML" Command="{Binding ExportHtmlCommand}">
                  <MenuItem.Icon>
                    <material:MaterialIcon Kind="FileExport" Width="16" Height="16" />
                  </MenuItem.Icon>
                </MenuItem>
              </MenuFlyout>
            </Button.Flyout>
          </Button>
        </StackPanel>
      </Grid>
    </Border>

    <!-- RichTextBox Container -->
    <Border Grid.Row="2"
            x:Name="RichTextContainer"
            Background="White"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="2"
            CornerRadius="0,0,8,8"
            MinHeight="120"
            BoxShadow="0 2 4 0 #0F000000">
      
      <Grid ColumnDefinitions="Auto,*">
        <!-- Line Numbers (Optional) -->
        <Border Grid.Column="0"
                Background="#F8F9FA"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,1,0"
                Width="40"
                IsVisible="{Binding ShowLineNumbers, FallbackValue=False}">
          <ScrollViewer x:Name="LineNumberScroller"
                        VerticalScrollBarVisibility="Hidden"
                        HorizontalScrollBarVisibility="Hidden">
            <ItemsControl ItemsSource="{Binding LineNumbers}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding, FallbackValue='1', TargetNullValue='1'}" 
                            FontFamily="Consolas, Monaco, monospace"
                            FontSize="12"
                            Foreground="#666"
                            TextAlignment="Right"
                            Margin="4,2"
                            Height="16" />
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>
        </Border>

        <!-- Main Text Area -->
        <ScrollViewer Grid.Column="1"
                      x:Name="MainScroller"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Auto">
          
          <TextBox x:Name="PART_TextBox"
                   Text="{Binding Text, Mode=TwoWay, FallbackValue='', TargetNullValue=''}"
                   Watermark="{Binding PlaceholderText, FallbackValue='Enter text...', TargetNullValue='Enter text...'}"
                   Background="Transparent"
                   BorderThickness="0"
                   Padding="12"
                   AcceptsReturn="True"
                   AcceptsTab="True"
                   TextWrapping="Wrap"
                   FontFamily="{Binding FontFamily, FallbackValue='Segoe UI'}"
                   FontSize="{Binding FontSize, FallbackValue=14}"
                   IsReadOnly="{Binding IsReadOnly, FallbackValue=False}"
                   IsEnabled="{Binding IsEnabled, FallbackValue=True}"
                   ScrollViewer.VerticalScrollBarVisibility="Disabled"
                   ScrollViewer.HorizontalScrollBarVisibility="Disabled" />
        </ScrollViewer>
      </Grid>
    </Border>

    <!-- Status Bar -->
    <Border Grid.Row="3"
            Background="{StaticResource ToolbarBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="2,0,2,2"
            CornerRadius="0,0,8,8"
            Padding="8,4"
            IsVisible="{Binding ShowStatusBar, FallbackValue=True}">
      
      <Grid ColumnDefinitions="Auto,*,Auto,Auto">
        <!-- Character/Word Count -->
        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
          <TextBlock Text="{Binding CharacterCountText, FallbackValue='Characters: 0', TargetNullValue='Characters: 0'}"
                     FontSize="11"
                     Foreground="#666" />
          <TextBlock Text="{Binding WordCountText, FallbackValue='Words: 0', TargetNullValue='Words: 0'}"
                     FontSize="11"
                     Foreground="#666" />
        </StackPanel>

        <!-- Validation Message -->
        <TextBlock Grid.Column="1"
                   Text="{Binding ValidationMessage, FallbackValue='', TargetNullValue=''}"
                   Foreground="{StaticResource ErrorBrush}"
                   FontSize="11"
                   Margin="12,0"
                   IsVisible="{Binding HasValidationError, FallbackValue=False}" />

        <!-- Cursor Position -->
        <TextBlock Grid.Column="2"
                   Text="{Binding CursorPositionText, FallbackValue='Line: 1, Col: 1', TargetNullValue='Line: 1, Col: 1'}"
                   FontSize="11"
                   Foreground="#666"
                   Margin="0,0,12,0" />

        <!-- Status Icon -->
        <Border Grid.Column="3"
                Width="16"
                Height="16"
                IsVisible="{Binding ShowStatusIcon, FallbackValue=False}">
          <material:MaterialIcon Kind="{Binding StatusIconKind, FallbackValue=CheckCircle}"
                                Foreground="{Binding StatusIconColor, FallbackValue=Green}"
                                Width="14"
                                Height="14" />
        </Border>
      </Grid>
    </Border>
  </Grid>

  <!-- Styles for different states -->
  <UserControl.Styles>
    <!-- Focus state -->
    <Style Selector="Border#RichTextContainer:focus-within">
      <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
      <Setter Property="BoxShadow" Value="0 0 0 3 #33FFD700"/>
    </Style>
    
    <!-- Error state -->
    <Style Selector="Border#RichTextContainer.error">
      <Setter Property="BorderBrush" Value="{StaticResource ErrorBrush}"/>
      <Setter Property="BoxShadow" Value="0 0 0 3 #33DC143C"/>
    </Style>
    
    <!-- Success state -->
    <Style Selector="Border#RichTextContainer.success">
      <Setter Property="BorderBrush" Value="{StaticResource SuccessBrush}"/>
      <Setter Property="BoxShadow" Value="0 0 0 3 #33228B22"/>
    </Style>
    
    <!-- Disabled state -->
    <Style Selector="Border#RichTextContainer:disabled">
      <Setter Property="Opacity" Value="0.6"/>
      <Setter Property="Background" Value="#F8F8F8"/>
    </Style>

    <!-- Toolbar button hover states -->
    <Style Selector="ToggleButton:pointerover">
      <Setter Property="Background" Value="{StaticResource SecondaryBrush}"/>
    </Style>
    
    <Style Selector="Button:pointerover">
      <Setter Property="Background" Value="{StaticResource SecondaryBrush}"/>
    </Style>

    <!-- Active toolbar buttons -->
    <Style Selector="ToggleButton:checked">
      <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
      <Setter Property="Foreground" Value="White"/>
    </Style>
  </UserControl.Styles>
</UserControl>
