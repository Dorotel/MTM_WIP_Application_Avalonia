<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="MTM_WIP_Application_Avalonia.Controls.CustomDataGrid.CustomDataGrid"
             x:Name="CustomDataGridRoot">



  <!-- Main Grid Container with StyleSystem classes -->
  <Grid x:Name="MainGrid"
        Classes="ManufacturingDataGrid"
        RowDefinitions="Auto,*,Auto"
        ColumnDefinitions="*,Auto,Auto">

    <!-- Header Section with StyleSystem classes -->
    <Border Grid.Row="0" Grid.Column="0"
            Classes="DataGrid Header">

      <Grid x:Name="DynamicHeaderGrid">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="1.5*" />    <!-- Part ID -->
          <ColumnDefinition Width="1*" />      <!-- Operation -->
          <ColumnDefinition Width="1.2*" />    <!-- Location -->
          <ColumnDefinition Width="1*" />      <!-- Quantity -->
          <ColumnDefinition Width="80" />      <!-- Notes -->
        </Grid.ColumnDefinitions>

        <!-- Part ID Header -->
        <Border Grid.Column="0" Classes="DataGrid HeaderCell">
          <TextBlock Text="Part ID"
                     Classes="DataLabel"
                     ToolTip.Tip="Part identification number" />
        </Border>

        <!-- Operation Header -->
        <Border Grid.Column="1" Classes="DataGrid HeaderCell">
          <TextBlock Text="Operation"
                     Classes="DataLabel"
                     ToolTip.Tip="Manufacturing operation code" />
        </Border>

        <!-- Location Header -->
        <Border Grid.Column="2" Classes="DataGrid HeaderCell">
          <TextBlock Text="Location"
                     Classes="DataLabel"
                     ToolTip.Tip="Storage or processing location" />
        </Border>

        <!-- Quantity Header -->
        <Border Grid.Column="3" Classes="DataGrid HeaderCell">
          <TextBlock Text="Quantity"
                     Classes="DataLabel"
                     ToolTip.Tip="Current quantity count" />
        </Border>

        <!-- Notes Header -->
        <Border Grid.Column="4" Classes="DataGrid HeaderCell">
          <TextBlock Text="Notes"
                     Classes="DataLabel"
                     ToolTip.Tip="Additional item notes" />
        </Border>

      </Grid>
    </Border>

    <!-- Data Section with StyleSystem ScrollViewer -->
    <ScrollViewer Grid.Row="1" Grid.Column="0"
                  x:Name="DataScrollViewer"
                  Classes="DataGrid Content"
                  HorizontalScrollBarVisibility="Auto"
                  VerticalScrollBarVisibility="Auto">

      <!-- Data ListBox with Virtual Scrolling -->
      <ListBox x:Name="DataListBox"
               ItemsSource="{Binding ItemsSource, RelativeSource={RelativeSource AncestorType=UserControl}}"
               Background="Transparent"
               BorderThickness="0"
               SelectionMode="Multiple"
               ScrollViewer.HorizontalScrollBarVisibility="Disabled"
               ScrollViewer.VerticalScrollBarVisibility="Disabled">

        <ListBox.ItemsPanel>
          <ItemsPanelTemplate>
            <VirtualizingStackPanel Orientation="Vertical" />
          </ItemsPanelTemplate>
        </ListBox.ItemsPanel>

        <ListBox.ItemContainerTheme>
          <ControlTheme TargetType="ListBoxItem">
            <Setter Property="Padding" Value="0" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="VerticalContentAlignment" Value="Stretch" />
          </ControlTheme>
        </ListBox.ItemContainerTheme>

        <ListBox.ItemTemplate>
          <DataTemplate>
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1.5*" />    <!-- Part ID -->
                <ColumnDefinition Width="1*" />      <!-- Operation -->
                <ColumnDefinition Width="1.2*" />    <!-- Location -->
                <ColumnDefinition Width="1*" />      <!-- Quantity -->
                <ColumnDefinition Width="80" />      <!-- Notes -->
              </Grid.ColumnDefinitions>

              <!-- Conditional tooltip overlay for rows with notes -->
              <Border Grid.ColumnSpan="5"
                      Background="Transparent"
                      IsVisible="{Binding HasNotes}"
                      ToolTip.Tip="{Binding Notes}" />

              <!-- Part ID -->
              <Border Grid.Column="0" Classes="DataGrid Cell">
                <TextBlock Text="{Binding PartId}"
                           Classes="DataValue"
                           ToolTip.Tip="{Binding PartId}" />
              </Border>

              <!-- Operation -->
              <Border Grid.Column="1" Classes="DataGrid Cell">
                <TextBlock Text="{Binding Operation}"
                           Classes="DataValue"
                           ToolTip.Tip="{Binding Operation}" />
              </Border>

              <!-- Location -->
              <Border Grid.Column="2" Classes="DataGrid Cell">
                <TextBlock Text="{Binding Location}"
                           Classes="DataValue"
                           ToolTip.Tip="{Binding Location}" />
              </Border>

              <!-- Quantity -->
              <Border Grid.Column="3" Classes="DataGrid Cell">
                <TextBlock Text="{Binding Quantity, StringFormat=N0}"
                           Classes="DataNumeric"
                           ToolTip.Tip="{Binding Quantity, StringFormat='Quantity: {0:N0}'}" />
              </Border>

              <!-- Notes -->
              <Border Grid.Column="4" Classes="DataGrid Cell">
                <Grid>
                  <TextBlock Text="{Binding Notes}"
                             Classes="DataValue"
                             TextTrimming="CharacterEllipsis" />
                  <!-- Invisible overlay for tooltip when notes exist -->
                  <Border Background="Transparent"
                          IsVisible="{Binding HasNotes}"
                          ToolTip.Tip="{Binding Notes}" />
                </Grid>
              </Border>

            </Grid>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>
    </ScrollViewer>

    <!-- Action Buttons Row with StyleSystem classes -->
    <Border Grid.Row="2" Grid.Column="0"
            Classes="DataGrid Footer">

      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <!-- Selection Info -->
        <StackPanel Grid.Column="0"
                    Orientation="Horizontal"
                    Spacing="16"
                    VerticalAlignment="Center">

          <TextBlock x:Name="SelectionInfoText"
                     Text="No items selected"
                     Classes="Caption Secondary" />

          <Border Width="1" Height="16"
                  Background="{DynamicResource ThemeV2.Border.Default}" />

          <TextBlock x:Name="TotalQuantityText"
                     Text="Total Quantity: 0"
                     Classes="Caption Primary"
                     FontWeight="Medium"
                     ToolTip.Tip="Total quantity breakdown by Part ID and Operation" />

        </StackPanel>

        <!-- Action Buttons -->
        <StackPanel Grid.Column="1"
                    Orientation="Horizontal"
                    Spacing="8"
                    VerticalAlignment="Center">

          <!-- Edit Button -->
          <Button x:Name="EditButton"
                  Classes="Primary"
                  Content="âœï¸ Edit"
                  Padding="12,6"
                  FontSize="12"
                  Cursor="Hand"
                  IsEnabled="False"
                  Command="{Binding EditItemCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                  ToolTip.Tip="Edit selected inventory item (all fields including Part ID, Location, Operation, Quantity, Notes, etc.)" />

          <!-- Delete Button with StyleSystem classes -->
          <Button x:Name="DeleteButton"
                  Classes="Icon DataGrid Delete"
                  Content="ðŸ—‘ï¸ Delete"
                  Padding="12,6"
                  FontSize="12"
                  IsEnabled="False"
                  Command="{Binding DeleteItemCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                  ToolTip.Tip="Delete selected item(s)" />

        </StackPanel>

      </Grid>
    </Border>

    <!-- Column Management Panel (Phase 3 - Disabled) -->
    <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="1"
            x:Name="ColumnManagementContainer"
            Width="0"
            Background="{DynamicResource ThemeV2.Background.Surface}"
            BorderBrush="{DynamicResource ThemeV2.Border.Default}"
            BorderThickness="1,1,0,1"
            IsVisible="False">

      <!-- Column Management Panel will be implemented in Phase 3 -->
      <TextBlock Text="Column Management&#10;(Phase 3)"
                 Classes="Caption Secondary"
                 HorizontalAlignment="Center"
                 VerticalAlignment="Center"
                 Opacity="0.7" />
    </Border>

    <!-- Filter Panel (Phase 5 - Disabled) -->
    <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="2"
            x:Name="FilterPanelContainer"
            Width="0"
            Background="{DynamicResource ThemeV2.Background.Surface}"
            BorderBrush="{DynamicResource ThemeV2.Border.Default}"
            BorderThickness="1,1,1,1"
            CornerRadius="0,8,8,0"
            IsVisible="False">

      <!-- Filter Panel will be implemented in Phase 5 -->
      <TextBlock Text="Filter Panel&#10;(Phase 5)"
                 Classes="Caption Secondary"
                 HorizontalAlignment="Center"
                 VerticalAlignment="Center"
                 Opacity="0.7" />
    </Border>

  </Grid>

</UserControl>
