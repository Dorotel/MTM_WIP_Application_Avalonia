<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             x:Class="MTM_WIP_Application_Avalonia.Controls.CustomDataGrid.FilterPanel">
  
  <Border Background="{DynamicResource MTM_Shared_Logic.PanelBackgroundBrush}"
          BorderBrush="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}"
          BorderThickness="1"
          CornerRadius="6"
          Padding="16">
    
    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
      <StackPanel Spacing="16">
        
        <!-- Filter Panel Header -->
        <Grid ColumnDefinitions="*,Auto">
          <StackPanel Grid.Column="0" Spacing="4">
            <TextBlock Text="Advanced Filters &amp; Search" 
                       FontSize="16" 
                       FontWeight="Bold"
                       Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
            
            <TextBlock Text="{Binding FilterStatistics.FilterResultSummary}"
                       FontSize="11"
                       Foreground="{DynamicResource MTM_Shared_Logic.BodyText}" />
          </StackPanel>
          
          <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
            <Button Content="Clear All" 
                    Classes="secondary"
                    Command="{Binding ClearAllFiltersCommand}"
                    Padding="8,4"
                    FontSize="11" />
            
            <Button Content="âœ•" 
                    Classes="secondary"
                    Command="{Binding CloseFilterPanelCommand}"
                    Padding="6,4"
                    FontSize="12"
                    ToolTip.Tip="Close filter panel" />
          </StackPanel>
        </Grid>
        
        <!-- Global Search Section -->
        <Border Background="{DynamicResource MTM_Shared_Logic.ContentAreas}"
                BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="12">
          
          <StackPanel Spacing="8">
            <TextBlock Text="Global Search"
                       FontWeight="SemiBold"
                       FontSize="12"
                       Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
            
            <Grid ColumnDefinitions="*,Auto">
              <TextBox Grid.Column="0"
                       Text="{Binding GlobalSearchText, Mode=TwoWay}"
                       Watermark="Search across all columns..."
                       FontSize="12" />
              
              <CheckBox Grid.Column="1"
                        Content="Case sensitive"
                        IsChecked="{Binding IsGlobalSearchCaseSensitive, Mode=TwoWay}"
                        FontSize="11"
                        Margin="8,0,0,0" />
            </Grid>
            
            <TextBlock Text="{Binding GlobalSearchResultText}"
                       FontSize="10"
                       FontStyle="Italic"
                       Foreground="{DynamicResource MTM_Shared_Logic.TertiaryTextBrush}"
                       IsVisible="{Binding HasGlobalSearchText}" />
          </StackPanel>
        </Border>
        
        <!-- Column Filters Section -->
        <Border Background="{DynamicResource MTM_Shared_Logic.ContentAreas}"
                BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="12">
          
          <StackPanel Spacing="12">
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Grid.Column="0"
                         Text="Column Filters"
                         FontWeight="SemiBold"
                         FontSize="12"
                         Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
              
              <TextBlock Grid.Column="1"
                         Text="{Binding ActiveColumnFilterCountText}"
                         FontSize="11"
                         FontStyle="Italic"
                         Foreground="{DynamicResource MTM_Shared_Logic.TertiaryTextBrush}" />
            </Grid>
            
            <!-- Column Filter List -->
            <ItemsControl ItemsSource="{Binding ColumnFilters}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
                          BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}"
                          BorderThickness="1"
                          CornerRadius="3"
                          Padding="8"
                          Margin="0,0,0,8">
                    
                    <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*,Auto">
                      
                      <!-- Column Header Row -->
                      <CheckBox Grid.Row="0" Grid.Column="0"
                                IsChecked="{Binding IsActive, Mode=TwoWay}"
                                Margin="0,0,8,0" />
                      
                      <TextBlock Grid.Row="0" Grid.Column="1"
                                 Text="{Binding DisplayName}"
                                 FontWeight="SemiBold"
                                 FontSize="12"
                                 VerticalAlignment="Center"
                                 Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                      
                      <Button Grid.Row="0" Grid.Column="2"
                              Content="Clear"
                              Classes="secondary"
                              Command="{Binding $parent[UserControl].DataContext.ClearColumnFilterCommand}"
                              CommandParameter="{Binding}"
                              Padding="6,2"
                              FontSize="10"
                              IsVisible="{Binding IsActive}" />
                      
                      <!-- Filter Controls Row -->
                      <Grid Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3"
                            ColumnDefinitions="120,*"
                            Margin="0,8,0,0"
                            IsVisible="{Binding IsActive}">
                        
                        <!-- Operator Selection -->
                        <ComboBox Grid.Column="0"
                                  ItemsSource="{Binding AvailableOperators}"
                                  SelectedItem="{Binding FilterOperator, Mode=TwoWay}"
                                  FontSize="11" />
                        
                        <!-- Filter Value Controls -->
                        <Grid Grid.Column="1" Margin="8,0,0,0">
                          
                          <!-- Text Filter -->
                          <TextBox Text="{Binding FilterValue, Mode=TwoWay}"
                                   Watermark="Enter filter value..."
                                   FontSize="11"
                                   IsVisible="{Binding IsTextFilter}" />
                          
                          <!-- Numeric Filter -->
                          <NumericUpDown Value="{Binding FilterValue, Mode=TwoWay}"
                                         FontSize="11"
                                         IsVisible="{Binding IsNumericFilter}" />
                          
                          <!-- Date Filter -->
                          <DatePicker SelectedDate="{Binding FilterValue, Mode=TwoWay}"
                                      FontSize="11"
                                      IsVisible="{Binding IsDateFilter}" />
                          
                          <!-- Boolean Filter -->
                          <ComboBox FontSize="11"
                                    IsVisible="{Binding IsBooleanFilter}">
                            <ComboBoxItem Content="True" Tag="True" />
                            <ComboBoxItem Content="False" Tag="False" />
                          </ComboBox>
                          
                          <!-- Range Filter -->
                          <StackPanel Orientation="Horizontal" Spacing="8"
                                      IsVisible="{Binding IsRangeFilter}">
                            <TextBox Text="{Binding FilterValue, Mode=TwoWay}"
                                     Watermark="From..."
                                     Width="80"
                                     FontSize="11" />
                            <TextBlock Text="to" VerticalAlignment="Center" FontSize="11" />
                            <TextBox Text="{Binding FilterValueTo, Mode=TwoWay}"
                                     Watermark="To..."
                                     Width="80"
                                     FontSize="11" />
                          </StackPanel>
                          
                          <!-- List Filter -->
                          <StackPanel IsVisible="{Binding IsListFilter}" Spacing="4">
                            <TextBox x:Name="ListFilterTextBox"
                                     Watermark="Enter values separated by commas..."
                                     FontSize="11" />
                            <TextBlock Text="{Binding FilterValues.Count}"
                                       FontSize="10"
                                       FontStyle="Italic"
                                       Foreground="{DynamicResource MTM_Shared_Logic.TertiaryTextBrush}" />
                          </StackPanel>
                        </Grid>
                      </Grid>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
            
            <!-- No Filterable Columns Message -->
            <TextBlock Text="No filterable columns available in the current grid configuration."
                       FontStyle="Italic"
                       FontSize="11"
                       HorizontalAlignment="Center"
                       Foreground="{DynamicResource MTM_Shared_Logic.TertiaryTextBrush}"
                       IsVisible="{Binding HasNoFilterableColumns}" />
          </StackPanel>
        </Border>
        
        <!-- Filter Presets Section -->
        <Border Background="{DynamicResource MTM_Shared_Logic.ContentAreas}"
                BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="12">
          
          <StackPanel Spacing="8">
            <TextBlock Text="Filter Presets"
                       FontWeight="SemiBold"
                       FontSize="12"
                       Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
            
            <Grid ColumnDefinitions="*,Auto,Auto">
              <ComboBox Grid.Column="0"
                        ItemsSource="{Binding AvailablePresets}"
                        SelectedItem="{Binding SelectedPreset, Mode=TwoWay}"
                        PlaceholderText="Select a preset filter..."
                        FontSize="11">
                <ComboBox.ItemTemplate>
                  <DataTemplate>
                    <StackPanel>
                      <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" />
                      <TextBlock Text="{Binding Description}" 
                                 FontSize="10" 
                                 Foreground="{DynamicResource MTM_Shared_Logic.TertiaryTextBrush}" />
                    </StackPanel>
                  </DataTemplate>
                </ComboBox.ItemTemplate>
              </ComboBox>
              
              <Button Grid.Column="1"
                      Content="Apply"
                      Classes="primary"
                      Command="{Binding ApplyPresetCommand}"
                      Padding="12,4"
                      FontSize="11"
                      Margin="8,0,0,0" />
              
              <Button Grid.Column="2"
                      Content="Save Current"
                      Classes="secondary"
                      Command="{Binding SaveCurrentAsPresetCommand}"
                      Padding="12,4"
                      FontSize="11"
                      Margin="4,0,0,0"
                      ToolTip.Tip="Save current filter configuration as a new preset" />
            </Grid>
            
            <TextBlock Text="Quick presets for common inventory filtering scenarios"
                       FontSize="10"
                       FontStyle="Italic"
                       Foreground="{DynamicResource MTM_Shared_Logic.TertiaryTextBrush}" />
          </StackPanel>
        </Border>
        
        <!-- Advanced Options Section -->
        <Expander Header="Advanced Options" IsExpanded="False">
          <Border Background="{DynamicResource MTM_Shared_Logic.ContentAreas}"
                  BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}"
                  BorderThickness="1"
                  CornerRadius="4"
                  Padding="12"
                  Margin="0,8,0,0">
            
            <StackPanel Spacing="8">
              <CheckBox Content="Enable filter debouncing (reduce flicker during typing)"
                        IsChecked="{Binding EnableFilterDebouncing, Mode=TwoWay}"
                        FontSize="11" />
              
              <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock Text="Debounce delay:"
                           VerticalAlignment="Center"
                           FontSize="11" />
                <NumericUpDown Value="{Binding FilterDebounceDelayMs, Mode=TwoWay}"
                               Minimum="100"
                               Maximum="2000"
                               Increment="100"
                               Width="80"
                               FontSize="11" />
                <TextBlock Text="ms"
                           VerticalAlignment="Center"
                           FontSize="11" />
              </StackPanel>
              
              <CheckBox Content="Auto-clear filters when changing grid data"
                        IsChecked="{Binding AutoClearFiltersOnDataChange, Mode=TwoWay}"
                        FontSize="11" />
              
              <CheckBox Content="Show filter tooltips and help text"
                        IsChecked="{Binding ShowFilterTooltips, Mode=TwoWay}"
                        FontSize="11" />
            </StackPanel>
          </Border>
        </Expander>
      </StackPanel>
    </ScrollViewer>
  </Border>
</UserControl>