<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
             x:Class="MTM_WIP_Application_Avalonia.Controls.CustomDataGrid.TransferCustomDataGrid"
             x:Name="TransferCustomDataGridRoot">



  <!-- Main Grid Container -->
  <Grid x:Name="MainGrid"
        Classes="ManufacturingDataGrid"
        RowDefinitions="Auto,*,Auto"
        ColumnDefinitions="*,Auto,Auto">

    <!-- Header Section -->
    <Border Grid.Row="0" Grid.Column="0"
            Classes="DataGrid Header">

      <Grid x:Name="DynamicHeaderGrid">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="1.2*" />    <!-- Part ID -->
          <ColumnDefinition Width="0.8*" />    <!-- Operation -->
          <ColumnDefinition Width="1*" />      <!-- From Location -->
          <ColumnDefinition Width="40" />      <!-- Transfer Arrow -->
          <ColumnDefinition Width="1*" />      <!-- To Location -->
          <ColumnDefinition Width="0.8*" />    <!-- Available Qty -->
          <ColumnDefinition Width="0.8*" />    <!-- Transfer Qty -->
          <ColumnDefinition Width="80" />      <!-- Notes -->
        </Grid.ColumnDefinitions>

        <!-- Part ID Header -->
        <Border Grid.Column="0" Classes="DataGrid HeaderCell">
          <TextBlock Text="Part ID" Classes="DataLabel" />
        </Border>

        <!-- Operation Header -->
        <Border Grid.Column="1" Classes="DataGrid HeaderCell">
          <TextBlock Text="Operation" Classes="DataLabel" />
        </Border>

        <!-- From Location Header -->
        <Border Grid.Column="2" Classes="DataGrid HeaderCell">
          <TextBlock Text="From Location" Classes="DataLabel" />
        </Border>

        <!-- Transfer Arrow Header -->
        <Border Grid.Column="3" Classes="DataGrid TransferArrowHeader">
          <TextBlock Text="➜" Classes="TransferIndicator" />
        </Border>

        <!-- To Location Header -->
        <Border Grid.Column="4" Classes="DataGrid HeaderCell">
          <TextBlock Text="To Location" Classes="DataLabel" />
        </Border>

        <!-- Available Quantity Header -->
        <Border Grid.Column="5" Classes="DataGrid HeaderCell">
          <TextBlock Text="Available" Classes="DataLabel" />
        </Border>

        <!-- Transfer Quantity Header -->
        <Border Grid.Column="6" Classes="DataGrid HeaderCell">
          <TextBlock Text="Transfer" Classes="DataLabel" />
        </Border>

        <!-- Notes Header -->
        <Border Grid.Column="7" Classes="DataGrid HeaderCell">
          <TextBlock Text="Notes" Classes="DataLabel" />
        </Border>

      </Grid>
    </Border>

  <!-- Data Section with ScrollViewer (outer view controls scrolling; disable inner vertical scroll) -->
  <ScrollViewer Grid.Row="1" Grid.Column="0"
                  x:Name="DataScrollViewer"
                  Classes="DataGrid Content"
                  HorizontalScrollBarVisibility="Auto"
                  VerticalScrollBarVisibility="Disabled">

      <!-- Container Grid for Data and Nothing Found Panel -->
      <Grid>

        <!-- Data ListBox with Virtual Scrolling -->
        <ListBox x:Name="DataListBox"
                 ItemsSource="{Binding ItemsSource, RelativeSource={RelativeSource AncestorType=UserControl}}"
                 Background="Transparent"
                 BorderThickness="0"
                 SelectionMode="Multiple"
                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                 ScrollViewer.VerticalScrollBarVisibility="Disabled">

          <ListBox.ItemsPanel>
            <ItemsPanelTemplate>
              <VirtualizingStackPanel Orientation="Vertical" />
            </ItemsPanelTemplate>
          </ListBox.ItemsPanel>

          <ListBox.ItemContainerTheme>
            <ControlTheme TargetType="ListBoxItem">
              <Setter Property="Padding" Value="0" />
              <Setter Property="Margin" Value="0" />
              <Setter Property="Background" Value="Transparent" />
              <Setter Property="BorderThickness" Value="0" />
              <Setter Property="HorizontalContentAlignment" Value="Stretch" />
              <Setter Property="VerticalContentAlignment" Value="Stretch" />
            </ControlTheme>
          </ListBox.ItemContainerTheme>

          <ListBox.ItemTemplate>
            <DataTemplate>
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="1.2*" />    <!-- Part ID -->
                  <ColumnDefinition Width="0.8*" />    <!-- Operation -->
                  <ColumnDefinition Width="1*" />      <!-- From Location -->
                  <ColumnDefinition Width="40" />      <!-- Transfer Arrow -->
                  <ColumnDefinition Width="1*" />      <!-- To Location -->
                  <ColumnDefinition Width="0.8*" />    <!-- Available Qty -->
                  <ColumnDefinition Width="0.8*" />    <!-- Transfer Qty -->
                  <ColumnDefinition Width="80" />      <!-- Notes -->
                </Grid.ColumnDefinitions>

                <!-- Conditional tooltip overlay for rows with notes -->
                <Border Grid.ColumnSpan="8"
                        Background="Transparent"
                        IsVisible="{Binding HasNotes}"
                        ToolTip.Tip="{Binding Notes}" />

                <!-- Part ID -->
                <Border Grid.Column="0" Classes="DataGrid Cell">
                  <TextBlock Text="{Binding PartId}"
                             Classes="DataValue"
                             ToolTip.Tip="{Binding PartId}" />
                </Border>

                <!-- Operation -->
                <Border Grid.Column="1" Classes="DataGrid Cell">
                  <TextBlock Text="{Binding Operation}"
                             Classes="DataValue"
                             ToolTip.Tip="{Binding Operation}" />
                </Border>

                <!-- From Location -->
                <Border Grid.Column="2" Classes="DataGrid Cell">
                  <TextBlock Text="{Binding FromLocation}"
                             Classes="DataValue"
                             ToolTip.Tip="{Binding FromLocation}" />
                </Border>

                <!-- Transfer Arrow -->
                <Border Grid.Column="3" Classes="DataGrid TransferArrow">
                  <TextBlock Text="➜"
                             Classes="TransferIndicator"
                             ToolTip.Tip="{Binding FromLocation, StringFormat='Transfer from {0}'} → {Binding ToLocation, StringFormat='to {0}'}" />
                </Border>

                <!-- To Location -->
                <Border Grid.Column="4" Classes="DataGrid Cell">
                  <TextBlock Text="{Binding ToLocation}"
                             Classes="DataValue"
                             ToolTip.Tip="{Binding ToLocation}" />
                </Border>

                <!-- Available Quantity -->
                <Border Grid.Column="5" Classes="DataGrid Cell">
                  <TextBlock Text="{Binding AvailableQuantity, StringFormat=N0}"
                             Classes="DataNumeric"
                             ToolTip.Tip="{Binding AvailableQuantity, StringFormat='Available: {0:N0}'}" />
                </Border>

                <!-- Transfer Quantity -->
                <Border Grid.Column="6" Classes="DataGrid Cell">
                  <TextBlock Text="{Binding TransferQuantity, StringFormat=N0}"
                             Classes="DataNumeric"
                             ToolTip.Tip="{Binding TransferQuantity, StringFormat='Transfer Qty: {0:N0}'}" />
                </Border>

                <!-- Notes -->
                <Border Grid.Column="7" Classes="DataGrid Cell">
                  <Grid>
                    <TextBlock Text="{Binding Notes}"
                               Classes="DataValue" />
                    <!-- Invisible overlay for tooltip when notes exist -->
                    <Border Background="Transparent"
                            IsVisible="{Binding HasNotes}"
                            ToolTip.Tip="{Binding Notes}" />
                  </Grid>
                </Border>

              </Grid>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>

  <!-- Nothing Found Panel (disabled here; outer view manages empty-state UI) -->
  <Border x:Name="NothingFoundPanel"
    Background="{DynamicResource ThemeV2.Background.Card}"
    BorderThickness="0"
    Padding="64"
    MinHeight="120"
    IsVisible="False">

          <StackPanel HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Spacing="16">

            <!-- Transfer Icon -->
            <Border Background="{DynamicResource ThemeV2.Background.Surface}"
                    CornerRadius="32"
                    Width="64"
                    Height="64"
                    HorizontalAlignment="Center">
              <TextBlock Text="➜" Classes="TransferIndicator" />
            </Border>

            <!-- Nothing Found Message -->
            <TextBlock Text="No transfer candidates found"
                       Classes="Heading3" />

            <!-- Help Text -->
            <TextBlock Text="Enter search criteria in the transfer form above and click Search to find items available for transfer."
                       Classes="Body"
                       TextWrapping="Wrap"
                       MaxWidth="400" />

            <!-- Additional Instructions -->
            <Border Background="{DynamicResource ThemeV2.Background.Surface}"
                    BorderBrush="{DynamicResource ThemeV2.Border.Default}"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="16,12"
                    Margin="0,8,0,0">
              <StackPanel Spacing="6">
                <TextBlock Text="Search Tips:" Classes="Caption" />
                <TextBlock Text="• Enter Part ID to find all locations for that part" Classes="Caption" />
                <TextBlock Text="• Add Operation number to filter by specific operation" Classes="Caption" />
                <TextBlock Text="• Select destination location before transferring" Classes="Caption" />
              </StackPanel>
            </Border>

          </StackPanel>
        </Border>

      </Grid>
    </ScrollViewer>

    <!-- Action Buttons Row -->
    <Border Grid.Row="2" Grid.Column="0"
            Classes="DataGrid Footer">

      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <!-- Selection Info -->
        <StackPanel Grid.Column="0"
                    Orientation="Horizontal"
                    Spacing="16"
                    VerticalAlignment="Center">

          <TextBlock x:Name="SelectionInfoText"
                     Text="No items selected for transfer"
                     Classes="Caption" />

          <Border Width="1" Height="16" Background="{DynamicResource ThemeV2.Border.Default}" />

          <TextBlock x:Name="TotalTransferQuantityText"
                     Text="Total Transfer Quantity: 0"
                     Classes="Caption"
                     ToolTip.Tip="Total quantity planned for transfer by Part ID and Operation" />

        </StackPanel>

        <!-- Action Buttons -->
        <StackPanel Grid.Column="1"
                    Orientation="Horizontal"
                    Spacing="8"
                    VerticalAlignment="Center">

          <!-- Edit Transfer Button -->
          <Button x:Name="EditTransferButton"
                  Content="✏️ Edit"
                  Classes="Icon DataGrid Edit"
                  IsEnabled="False"
                  Command="{Binding EditTransferCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                  ToolTip.Tip="Edit selected transfer item (modify destination location, transfer quantity, notes, etc.)" />

          <!-- Execute Transfer Button -->
          <Button x:Name="ExecuteTransferButton"
                  Content="➜ Transfer"
                  Classes="Icon DataGrid Transfer"
                  IsEnabled="False"
                  Command="{Binding ExecuteTransferCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                  ToolTip.Tip="Execute transfer for selected item(s)" />

        </StackPanel>

      </Grid>
    </Border>

    <!-- Column Management Panel (Phase 3 - Disabled) -->
    <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="1"
            x:Name="ColumnManagementContainer"
            Width="0"
            Background="{DynamicResource ThemeV2.Background.Surface}"
            BorderBrush="{DynamicResource ThemeV2.Border.Default}"
            BorderThickness="1,1,0,1"
            IsVisible="False">

      <!-- Column Management Panel will be implemented in Phase 3 -->
      <TextBlock Text="Column Management\\n(Phase 3)"
                 Classes="Caption"
                 HorizontalAlignment="Center"
                 VerticalAlignment="Center"
                 Opacity="0.7" />
    </Border>

    <!-- Filter Panel (Phase 5 - Disabled) -->
    <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="2"
            x:Name="FilterPanelContainer"
            Width="0"
            Background="{DynamicResource ThemeV2.Background.Surface}"
            BorderBrush="{DynamicResource ThemeV2.Border.Default}"
            BorderThickness="1,1,1,1"
            CornerRadius="0,8,8,0"
            IsVisible="False">

      <!-- Filter Panel will be implemented in Phase 5 -->
      <TextBlock Text="Filter Panel\\n(Phase 5)"
                 Classes="Caption"
                 HorizontalAlignment="Center"
                 VerticalAlignment="Center"
                 Opacity="0.7" />
    </Border>

  </Grid>

</UserControl>
