<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:material="using:Material.Icons.Avalonia"
             mc:Ignorable="d"
             d:DesignWidth="400"
             d:DesignHeight="600"
             x:Class="MTM_WIP_Application_Avalonia.Controls.CollapsiblePanel">

  <UserControl.Resources>
    <!-- Use theme colors instead of hardcoded MTM colors -->
    <!-- All colors now reference theme resources -->
  </UserControl.Resources>

  <!-- Use explicit template to ensure proper initialization -->
  <UserControl.Template>
    <ControlTemplate>
      <!-- Empty grid that gets configured dynamically by code -->
      <Grid x:Name="RootGrid">
        
        <!-- Header Bar (position determined by HeaderPosition property) -->
        <Border x:Name="HeaderArea"
                Background="{DynamicResource MTM_Shared_Logic.PrimaryAction}"
                BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}"
                MinWidth="40"
                MinHeight="40">
          
          <!-- Simple grid for toggle button only -->
          <Grid x:Name="HeaderContentGrid">
            
            <!-- Toggle Button - positioned dynamically by code -->
            <Button x:Name="ToggleButton"
                    Background="Transparent"
                    BorderThickness="0"
                    Width="20"
                    Height="20"
                    Click="OnToggleClick"
                    Cursor="Hand">
              <material:MaterialIcon x:Name="ToggleIcon"
                                     Kind="ChevronRight"
                                     Width="12"
                                     Height="12"
                                     Foreground="{DynamicResource MTM_Shared_Logic.TextonDark}"/>
            </Button>
            
          </Grid>
        </Border>

        <!-- Content Area (position determined by HeaderPosition property) -->
        <Border x:Name="ContentArea"
                Background="{DynamicResource MTM_Shared_Logic.ContentAreas}"
                BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}"
                Padding="16">
          <ContentPresenter x:Name="ContentPresenter" Content="{TemplateBinding Content}"/>
        </Border>

      </Grid>
    </ControlTemplate>
  </UserControl.Template>

</UserControl>
