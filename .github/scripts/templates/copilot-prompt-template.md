---
name: Copilot Prompt Template
description: 'Comprehensive development prompt template for MTM feature continuation'
applies_to: 'development/*'
development_context: true
template_type: 'copilot-prompt'
quality_gate: 'development'
---

# Copilot Continuation Prompt Template

> **Generated by MTM Audit System** - Version 1.0  
> **Target Branch**: {BRANCH-NAME}  
> **Feature**: {FEATURE-NAME}  
> **Gap Report Date**: {DATE-TIME}

## Context Summary

You are continuing development on **{FEATURE-NAME}** in an established .NET 8 Avalonia MVVM application. This session builds on previous work with identified implementation gaps.

**Implementation Plan**: `{PLAN-PATH}`  
**Current Progress**: {X}% complete  
**Critical Gaps**: {X} items requiring immediate attention  
**MTM Pattern Compliance**: {X}% compliant

---

## üéØ Immediate Focus Areas (Critical Priority)

Based on gap analysis, address these blocking issues first:

{CRITICAL-GAPS-LIST}

### 1. {CRITICAL-ISSUE-1}

**Impact**: {IMPACT-DESCRIPTION}  
**Files Affected**: `{FILE-LIST}`  
**Required Pattern**: {MTM-PATTERN}  
**Estimated Effort**: {X} hours

```csharp
// Expected implementation pattern:
{CODE-EXAMPLE-IF-APPLICABLE}
```

### 2. {CRITICAL-ISSUE-2}

**Impact**: {IMPACT-DESCRIPTION}  
**Files Affected**: `{FILE-LIST}`  
**Required Pattern**: {MTM-PATTERN}  
**Estimated Effort**: {X} hours

---

## üèóÔ∏è MTM Architecture Requirements (MUST FOLLOW)

### Core Technology Stack (.NET 8 + Avalonia 11.3.4)

- **.NET 8**: `<TargetFramework>net8.0</TargetFramework>` with C# 12 features
- **Avalonia UI 11.3.4**: Cross-platform UI framework (NOT WPF)
- **MVVM Community Toolkit 8.3.2**: Source generators for ViewModels (NO ReactiveUI)
- **MySQL 9.4.0**: Database with stored procedures ONLY
- **Microsoft Extensions 9.0.8**: Dependency injection, logging, configuration

### ViewModels (MVVM Community Toolkit 8.3.2)

```csharp
[ObservableObject]
public partial class {FEATURE-NAME}ViewModel : BaseViewModel
{
    // Observable properties (private fields with source generators)
    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(CanExecuteCommand))]
    private string propertyName = string.Empty;
    
    [ObservableProperty]
    private bool isLoading;
    
    // Commands with CanExecute logic
    [RelayCommand(CanExecute = nameof(CanExecuteCommand))]
    private async Task ExecuteCommandAsync()
    {
        IsLoading = true;
        try
        {
            await _service.PerformOperationAsync(PropertyName);
        }
        catch (Exception ex)
        {
            await Services.ErrorHandling.HandleErrorAsync(ex, "Operation context");
        }
        finally
        {
            IsLoading = false;
        }
    }
    
    private bool CanExecuteCommand => !IsLoading && !string.IsNullOrWhiteSpace(PropertyName);
}
```

### Database Access (Stored Procedures ONLY)

```csharp
// Required database service pattern:
public class {SERVICE-NAME}Service : I{SERVICE-NAME}Service
{
    private readonly IDatabaseService _databaseService;
    
    public async Task<ServiceResult<List<ItemModel>>> GetDataAsync()
    {
        var parameters = new MySqlParameter[]
        {
            new("p_Parameter1", value1),
            new("p_Parameter2", value2)
        };
        
        var result = await _databaseService.ExecuteStoredProcedureAsync(
            "{stored_procedure_name}", parameters);
            
        if (result.IsSuccess)
        {
            var items = ProcessDataTable(result.Data);
            return ServiceResult<List<ItemModel>>.Success(items);
        }
        
        return ServiceResult<List<ItemModel>>.Failure(result.Message);
    }
}
```

### AXAML Syntax (Avalonia 11.3.4 - NOT WPF)

```xml
<!-- REQUIRED: Avalonia namespace -->
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="MTM_WIP_Application_Avalonia.Views.{FEATURE-NAME}View">

    <!-- REQUIRED: x:Name (NEVER Name) -->
    <Grid x:Name="MainGrid" RowDefinitions="Auto,*,Auto">
    
        <!-- REQUIRED: DynamicResource for all theme colors -->
        <Border Background="{DynamicResource MTM_Shared_Logic.BackgroundColor}"
                BorderBrush="{DynamicResource MTM_Shared_Logic.BorderColor}">
                
            <!-- Use TextBlock (not Label) for text -->
            <TextBlock Text="{Binding DisplayText}" 
                      Foreground="{DynamicResource MTM_Shared_Logic.ForegroundColor}" />
        </Border>
    </Grid>
</UserControl>
```

### Service Registration (Required DI Pattern)

```csharp
// In ServiceCollectionExtensions.cs
public static IServiceCollection AddMTMServices(this IServiceCollection services, IConfiguration configuration)
{
    // Core Services (Singleton)
    services.TryAddSingleton<IConfigurationService, ConfigurationService>();
    services.TryAddSingleton<IThemeService, ThemeService>();
    services.TryAddSingleton<INavigationService, NavigationService>();
    
    // Data Services (Scoped)
    services.TryAddScoped<IDatabaseService, DatabaseService>();
    services.TryAddScoped<I{SERVICE-NAME}Service, {SERVICE-NAME}Service>();
    
    // ViewModels (Transient)
    services.TryAddTransient<{FEATURE-NAME}ViewModel>();
    
    return services;
}
```

### Error Handling (Centralized)

```csharp
// ALWAYS use centralized error handling
try
{
    await SomeOperation();
}
catch (Exception ex)
{
    await Services.ErrorHandling.HandleErrorAsync(ex, "{Operation-Context}");
    // Error is logged to database and shown to user
}
```

### Current Service Architecture

**24 Services in Services/ folder:**

- Configuration.cs, Database.cs, ErrorHandling.cs
- MasterDataService.cs, InventoryEditingService.cs, RemoveService.cs
- ThemeService.cs, Navigation.cs, QuickButtons.cs
- SettingsService.cs, SettingsPanelStateManager.cs
- And 13 more services following MTM patterns

---

## üîÑ Current Implementation Status

### ‚úÖ Completed Components

{COMPLETED-FILES-LIST}

### üîÑ Partially Implemented (Needs Completion)

{PARTIAL-FILES-LIST}

### ‚ùå Missing Required Files

{MISSING-FILES-LIST}

---

## üìã Implementation Priority Order

Execute in this specific order to resolve dependencies:

### Phase 1: Foundation (Critical - Complete First)

1. **{PRIORITY-1-TASK}**
   - **Why First**: {DEPENDENCY-REASON}
   - **Files**: {FILE-LIST}
   - **Pattern**: {REQUIRED-PATTERN}

2. **{PRIORITY-2-TASK}**
   - **Why Second**: {DEPENDENCY-REASON}
   - **Files**: {FILE-LIST}
   - **Pattern**: {REQUIRED-PATTERN}

### Phase 2: Core Implementation

1. **{PRIORITY-3-TASK}**
   - **Dependencies**: Requires Phase 1 completion
   - **Files**: {FILE-LIST}
   - **Pattern**: {REQUIRED-PATTERN}

2. **{PRIORITY-4-TASK}**
   - **Dependencies**: Requires Phase 1 completion
   - **Files**: {FILE-LIST}
   - **Pattern**: {REQUIRED-PATTERN}

### Phase 3: Integration & Polish

1. **{PRIORITY-5-TASK}**
   - **Dependencies**: Requires Phases 1-2 completion
   - **Files**: {FILE-LIST}
   - **Pattern**: {REQUIRED-PATTERN}

---

## üö® Critical Compliance Checks

Before implementing any code, verify:

### MVVM Community Toolkit Compliance

- [ ] NO ReactiveUI patterns (completely removed from codebase)
- [ ] Use `[ObservableProperty]` for all bindable properties  
- [ ] Use `[RelayCommand]` for all command implementations
- [ ] Inherit from `BaseViewModel` class

### Avalonia AXAML Compliance  

- [ ] Use `x:Name` instead of `Name` on all Grid definitions
- [ ] Use correct Avalonia namespace: `xmlns="https://github.com/avaloniaui"`
- [ ] Follow InventoryTabView grid pattern for all tab views: `RowDefinitions="*,Auto"`
- [ ] ScrollViewer as root element to prevent overflow

### Service Layer Compliance

- [ ] Use dependency injection via constructor parameters
- [ ] Register services in `ServiceCollectionExtensions.cs`
- [ ] Follow single-category service consolidation pattern
- [ ] Implement proper disposal if needed

### Database Compliance  

- [ ] Use stored procedures exclusively via `Helper_Database_StoredProcedure.ExecuteDataTableWithStatus()`
- [ ] Never use direct SQL queries or string concatenation
- [ ] Return empty collections on database failures (no fallback data)
- [ ] Use correct column names from database schema

---

## üí° Code Examples for Current Context

### Required ViewModel Pattern

```csharp
[ObservableObject]
public partial class {VIEWMODEL-NAME}ViewModel : BaseViewModel
{
  [ObservableProperty]
  private {PROPERTY-TYPE} {propertyName} = {defaultValue};

  [RelayCommand]
  private async Task {CommandName}Async()
  {
    try
    {
      // Implementation here
    }
    catch (Exception ex)
    {
      await Services.ErrorHandling.HandleErrorAsync(ex, "{CONTEXT}");
    }
  }

  public {VIEWMODEL-NAME}ViewModel(ILogger<{VIEWMODEL-NAME}ViewModel> logger, I{SERVICE-NAME}Service service)
    : base(logger)
  {
    ArgumentNullException.ThrowIfNull(logger);
    ArgumentNullException.ThrowIfNull(service);
    _service = service;
  }
}
```

### Required Service Implementation Pattern

```csharp
public class {SERVICE-NAME}Service : I{SERVICE-NAME}Service
{
  private readonly ILogger<{SERVICE-NAME}Service> _logger;
  private readonly IConfigurationService _configurationService;

  public {SERVICE-NAME}Service(
    ILogger<{SERVICE-NAME}Service> logger,
    IConfigurationService configurationService)
  {
    ArgumentNullException.ThrowIfNull(logger);
    ArgumentNullException.ThrowIfNull(configurationService);
    
    _logger = logger;
    _configurationService = configurationService;
  }

  public async Task<{RETURN-TYPE}> {METHOD-NAME}Async({PARAMETERS})
  {
    try
    {
      _logger.LogInformation("Starting {MethodName} for {Context}", nameof({METHOD-NAME}), {context});
      
      // Implementation using stored procedures only
      var parameters = new Dictionary<string, object>
      {
        ["p_{PARAM}"] = {paramValue}
      };

      var result = await Helper_Database_StoredProcedure.ExecuteDataTableWithStatus(
        await _configurationService.GetConnectionStringAsync(),
        "{STORED-PROCEDURE-NAME}",
        parameters
      );

      if (result.Status == 1)
      {
        // Process successful result
        return ProcessResult(result.Data);
      }
      else
      {
        await Services.ErrorHandling.HandleErrorAsync(
          new InvalidOperationException($"Database operation failed: {result.Message}"),
          $"{METHOD-NAME} database operation"
        );
        return default({RETURN-TYPE});
      }
    }
    catch (Exception ex)
    {
      await Services.ErrorHandling.HandleErrorAsync(ex, nameof({METHOD-NAME}));
      return default({RETURN-TYPE});
    }
  }
}
```

### Required AXAML Layout Pattern

```xml
<UserControl xmlns="https://github.com/avaloniaui"
       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
       xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels.{NAMESPACE}"
       x:Class="MTM_WIP_Application_Avalonia.Views.{VIEW-NAME}">

  <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
    <Grid x:Name="MainContainer" RowDefinitions="*,Auto" MinWidth="600" MinHeight="400" Margin="8">
      <!-- Content Border -->
      <Border Grid.Row="0" 
          Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
          BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}" 
          BorderThickness="1" 
          CornerRadius="8" 
          Padding="16" 
          Margin="0,0,0,8">
        
        <!-- Form content with structured layout -->
        <Grid x:Name="ContentGrid" RowDefinitions="Auto,*">
          <!-- Header -->
          <Border Grid.Row="0" 
              Background="{DynamicResource MTM_Shared_Logic.PrimaryBrush}" 
              CornerRadius="8,8,0,0" 
              Padding="16,8"
              Margin="0,0,0,16">
            <TextBlock Text="{TITLE}" 
                   Foreground="White" 
                   FontWeight="Bold" 
                   FontSize="16" />
          </Border>
          
          <!-- Main content area -->
          <StackPanel Grid.Row="1" Spacing="16">
            <!-- Form fields here -->
          </StackPanel>
        </Grid>
      </Border>
      
      <!-- Action buttons panel -->
      <Border Grid.Row="1" 
          Background="{DynamicResource MTM_Shared_Logic.PanelBackgroundBrush}"
          Padding="16,8">
        <StackPanel Orientation="Horizontal" 
              HorizontalAlignment="Right" 
              Spacing="8">
          <!-- Action buttons here -->
          <Button Content="Cancel" 
              Command="{Binding CancelCommand}"
              Background="{DynamicResource MTM_Shared_Logic.SecondaryBrush}" />
          <Button Content="Save" 
              Command="{Binding SaveCommand}"
              Background="{DynamicResource MTM_Shared_Logic.PrimaryBrush}" />
        </StackPanel>
      </Border>
    </Grid>
  </ScrollViewer>
</UserControl>
```

---

## üîç Testing & Validation Checklist

After implementation, verify:

### Compilation & Runtime

- [ ] No compilation errors or warnings
- [ ] No AVLN2000 AXAML syntax errors
- [ ] Application launches without exceptions
- [ ] Feature accessible via navigation system

### MTM Pattern Compliance

- [ ] All ViewModels use MVVM Community Toolkit patterns exclusively
- [ ] All database operations use stored procedures only
- [ ] All errors handled via Services.ErrorHandling.HandleErrorAsync()
- [ ] All UI follows MTM design system with DynamicResource bindings

### Integration Testing

- [ ] Theme switching works correctly across all MTM theme variants
- [ ] Navigation integration follows established patterns
- [ ] Service dependencies resolve correctly via DI container
- [ ] Database operations complete successfully with proper error handling

### Performance & UX

- [ ] UI responsive during typical operations (< 2 seconds)
- [ ] No memory leaks in long-running operations
- [ ] Proper loading states and user feedback
- [ ] Keyboard navigation and accessibility support

---

## üìù Session Notes Template

Document your progress:

### Implementation Progress

- **Completed Tasks**: [List what you completed this session]
- **Partially Completed**: [List what needs additional work]
- **Blocked Items**: [List any issues preventing progress]

### Architectural Decisions

- **Pattern Choices**: [Any MTM pattern implementations or decisions made]
- **Integration Approaches**: [How you integrated with existing services]
- **Performance Considerations**: [Any performance optimizations implemented]

### Next Session Preparation

- **Next Priority**: [What should be tackled first in the next session]
- **Dependencies**: [What needs to be completed before other work can proceed]
- **Context Notes**: [Any important context for the next developer/session]

---

## üöÄ Execution Instruction

**Implement the critical priority items first, following the exact MTM patterns shown above. Focus on resolving blocking dependencies before moving to feature implementation.**

Use this prompt with: **#github-pull-request_copilot-coding-agent** to activate automated implementation.

---

*Generated by MTM Pull Request Audit System v1.0*  
*Last Updated: {DATE-TIME}*
