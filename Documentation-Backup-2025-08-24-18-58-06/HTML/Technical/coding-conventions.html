<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MTM WIP Application - Coding conventions and standards for .NET 8, C#, and Avalonia development">
    <meta name="keywords" content="MTM, WIP, coding conventions, C#, Avalonia, .NET 8, standards">
    <meta name="author" content="MTM Development Team">
    
    <title>MTM WIP Application - Coding Conventions (.NET 8)</title>
    
    <!-- Modern Stylesheets -->
    <link rel="stylesheet" href="../assets/css/modern-styles.css">
    <link rel="stylesheet" href="../assets/css/mtm-theme.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../assets/images/mtm-favicon.svg">
</head>
<body>
    <!-- Skip to content link for accessibility -->
    <a href="#main-content" class="skip-to-content">Skip to main content</a>
    
    <!-- Main Layout -->
    <div class="layout">
        <!-- Sidebar Navigation -->
        <aside class="layout-sidebar mtm-nav" role="navigation" aria-label="Main navigation">
            <!-- Brand Section -->
            <div class="mtm-nav-brand">
                <div class="mtm-nav-brand-icon" aria-hidden="true">üìä</div>
                <h1 class="mtm-nav-brand-title">MTM WIP</h1>
                <p class="mtm-nav-brand-subtitle">Technical Documentation</p>
            </div>
            
            <!-- Navigation Sections -->
            <nav class="nav">
                <!-- Core Documentation -->
                <section class="mtm-nav-section">
                    <h2 class="mtm-nav-section-title">Core Documentation</h2>
                    <ul class="nav-links" role="list">
                        <li><a href="index.html" class="mtm-nav-link">
                            <span class="mtm-nav-icon" aria-hidden="true">üè†</span>
                            Documentation Hub
                        </a></li>
                        <li><a href="coding-conventions.html" class="mtm-nav-link is-active" aria-current="page">
                            <span class="mtm-nav-icon" aria-hidden="true">üìù</span>
                            Coding Conventions
                        </a></li>
                        <li><a href="ui-generation.html" class="mtm-nav-link">
                            <span class="mtm-nav-icon" aria-hidden="true">üñ•Ô∏è</span>
                            UI Generation
                        </a></li>
                        <li><a href="error-handler.html" class="mtm-nav-link">
                            <span class="mtm-nav-icon" aria-hidden="true">‚ö†Ô∏è</span>
                            Error Handling
                        </a></li>
                    </ul>
                </section>
                
                <!-- GitHub Instructions -->
                <section class="mtm-nav-section">
                    <h2 class="mtm-nav-section-title">GitHub Instructions</h2>
                    <ul class="nav-links" role="list">
                        <li><a href="../../.github/copilot-instructions.md" class="mtm-nav-link">
                            <span class="mtm-nav-icon" aria-hidden="true">üìö</span>
                            Master Instructions
                        </a></li>
                        <li><a href="../../.github/codingconventions.instruction.md" class="mtm-nav-link">
                            <span class="mtm-nav-icon" aria-hidden="true">üìã</span>
                            Coding Standards
                        </a></li>
                        <li><a href="../../.github/ui-generation.instruction.md" class="mtm-nav-link">
                            <span class="mtm-nav-icon" aria-hidden="true">üé®</span>
                            UI Instructions
                        </a></li>
                        <li><a href="../../.github/errorhandler.instruction.md" class="mtm-nav-link">
                            <span class="mtm-nav-icon" aria-hidden="true">üîß</span>
                            Error Handling
                        </a></li>
                    </ul>
                </section>
                
                <!-- Database & Development -->
                <section class="mtm-nav-section">
                    <h2 class="mtm-nav-section-title">Database & Development</h2>
                    <ul class="nav-links" role="list">
                        <li><a href="../../Documentation/Documentation/Development/Database_Files/README_NewProcedures.md" class="mtm-nav-link">
                            <span class="mtm-nav-icon" aria-hidden="true">üóÑÔ∏è</span>
                            Database Procedures
                        </a></li>
                        <li><a href="github-workflow.html" class="mtm-nav-link">
                            <span class="mtm-nav-icon" aria-hidden="true">üîÑ</span>
                            GitHub Workflow
                        </a></li>
                        <li><a href="../../.github/naming.conventions.instruction.md" class="mtm-nav-link">
                            <span class="mtm-nav-icon" aria-hidden="true">üè∑Ô∏è</span>
                            Naming Conventions
                        </a></li>
                    </ul>
                </section>
            </nav>
        </aside>
        
        <!-- Main Content Area -->
        <div class="layout-content">
            <!-- Header -->
            <header class="header" role="banner">
                <div class="header-brand">
                    <span class="icon" aria-hidden="true">üìù</span>
                    <span>Coding Conventions (.NET 8)</span>
                </div>
                
                <div class="header-actions">
                    <a href="../../.github/copilot-instructions.md" class="btn btn-secondary" title="View GitHub Instructions">
                        üìö GitHub Instructions
                    </a>
                    <button class="theme-toggle" aria-label="Toggle dark theme" title="Toggle theme">
                        üåô
                    </button>
                </div>
            </header>
            
            <!-- Main Content -->
            <main id="main-content" class="main" role="main">
                <!-- Hero Section -->
                <section class="mtm-hero mtm-fade-in">
                    <h1 class="mtm-hero-title">MTM WIP Coding Conventions</h1>
                    <p class="mtm-hero-subtitle">
                        Comprehensive coding standards for .NET 8, C#, and Avalonia development with ReactiveUI
                    </p>
                    <div class="mtm-hero-badges">
                        <span class="badge badge-primary">.NET 8</span>
                        <span class="badge badge-secondary">Avalonia UI</span>
                        <span class="badge badge-accent">ReactiveUI</span>
                    </div>
                </section>
                
                <!-- .NET 8 Specific Updates -->
                <section class="mtm-slide-up">
                    <div class="mtm-card">
                        <div class="mtm-card-header">
                            <div class="mtm-card-icon">üöÄ</div>
                            <h3 class="mtm-card-title">.NET 8 Framework Updates</h3>
                        </div>
                        <div class="mtm-card-content">
                            <div class="alert alert-info">
                                <h4>üéØ .NET 8 Compliance</h4>
                                <p><strong>Project targets .NET 8</strong> with modern C# language features and performance improvements.</p>
                            </div>
                            
                            <h4>Required Framework Features</h4>
                            <ul>
                                <li><strong>File-scoped namespaces:</strong> Use file-scoped namespace declarations</li>
                                <li><strong>Global using statements:</strong> Defined in GlobalUsings.cs for common imports</li>
                                <li><strong>Nullable reference types:</strong> Enabled project-wide with proper null handling</li>
                                <li><strong>Top-level statements:</strong> Used in Program.cs for cleaner application startup</li>
                                <li><strong>Record types:</strong> Use for immutable data transfer objects</li>
                                <li><strong>Pattern matching:</strong> Enhanced switch expressions and pattern matching</li>
                            </ul>

                            <h4>Example .NET 8 Service Class</h4>
                            <div class="mtm-code">
using MTM.Core.Services;

namespace MTM_WIP_Application_Avalonia.Services;

public sealed class ConfigurationService : IConfigurationService
{
    private readonly IConfiguration _configuration;
    
    public ConfigurationService(IConfiguration configuration)
    {
        _configuration = configuration ?? throw new ArgumentNullException(nameof(configuration));
    }
    
    public string? GetConnectionString(string name) => _configuration.GetConnectionString(name);
    
    public T? GetSection<T>(string sectionName) where T : class, new()
        => _configuration.GetSection(sectionName).Get<T>();
}
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Core Principles -->
                <section class="mtm-slide-up">
                    <div class="mtm-card">
                        <div class="mtm-card-header">
                            <div class="mtm-card-icon">üéØ</div>
                            <h3 class="mtm-card-title">Core Principles</h3>
                        </div>
                        <div class="mtm-card-content">
                            <ul>
                                <li><strong>MVVM Architecture:</strong> Strict separation using ReactiveUI with .NET 8 patterns</li>
                                <li><strong>Dependency Injection:</strong> Use <code>services.AddMTMServices(configuration)</code> for comprehensive setup</li>
                                <li><strong>Database Access:</strong> ALL operations via stored procedures using Helper_Database_StoredProcedure</li>
                                <li><strong>Error Handling:</strong> Standardized patterns with Result&lt;T&gt; and proper logging</li>
                                <li><strong>Business Logic:</strong> TransactionType determined by user intent, NOT operation numbers</li>
                                <li><strong>Async/Await:</strong> All I/O operations must be asynchronous with CancellationToken support</li>
                            </ul>
                            
                            <div class="alert alert-warning">
                                <h4>‚ö†Ô∏è CRITICAL SERVICE REGISTRATION</h4>
                                <p><strong>ALWAYS use AddMTMServices() - NEVER register MTM services individually!</strong></p>
                                <p>Manual registration will fail due to missing dependency chains (IValidationService, ICacheService, etc.)</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Service Registration -->
                <section class="mtm-slide-up">
                    <div class="mtm-card">
                        <div class="mtm-card-header">
                            <div class="mtm-card-icon">üîß</div>
                            <h3 class="mtm-card-title">Service Registration (.NET 8 DI)</h3>
                        </div>
                        <div class="mtm-card-content">
                            <h4>Correct Service Registration Pattern</h4>
                            <div class="mtm-code">
// Program.cs with .NET 8 top-level statements
using MTM.Extensions;

var builder = WebApplication.CreateBuilder(args);

// ‚úÖ CRITICAL: Use comprehensive service registration
builder.Services.AddMTMServices(builder.Configuration);

// ‚úÖ Override Avalonia-specific services AFTER AddMTMServices
builder.Services.AddSingleton<IConfigurationService, ConfigurationService>();
builder.Services.AddSingleton<IApplicationStateService, ApplicationStateService>();

// ‚úÖ Infrastructure Services
builder.Services.AddSingleton<INavigationService, NavigationService>();

// ‚úÖ ViewModels (Transient - new instance each time)
builder.Services.AddTransient<MainViewModel>();
builder.Services.AddTransient<InventoryViewModel>();
// ... register all ViewModels

var app = builder.Build();
                            </div>

                            <div class="alert alert-error">
                                <h4>‚ùå Common Registration Errors</h4>
                                <ul>
                                    <li><strong>Missing IValidationService:</strong> Required by InventoryService</li>
                                    <li><strong>Missing ICacheService:</strong> Required by multiple business services</li>
                                    <li><strong>Unregistered ViewModels:</strong> Each ViewModel needs explicit registration</li>
                                    <li><strong>Wrong Service Lifetime:</strong> ViewModels should be Transient, services Scoped/Singleton</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ReactiveUI Patterns -->
                <section class="mtm-slide-up">
                    <div class="mtm-card">
                        <div class="mtm-card-header">
                            <div class="mtm-card-icon">‚ö°</div>
                            <h3 class="mtm-card-title">ReactiveUI Patterns (.NET 8)</h3>
                        </div>
                        <div class="mtm-card-content">
                            <h4>ViewModel Implementation</h4>
                            <div class="mtm-code">
namespace MTM_WIP_Application_Avalonia.ViewModels;

public sealed class InventoryViewModel : ReactiveObject
{
    private string _partId = string.Empty;
    public string PartId
    {
        get => _partId;
        set => this.RaiseAndSetIfChanged(ref _partId, value);
    }

    private readonly ObservableAsPropertyHelper<bool> _isFormValid;
    public bool IsFormValid => _isFormValid.Value;

    public ReactiveCommand<Unit, Unit> SaveCommand { get; }

    public InventoryViewModel(IInventoryService inventoryService, ILogger<InventoryViewModel> logger)
    {
        // Derived properties
        _isFormValid = this.WhenAnyValue(
                vm => vm.PartId,
                vm => vm.Quantity,
                (part, qty) => !string.IsNullOrWhiteSpace(part) && qty > 0)
            .ToProperty(this, vm => vm.IsFormValid);

        // Commands with proper error handling
        SaveCommand = ReactiveCommand.CreateFromTask(SaveAsync, 
            this.WhenAnyValue(vm => vm.IsFormValid));
            
        SaveCommand.ThrownExceptions.Subscribe(ex =>
        {
            logger.LogError(ex, "Failed to save inventory item");
            // Show user-friendly error message
        });
    }

    private async Task SaveAsync(CancellationToken cancellationToken = default)
    {
        // Use stored procedure for database operations
        var result = await Helper_Database_StoredProcedure.ExecuteDataTableWithStatus(
            Model_AppVariables.ConnectionString,
            "inv_inventory_Add_Item_Enhanced",
            new Dictionary<string, object> 
            {
                ["p_PartID"] = PartId,
                ["p_Quantity"] = Quantity,
                ["p_UserID"] = CurrentUser
            }
        );
        
        if (result.Status == 0)
        {
            // Success - reset form
            PartId = string.Empty;
            Quantity = 0;
        }
        else
        {
            throw new InvalidOperationException(result.Message);
        }
    }
}
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Database Access -->
                <section class="mtm-slide-up">
                    <div class="mtm-card">
                        <div class="mtm-card-header">
                            <div class="mtm-card-icon">üíæ</div>
                            <h3 class="mtm-card-title">Database Access Rules</h3>
                        </div>
                        <div class="mtm-card-content">
                            <div class="alert alert-error">
                                <h4>‚ö†Ô∏è CRITICAL DATABASE RULE</h4>
                                <p><strong>All MySQL commands MUST be executed through stored procedures only.</strong></p>
                                <ul>
                                    <li><strong>Prohibited:</strong> Direct SQL queries in code (SELECT, INSERT, UPDATE, DELETE)</li>
                                    <li><strong>Required:</strong> Use stored procedure calls via Helper_Database_StoredProcedure.ExecuteDataTableWithStatus()</li>
                                    <li><strong>Available:</strong> 12 comprehensive procedures in Documentation/Development/Database_Files/New_Stored_Procedures.sql</li>
                                </ul>
                            </div>

                            <h4>Correct Pattern (.NET 8)</h4>
                            <div class="mtm-code">
// ‚úÖ CORRECT: Using stored procedure with modern C#
public async Task<Result<InventoryItem>> GetInventoryItemAsync(string partId, CancellationToken cancellationToken = default)
{
    try 
    {
        var parameters = new Dictionary<string, object> 
        {
            ["p_PartID"] = partId
        };

        var result = await Helper_Database_StoredProcedure.ExecuteDataTableWithStatus(
            Model_AppVariables.ConnectionString,
            "inv_inventory_Get_ByPartID",
            parameters
        );

        return result.Status switch
        {
            0 => Result<InventoryItem>.Success(MapToInventoryItem(result.Data)),
            1 => Result<InventoryItem>.Warning("Item not found"),
            _ => Result<InventoryItem>.Failure(result.Message)
        };
    }
    catch (Exception ex)
    {
        return Result<InventoryItem>.Failure($"Database error: {ex.Message}");
    }
}

// ‚ùå PROHIBITED: Direct SQL
// var query = "SELECT * FROM inventory WHERE part_id = @partId"; // NEVER DO THIS
                            </div>
                        </div>
                    </div>
                </section>

                <!-- MTM Business Logic -->
                <section class="mtm-slide-up">
                    <div class="mtm-card">
                        <div class="mtm-card-header">
                            <div class="mtm-card-icon">üéØ</div>
                            <h3 class="mtm-card-title">MTM Business Logic Rules</h3>
                        </div>
                        <div class="mtm-card-content">
                            <div class="alert alert-warning">
                                <h4>üéØ CRITICAL: Transaction Type Determination</h4>
                                <p><strong>TransactionType is determined by the USER'S INTENT, NOT the Operation number.</strong></p>
                            </div>

                            <h4>Correct TransactionType Logic (.NET 8)</h4>
                            <div class="mtm-code">
public enum UserAction { AddStock, RemoveStock, TransferStock }

public static TransactionType GetTransactionTypeForAction(UserAction action) => action switch
{
    UserAction.AddStock => TransactionType.IN,      // User adding stock
    UserAction.RemoveStock => TransactionType.OUT,  // User removing stock  
    UserAction.TransferStock => TransactionType.TRANSFER, // User moving stock
    _ => throw new ArgumentException($"Unknown user action: {action}")
};

// Operation numbers are workflow step identifiers only
public record InventoryOperation(string OperationCode, string Description, int Sequence)
{
    public static readonly InventoryOperation[] StandardOperations = 
    [
        new("90", "Receiving", 1),
        new("100", "Initial Processing", 2),
        new("110", "Quality Control", 3),
        new("120", "Final Assembly", 4)
    ];
}
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Cross-Reference Links -->
                <section class="mtm-slide-up">
                    <div class="mtm-card">
                        <div class="mtm-card-header">
                            <div class="mtm-card-icon">üîó</div>
                            <h3 class="mtm-card-title">Related Documentation</h3>
                        </div>
                        <div class="mtm-card-content">
                            <div class="grid grid-2">
                                <div>
                                    <h4>GitHub Instructions</h4>
                                    <ul>
                                        <li><a href="../../.github/copilot-instructions.md">Master Instructions</a></li>
                                        <li><a href="../../.github/codingconventions.instruction.md">Detailed Coding Standards</a></li>
                                        <li><a href="../../.github/ui-generation.instruction.md">UI Generation Patterns</a></li>
                                        <li><a href="../../.github/errorhandler.instruction.md">Error Handling Guide</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <h4>Development Documentation</h4>
                                    <ul>
                                        <li><a href="../../ViewModels/README.md">ViewModel Patterns</a></li>
                                        <li><a href="../../Views/README.md">View Implementation</a></li>
                                        <li><a href="../../Models/README.md">Model Definitions</a></li>
                                        <li><a href="../../Documentation/Development/Database_Files/README_NewProcedures.md">Database Procedures</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>
    
    <!-- Modern JavaScript -->
    <script src="../assets/js/modern-features.js"></script>
</body>
</html>