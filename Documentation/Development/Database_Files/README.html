<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTM Documentation - Database Files</title>
    <meta name="description" content="MTM WIP Application Database Files - Comprehensive database schema, stored procedures, and documentation">
    <meta name="keywords" content="MTM, Database, SQL Server, Stored Procedures, Schema, Documentation">
    <meta name="author" content="MTM Development Team">
    
    <link rel="stylesheet" href="../../HTML_Data/css/mtm-documentation.css">
    <link rel="stylesheet" href="../../HTML_Data/css/readme-styles.css">
    
    <!-- Favicon placeholder -->
    <!-- <link rel="icon" type="image/svg+xml" href="../../HTML_Data/assets/mtm-favicon.svg"> -->
    
    <!-- Preload critical resources -->
    <link rel="preload" href="../../HTML_Data/js/documentation-nav.js" as="script">
    <link rel="preload" href="../../HTML_Data/js/collapsible-sections.js" as="script">
</head>
<body>
    <!-- Skip to content link for accessibility -->
    <a href="#main-content" class="skip-to-content" style="position: absolute; left: -9999px; width: 1px; height: 1px; overflow: hidden;">Skip to main content</a>
    
    <header class="mtm-header">
        <!-- <img src="../../HTML_Data/assets/mtm-logo.png" alt="MTM Logo"> -->
        <div>
            <h1>MTM WIP Application - Database Files</h1>
            <p class="readme-subtitle">Comprehensive database schema, stored procedures, and documentation</p>
        </div>
    </header>
    
    <nav class="documentation-nav" role="navigation" aria-label="Main navigation">
        <!-- Navigation will be populated by JavaScript -->
    </nav>
    
    <main class="content" id="main-content">
        <section class="overview-section">
            <h2>üìÅ Database Files Overview</h2>
            <p>This directory contains all database-related files for the MTM WIP Application, including stored procedures, table scripts, database schema definitions, and sample data. All database files are organized by functional category to provide clear separation of concerns and easy navigation.</p>
            
            <p>The MTM WIP Application uses a MySQL database with a comprehensive set of 45 stored procedures for inventory management, master data management, user management, quick button operations, and system configuration. All database access in the application is performed through these stored procedures using the <code>Helper_Database_StoredProcedure</code> pattern for MySQL 5.7 compatibility.</p>
            
            <div class="quick-stats">
                <div class="stat-card">
                    <span class="stat-number">6</span>
                    <span class="stat-label">SQL Files</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">45</span>
                    <span class="stat-label">Stored Procedures</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">5</span>
                    <span class="stat-label">Functional Areas</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">100%</span>
                    <span class="stat-label">MySQL 5.7 Compatible</span>
                </div>
            </div>
        </section>
        
        <section class="file-browser">
            <div class="file-browser-header">
                üìÅ Current Database Files
            </div>
            <div class="file-browser-content">
                <div class="breadcrumb">
                    <a href="../../../README.md">MTM WIP Application</a>
                    <span class="breadcrumb-separator">></span>
                    <a href="../../">Documentation</a>
                    <span class="breadcrumb-separator">></span>
                    <a href="../">Development</a>
                    <span class="breadcrumb-separator">></span>
                    <span class="current-page">Database Files</span>
                </div>
                
                <ul class="file-tree">
                    <li class="sql-file">
                        <strong>Development_Database_Schema.sql</strong>
                        <span class="status-indicator status-development">Development</span>
                        <div class="file-description">Development schema changes and new table definitions</div>
                    </li>
                    <li class="sql-file">
                        <strong>Development_Stored_Procedures.sql</strong>
                        <span class="status-indicator status-development">Development</span>
                        <div class="file-description">New stored procedures for development features</div>
                    </li>
                    <li class="sql-file">
                        <strong>Production_Database_Schema.sql</strong>
                        <span class="status-indicator status-current">Current</span>
                        <div class="file-description">Current production database schema</div>
                    </li>
                    <li class="sql-file">
                        <strong>Production_Stored_Procedures.sql</strong>
                        <span class="status-indicator status-current">Current</span>
                        <div class="file-description">Production stored procedures</div>
                    </li>
                    <li class="sql-file">
                        <strong>Updated_Stored_Procedures.sql</strong>
                        <span class="status-indicator status-production">Production Ready</span>
                        <div class="file-description">Complete 45 stored procedures for all MTM operations - MySQL 5.7 compatible</div>
                    </li>
                    <li class="sql-file">
                        <strong>Updated_Stored_Procedures.sql.backup</strong>
                        <span class="status-indicator status-backup">Backup</span>
                        <div class="file-description">Backup of stored procedures implementation</div>
                    </li>
                </ul>
            </div>
        </section>
        
        <section class="usage-guidelines">
            <h2>üöÄ Usage Guidelines</h2>
            
            <div class="collapsible active" id="developer-guidelines">
                <div class="collapsible-header">
                    <h3>For Developers</h3>
                    <span class="collapsible-toggle"></span>
                </div>
                <div class="collapsible-content">
                    <ul>
                        <li><strong>Stored Procedures:</strong> All database operations must use the provided stored procedures via <code>Helper_Database_StoredProcedure.ExecuteDataTableWithStatus()</code></li>
                        <li><strong>Schema Changes:</strong> Use the table scripts and schema files as reference for database structure</li>
                        <li><strong>Testing:</strong> Use sample data files for development and testing scenarios</li>
                        <li><strong>Organization:</strong> Follow the established category-based folder structure when adding new database files</li>
                        <li><strong>Error Handling:</strong> All procedures return standardized status and message values</li>
                        <li><strong>Logging:</strong> Database operations are logged through the centralized error handling system</li>
                    </ul>
                </div>
            </div>
            
            <div class="collapsible" id="dba-guidelines">
                <div class="collapsible-header">
                    <h3>For Database Administrators</h3>
                    <span class="collapsible-toggle"></span>
                </div>
                <div class="collapsible-content">
                    <ul>
                        <li><strong>Deployment:</strong> Execute schema files first, then stored procedures in order</li>
                        <li><strong>Maintenance:</strong> Use the schema documentation to understand table relationships and constraints</li>
                        <li><strong>Backup:</strong> Ensure all custom stored procedures are included in database backups</li>
                        <li><strong>Performance:</strong> Monitor stored procedure execution plans and optimize as needed</li>
                        <li><strong>Security:</strong> All database access is controlled through stored procedures with parameter validation</li>
                    </ul>
                </div>
            </div>
        </section>
        
        <section class="categories">
            <h2>üìÇ Functional Categories</h2>
            <div class="category-grid">
                <div class="category-item">
                    <h3>üîß Inventory Management (7 procedures)</h3>
                    <p>Complete collection of stored procedures for inventory operations including add, remove, transfer, and query operations. Includes automatic batch number generation and transaction history.</p>
                    <strong>Key Procedures:</strong> inv_inventory_Add_Item, inv_inventory_Remove_Item, inv_inventory_Transfer_Part, inv_inventory_Transfer_Quantity, inv_inventory_Get_ByPartID
                </div>
                <div class="category-item">
                    <h3>üìä Master Data Management (20 procedures)</h3>
                    <p>Comprehensive procedures for managing reference data including part IDs, operations, locations, and item types with full CRUD operations and dependency validation.</p>
                    <strong>Key Procedures:</strong> md_part_ids_*, md_operation_numbers_*, md_locations_*, md_item_types_* (5 procedures each)
                </div>
                <div class="category-item">
                    <h3>üë• User Management (14 procedures)</h3>
                    <p>Complete user lifecycle management with inventory validation, UI settings persistence, and role-based access control including legacy compatibility.</p>
                    <strong>Key Procedures:</strong> usr_users_Add, usr_users_Update, usr_users_Delete_ByID, usr_ui_settings_*, sys_roles_Get_All
                </div>
                <div class="category-item">
                    <h3>‚ö° Quick Button Operations (4 procedures)</h3>
                    <p>User-specific quick button management with position-based operations and transaction history integration for rapid inventory operations.</p>
                    <strong>Key Procedures:</strong> qb_quickbuttons_Get_ByUser, qb_quickbuttons_Save, qb_quickbuttons_Remove, qb_quickbuttons_Clear_ByUser, sys_last_10_transactions_*
                </div>
            </div>
        </section>
        
        <section class="technical-details">
            <h2>üîß Technical Architecture</h2>
            
            <div class="collapsible" id="database-patterns">
                <div class="collapsible-header">
                    <h3>Database Access Patterns</h3>
                    <span class="collapsible-toggle"></span>
                </div>
                <div class="collapsible-content">
                    <h4>Stored Procedure Only Pattern</h4>
                    <pre><code>// ‚úÖ CORRECT: Use stored procedures via Helper_Database_StoredProcedure
var parameters = new Dictionary&lt;string, object&gt;
{
    ["p_PartID"] = partId,
    ["p_Location"] = location,
    ["p_Operation"] = operation,
    ["p_Quantity"] = quantity,
    ["p_ItemType"] = itemType,
    ["p_User"] = user,
    ["p_Notes"] = notes ?? DBNull.Value
};

var result = await Helper_Database_StoredProcedure.ExecuteDataTableWithStatus(
    connectionString,
    "inv_inventory_Add_Item",
    parameters
);

if (result.IsSuccess)
{
    // Process successful result
    var data = result.Data;
}
else
{
    // Handle error with message
    throw new InvalidOperationException(result.Message);
}

// For procedures that don't follow MTM status pattern
var directResult = await Helper_Database_StoredProcedure.ExecuteDataTableDirect(
    connectionString,
    "qb_quickbuttons_Get_ByUser",
    new Dictionary&lt;string, object&gt; { ["p_User"] = userId }
);</code></pre>
                    
                    <h4>Error Handling Pattern</h4>
                    <p>All stored procedures follow a standardized return pattern with <code>p_Status</code> and <code>p_ErrorMsg</code> output parameters for consistent error handling throughout the application. 43 of 45 procedures follow this pattern, with 2 read-only procedures using direct execution.</p>
                </div>
            </div>
            
            <div class="collapsible" id="naming-conventions">
                <div class="collapsible-header">
                    <h3>Naming Conventions</h3>
                    <span class="collapsible-toggle"></span>
                </div>
                <div class="collapsible-content">
                    <ul>
                        <li><strong>Inventory:</strong> <code>inv_</code> prefix (e.g., inv_inventory_Add_Item)</li>
                        <li><strong>Master Data:</strong> <code>md_</code> prefix (e.g., md_part_ids_Get_All)</li>
                        <li><strong>User Management:</strong> <code>usr_</code> prefix (e.g., usr_users_Add)</li>
                        <li><strong>System:</strong> <code>sys_</code> prefix (e.g., sys_roles_Get_All)</li>
                        <li><strong>QuickButtons:</strong> <code>qb_</code> prefix (e.g., qb_quickbuttons_Save)</li>
                        <li><strong>Parameters:</strong> <code>p_</code> prefix for input parameters</li>
                        <li><strong>Output:</strong> Standardized <code>p_Status</code> and <code>p_ErrorMsg</code> output parameters</li>
                        <li><strong>MySQL 5.7:</strong> All procedures use DEFINER=`root`@`localhost` for compatibility</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>
    
    <footer class="last-updated">
        <p><em>Last Updated: December 19, 2024 - MTM Database Documentation v1.0</em></p>
    </footer>
    
    <!-- Modern JavaScript -->
    <script src="../../HTML_Data/js/documentation-nav.js"></script>
    <script src="../../HTML_Data/js/collapsible-sections.js"></script>
    
    <!-- Schema.org structured data for better SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "TechArticle",
        "headline": "MTM WIP Application - Database Files",
        "description": "Comprehensive database schema, stored procedures, and documentation for the MTM WIP Application",
        "author": {
            "@type": "Organization",
            "name": "MTM Development Team"
        },
        "dateModified": "2024-12-19",
        "about": {
            "@type": "SoftwareApplication",
            "name": "MTM WIP Application",
            "applicationCategory": "Business Application"
        }
    }
    </script>
</body>
</html>