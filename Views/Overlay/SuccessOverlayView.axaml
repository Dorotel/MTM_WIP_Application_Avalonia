<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels.Overlay"
             xmlns:materialIcons="using:Material.Icons.Avalonia"
             xmlns:converters="using:MTM_WIP_Application_Avalonia.Converters"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="MTM_WIP_Application_Avalonia.Views.Overlay.SuccessOverlayView"
             x:CompileBindings="True" x:DataType="vm:SuccessOverlayViewModel">

  <UserControl.Resources>
    <converters:ColorToBoxShadowConverter x:Key="ColorToBoxShadowConverter"/>
  </UserControl.Resources>

  <UserControl.Styles>
    <!-- Success Overlay Styles -->
    <Style Selector="Border.success-overlay">
      <Setter Property="Background" Value="#C8E6C9" />
      <Setter Property="BorderBrush" Value="#4CAF50" />
      <Setter Property="BorderThickness" Value="2" />
      <Setter Property="CornerRadius" Value="12" />
      <Setter Property="BoxShadow" Value="{Binding Source=#EEEEEE, Converter={StaticResource ColorToBoxShadowConverter}, ConverterParameter='0,8,24,0'}" />
    </Style>

    <!-- Error Overlay Styles -->
    <Style Selector="Border.error-overlay">
      <Setter Property="Background" Value="#FFCDD2" />
      <Setter Property="BorderBrush" Value="#F44336" />
      <Setter Property="BorderThickness" Value="2" />
      <Setter Property="CornerRadius" Value="12" />
      <Setter Property="BoxShadow" Value="{Binding Source=#EEEEEE, Converter={StaticResource ColorToBoxShadowConverter}, ConverterParameter='0,8,24,0'}" />
    </Style>

    <!-- Success Icon Styling -->
    <Style Selector="materialIcons|MaterialIcon.success-icon">
      <Setter Property="Foreground" Value="#4CAF50" />
      <Setter Property="Width" Value="48" />
      <Setter Property="Height" Value="48" />
      <Setter Property="HorizontalAlignment" Value="Center" />
      <Setter Property="VerticalAlignment" Value="Center" />
    </Style>

    <!-- Error Icon Styling -->
    <Style Selector="materialIcons|MaterialIcon.error-icon">
      <Setter Property="Foreground" Value="#F44336" />
      <Setter Property="Width" Value="48" />
      <Setter Property="Height" Value="48" />
      <Setter Property="HorizontalAlignment" Value="Center" />
      <Setter Property="VerticalAlignment" Value="Center" />
    </Style>

    <!-- Success Message Styling -->
    <Style Selector="TextBlock.success-title">
      <Setter Property="Foreground" Value="#388E3C" />
      <Setter Property="FontSize" Value="18" />
      <Setter Property="FontWeight" Value="Bold" />
      <Setter Property="HorizontalAlignment" Value="Center" />
      <Setter Property="TextAlignment" Value="Center" />
      <Setter Property="TextWrapping" Value="Wrap" />
    </Style>

    <!-- Error Message Styling -->
    <Style Selector="TextBlock.error-title">
      <Setter Property="Foreground" Value="#F44336" />
      <Setter Property="FontSize" Value="18" />
      <Setter Property="FontWeight" Value="Bold" />
      <Setter Property="HorizontalAlignment" Value="Center" />
      <Setter Property="TextAlignment" Value="Center" />
      <Setter Property="TextWrapping" Value="Wrap" />
    </Style>

    <!-- Error Details Styling -->
    <Style Selector="TextBlock.error-details">
      <Setter Property="Foreground" Value="#424242" />
      <Setter Property="FontSize" Value="12" />
      <Setter Property="FontWeight" Value="Medium" />
      <Setter Property="HorizontalAlignment" Value="Center" />
      <Setter Property="TextAlignment" Value="Center" />
      <Setter Property="TextWrapping" Value="Wrap" />
      <Setter Property="Opacity" Value="0.8" />
    </Style>

    <!-- Success Details Styling -->
    <Style Selector="TextBlock.success-details">
      <Setter Property="Foreground" Value="#424242" />
      <Setter Property="FontSize" Value="12" />
      <Setter Property="FontWeight" Value="Medium" />
      <Setter Property="HorizontalAlignment" Value="Center" />
      <Setter Property="TextAlignment" Value="Center" />
      <Setter Property="TextWrapping" Value="Wrap" />
      <Setter Property="Opacity" Value="0.8" />
    </Style>

    <!-- Error Progress Bar Styling -->
    <Style Selector="ProgressBar.error-progress">
      <Setter Property="Foreground" Value="#F44336" />
      <Setter Property="Background" Value="#EEEEEE" />
      <Setter Property="Height" Value="3" />
      <Setter Property="CornerRadius" Value="2" />
      <Setter Property="Margin" Value="0,8,0,0" />
    </Style>

    <!-- Progress Bar Styling -->
    <Style Selector="ProgressBar.success-progress">
      <Setter Property="Foreground" Value="#4CAF50" />
      <Setter Property="Background" Value="#EEEEEE" />
      <Setter Property="Height" Value="3" />
      <Setter Property="CornerRadius" Value="2" />
      <Setter Property="Margin" Value="0,8,0,0" />
    </Style>

    <!-- Error Action Button Styling -->
    <Style Selector="Button.error-action">
      <Setter Property="Background" Value="#F44336" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="FontSize" Value="12" />
      <Setter Property="FontWeight" Value="Medium" />
      <Setter Property="Padding" Value="16,8" />
      <Setter Property="CornerRadius" Value="6" />
      <Setter Property="Margin" Value="4" />
      <Setter Property="MinWidth" Value="120" />
    </Style>

    <Style Selector="Button.error-action:pointerover">
      <Setter Property="Background" Value="#D32F2F" />
    </Style>

    <!-- Continue Button Styling -->
    <Style Selector="Button.continue-action">
      <Setter Property="Background" Value="#0078D4" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="FontSize" Value="12" />
      <Setter Property="FontWeight" Value="Medium" />
      <Setter Property="Padding" Value="16,8" />
      <Setter Property="CornerRadius" Value="6" />
      <Setter Property="Margin" Value="4" />
      <Setter Property="MinWidth" Value="120" />
    </Style>

    <Style Selector="Button.continue-action:pointerover">
      <Setter Property="Background" Value="#106EBE" />
    </Style>

    <!-- Dismiss Button Styling -->
    <Style Selector="Button.dismiss-button">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Foreground" Value="#424242" />
      <Setter Property="FontSize" Value="10" />
      <Setter Property="Padding" Value="8,4" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="Opacity" Value="0.7" />
    </Style>

    <Style Selector="Button.dismiss-button:pointerover">
      <Setter Property="Background" Value="#F5F5F5" />
      <Setter Property="Opacity" Value="1.0" />
    </Style>

    <!-- Fade Animation -->
    <Style Selector="Border.success-overlay">
      <Style.Animations>
        <Animation Duration="0:0:0.5">
          <KeyFrame Cue="0%">
            <Setter Property="Opacity" Value="0" />
            <Setter Property="ScaleTransform.ScaleX" Value="0.9" />
            <Setter Property="ScaleTransform.ScaleY" Value="0.9" />
          </KeyFrame>
          <KeyFrame Cue="100%">
            <Setter Property="Opacity" Value="1" />
            <Setter Property="ScaleTransform.ScaleX" Value="1.0" />
            <Setter Property="ScaleTransform.ScaleY" Value="1.0" />
          </KeyFrame>
        </Animation>
      </Style.Animations>
    </Style>
  </UserControl.Styles>

  <!-- Full-screen overlay container with semi-transparent background -->
  <Grid x:Name="OverlayContainer" 
        Background="rgba(0,0,0,0.3)"
        HorizontalAlignment="Stretch" 
        VerticalAlignment="Stretch"
        Focusable="True">

    <!-- Success/Error Message Card -->
    <Border x:Name="OverlayCard"
            Classes.success-overlay="{Binding !IsError}"
            Classes.error-overlay="{Binding IsError}"
            MaxWidth="450"
            MinWidth="320" 
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Padding="32,24">
      
      <Grid x:Name="ContentGrid" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto" RowSpacing="12">
        
        <!-- Success/Error Icon -->
        <materialIcons:MaterialIcon Grid.Row="0" 
                                   Classes.success-icon="{Binding !IsError}"
                                   Classes.error-icon="{Binding IsError}"
                                   Kind="{Binding IconKind}" />
        
        <!-- Success/Error Message -->
        <TextBlock Grid.Row="1"
                   Classes.success-title="{Binding !IsError}"
                   Classes.error-title="{Binding IsError}"
                   Text="{Binding Message}" />
        
        <!-- Success/Error Details (optional) -->
        <TextBlock Grid.Row="2"
                   Classes.success-details="{Binding !IsError}"
                   Classes.error-details="{Binding IsError}"
                   Text="{Binding Details}"
                   IsVisible="{Binding ShowDetails}" />
        
        <!-- Progress Bar (animated) -->
        <ProgressBar Grid.Row="3"
                     Classes.success-progress="{Binding !IsError}"
                     Classes.error-progress="{Binding IsError}"
                     Value="{Binding Progress}"
                     Minimum="0"
                     Maximum="1"
                     IsVisible="{Binding IsAnimating}" />
        
        <!-- Auto-dismiss indicator (Success only) -->
        <TextBlock Grid.Row="4"
                   Text="Dismissing automatically..."
                   FontSize="10"
                   Foreground="#424242"
                   HorizontalAlignment="Center"
                   Opacity="0.6"
                   IsVisible="{Binding IsAnimating}" />

        <!-- Emergency keyboard shortcuts hint (Error only) -->
        <TextBlock Grid.Row="5"
                   Text="Emergency shutdown in 30s if unresponsive • Ctrl+Alt+Q (Exit) • Ctrl+Alt+C (Continue)"
                   FontSize="8"
                   Foreground="#424242"
                   HorizontalAlignment="Center"
                   Opacity="0.6"
                   FontStyle="Italic"
                   TextWrapping="Wrap"
                   Margin="0,2,0,4"
                   IsVisible="{Binding IsError}" />
        
        <!-- Button Panel - Conditional based on IsError -->
        <StackPanel Grid.Row="6" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Center"
                    Spacing="8"
                    Margin="0,8,0,0">
          
          <!-- Success: Manual Dismiss Button -->
          <Button Classes="dismiss-button" 
                  Content="✕ Dismiss"
                  Command="{Binding DismissCommand}"
                  ToolTip.Tip="Click to dismiss immediately"
                  IsVisible="{Binding !IsError}" />
          
          <!-- Error: Exit Application and Continue Buttons -->
          <Button Classes="error-action" 
                  Content="🚪 Exit Application"
                  Command="{Binding ExitApplicationCommand}"
                  ToolTip.Tip="Close the application if it continues to have issues (Emergency: Ctrl+Alt+Q)"
                  IsVisible="{Binding IsError}" />
          
          <Button Classes="continue-action" 
                  Content="↻ Continue"
                  Command="{Binding ContinueCommand}"
                  ToolTip.Tip="Continue using the application (Emergency: Ctrl+Alt+C)"
                  IsVisible="{Binding IsError}" />
          
        </StackPanel>
        
      </Grid>
    </Border>
  </Grid>
</UserControl>
