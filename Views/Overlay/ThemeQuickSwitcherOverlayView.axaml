<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels.Overlay"
             xmlns:services="using:MTM_WIP_Application_Avalonia.Services.UI"
             xmlns:converters="using:MTM_WIP_Application_Avalonia.Converters"
             x:Class="MTM_WIP_Application_Avalonia.Views.Overlay.ThemeQuickSwitcherOverlayView"
             x:DataType="vm:ThemeQuickSwitcherOverlayViewModel">

  <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
    <Grid x:Name="MainContainer" RowDefinitions="*,Auto" MinWidth="700" MinHeight="500" Margin="8">

      <!-- Theme Content Area -->
      <Border Grid.Row="0" Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
              BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
              BorderThickness="1" CornerRadius="8" Padding="16" Margin="0,0,0,8">

        <Grid x:Name="ThemeContentGrid" RowDefinitions="Auto,Auto,Auto,*,Auto">

          <!-- Header Section -->
          <Border Grid.Row="0" Background="{DynamicResource MTM_Shared_Logic.AccentBrush}"
                  CornerRadius="6" Padding="16,12" Margin="0,0,0,16">
            <Grid x:Name="HeaderGrid" ColumnDefinitions="Auto,*,Auto">
              <!-- Theme Icon -->
              <Border Grid.Column="0" Background="White" CornerRadius="14"
                      Width="28" Height="28" Margin="0,0,12,0">
                <TextBlock Text="ðŸŽ¨" FontSize="16" HorizontalAlignment="Center"
                          VerticalAlignment="Center" />
              </Border>

              <!-- Header Text -->
              <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                <TextBlock Text="Quick Theme Switcher"
                          FontSize="16" FontWeight="Bold" Foreground="White" />
                <TextBlock Text="{Binding CurrentThemeName, StringFormat='Current: {0}'}"
                          FontSize="12" Foreground="White" Opacity="0.9" />
              </StackPanel>

              <!-- Preview Mode Indicator -->
              <Border Grid.Column="2" Background="#FF8F00" CornerRadius="10"
                      Padding="8,4" IsVisible="{Binding IsPreviewMode}">
                <TextBlock Text="PREVIEW MODE" FontSize="10" FontWeight="Bold"
                          Foreground="White" />
              </Border>
            </Grid>
          </Border>

          <!-- Search and Filters Section -->
          <Border Grid.Row="1" Background="{DynamicResource MTM_Shared_Logic.PanelBackgroundBrush}"
                  BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                  BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,0,16">

            <Grid x:Name="SearchFiltersGrid" RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto">

              <!-- Search Box -->
              <TextBox Grid.Row="0" Grid.Column="0"
                       Text="{Binding ThemeSearchText}"
                       Watermark="Search themes by name or description..."
                       Background="{DynamicResource MTM_Shared_Logic.InputBackgroundBrush}"
                       BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                       Margin="0,0,8,0" />

              <!-- Clear Search Button -->
              <Button Grid.Row="0" Grid.Column="1" Content="Clear"
                      Command="{Binding ClearSearchCommand}"
                      Background="{DynamicResource MTM_Shared_Logic.ButtonSecondaryBrush}"
                      Padding="12,6" />

              <!-- Filter Buttons -->
              <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal"
                          Spacing="8" Margin="0,8,0,0">

                <TextBlock Text="Show:" VerticalAlignment="Center"
                          Foreground="{DynamicResource MTM_Shared_Logic.TextPrimaryBrush}" />

                <ToggleButton Content="All Themes" IsChecked="{Binding ShowAllThemes}"
                              Command="{Binding FilterThemesCommand}" CommandParameter="all"
                              Background="{DynamicResource MTM_Shared_Logic.ButtonSecondaryBrush}"
                              Padding="12,4" />

                <ToggleButton Content="Light Only" IsChecked="{Binding ShowLightThemesOnly}"
                              Command="{Binding FilterThemesCommand}" CommandParameter="light"
                              Background="{DynamicResource MTM_Shared_Logic.InfoBrush}"
                              Foreground="White" Padding="12,4" />

                <ToggleButton Content="Dark Only" IsChecked="{Binding ShowDarkThemesOnly}"
                              Command="{Binding FilterThemesCommand}" CommandParameter="dark"
                              Background="#2C2C2C" Foreground="White" Padding="12,4" />
              </StackPanel>
            </Grid>
          </Border>

          <!-- Current Theme Status -->
          <Border Grid.Row="2" Background="{DynamicResource MTM_Shared_Logic.InfoBrush}"
                  CornerRadius="6" Padding="12" Margin="0,0,0,16">
            <Grid x:Name="StatusGrid" ColumnDefinitions="Auto,*,Auto">
              <!-- Status Icon -->
              <Border Grid.Column="0" Background="White" CornerRadius="8"
                      Width="16" Height="16" Margin="0,0,8,0">
                <TextBlock Text="â„¹" FontSize="10" HorizontalAlignment="Center"
                          VerticalAlignment="Center" Foreground="{DynamicResource MTM_Shared_Logic.InfoBrush}"
                          FontWeight="Bold" />
              </Border>

              <!-- Status Text -->
              <TextBlock Grid.Column="1" Text="{Binding StatusMessage}"
                        VerticalAlignment="Center" Foreground="White" />

              <!-- Theme Variant Indicator -->
              <Border Grid.Column="2" Background="White" CornerRadius="4"
                      Padding="6,2" Opacity="0.9">
                <TextBlock Text="Theme"
                          FontSize="10" FontWeight="SemiBold"
                          Foreground="{DynamicResource MTM_Shared_Logic.InfoBrush}" />
              </Border>
            </Grid>
          </Border>

          <!-- Theme Grid -->
          <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto"
                        HorizontalScrollBarVisibility="Disabled">
            <ItemsControl ItemsSource="{Binding FilteredThemes}">
              <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                  <UniformGrid Columns="3" />
                </ItemsPanelTemplate>
              </ItemsControl.ItemsPanel>

              <ItemsControl.ItemTemplate>
                <DataTemplate DataType="services:ThemeInfo">
                  <Border Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
                          BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                          BorderThickness="1" CornerRadius="8" Margin="4" Padding="12"
                          Classes.Selected="{Binding Id, Converter={StaticResource StringEqualsConverter}, ConverterParameter={Binding $parent[UserControl].((vm:ThemeQuickSwitcherOverlayViewModel)DataContext).SelectedTheme.Id}}"
                          Classes.Preview="{Binding Id, Converter={StaticResource StringEqualsConverter}, ConverterParameter={Binding $parent[UserControl].((vm:ThemeQuickSwitcherOverlayViewModel)DataContext).PreviewTheme.Id}}">

                    <Border.Styles>
                      <Style Selector="Border.Selected">
                        <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.AccentBrush}" />
                        <Setter Property="BorderThickness" Value="2" />
                      </Style>
                      <Style Selector="Border.Preview">
                        <Setter Property="BorderBrush" Value="#FF8F00" />
                        <Setter Property="BorderThickness" Value="2" />
                      </Style>
                    </Border.Styles>

                    <Grid RowDefinitions="Auto,Auto,Auto,*,Auto">
                      <!-- Theme Preview Color -->
                      <Border Grid.Row="0" Height="24" CornerRadius="4"
                              Background="{Binding PreviewColor}" Margin="0,0,0,8" />

                      <!-- Theme Name -->
                      <TextBlock Grid.Row="1" Text="{Binding DisplayName}"
                                FontWeight="SemiBold" FontSize="14"
                                Foreground="{DynamicResource MTM_Shared_Logic.TextPrimaryBrush}"
                                TextWrapping="Wrap" Margin="0,0,0,4" />

                      <!-- Theme Type Badge -->
                      <Border Grid.Row="2" Background="{DynamicResource MTM_Shared_Logic.InfoBrush}"
                              CornerRadius="8" Padding="6,2" HorizontalAlignment="Left" Margin="0,0,0,8">
                        <TextBlock Text="Theme"
                                  FontSize="10" FontWeight="Bold" Foreground="White" />
                      </Border>

                      <!-- Theme Description -->
                      <TextBlock Grid.Row="3" Text="{Binding Description}"
                                FontSize="11" TextWrapping="Wrap"
                                Foreground="{DynamicResource MTM_Shared_Logic.TextSecondaryBrush}"
                                Margin="0,0,0,8" />

                      <!-- Theme Actions -->
                      <Grid Grid.Row="4" ColumnDefinitions="*,Auto">
                        <Button Grid.Column="0" Content="Preview"
                                Command="{Binding $parent[UserControl].((vm:ThemeQuickSwitcherOverlayViewModel)DataContext).PreviewThemeCommand}"
                                CommandParameter="{Binding}"
                                Background="{DynamicResource MTM_Shared_Logic.ButtonSecondaryBrush}"
                                Padding="8,4" CornerRadius="4" FontSize="11"
                                IsVisible="{Binding $parent[UserControl].((vm:ThemeQuickSwitcherOverlayViewModel)DataContext).IsLivePreviewEnabled}" />

                        <Button Grid.Column="1" Content="âœ“"
                                Command="{Binding $parent[UserControl].((vm:ThemeQuickSwitcherOverlayViewModel)DataContext).PreviewThemeCommand}"
                                CommandParameter="{Binding}"
                                Background="{DynamicResource MTM_Shared_Logic.SuccessBrush}"
                                Foreground="White" Padding="8,4" CornerRadius="4" Margin="4,0,0,0"
                                ToolTip.Tip="Quick apply this theme" />
                      </Grid>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>

          <!-- Settings Panel -->
          <Border Grid.Row="4" Background="{DynamicResource MTM_Shared_Logic.PanelBackgroundBrush}"
                  BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                  BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,8,0,0">

            <Grid x:Name="SettingsGrid" ColumnDefinitions="*,*">
              <!-- Preview Settings -->
              <StackPanel Grid.Column="0" Spacing="8">
                <TextBlock Text="Preview Settings" FontWeight="SemiBold"
                          Foreground="{DynamicResource MTM_Shared_Logic.TextPrimaryBrush}" />

                <CheckBox IsChecked="{Binding IsLivePreviewEnabled}"
                          Content="Enable live preview"
                          Foreground="{DynamicResource MTM_Shared_Logic.TextPrimaryBrush}" />

                <CheckBox IsChecked="{Binding AutoSavePreference}"
                          Content="Auto-save theme preference"
                          Foreground="{DynamicResource MTM_Shared_Logic.TextPrimaryBrush}" />
              </StackPanel>

              <!-- Quick Actions -->
              <StackPanel Grid.Column="1" Spacing="8">
                <TextBlock Text="Quick Actions" FontWeight="SemiBold"
                          Foreground="{DynamicResource MTM_Shared_Logic.TextPrimaryBrush}" />

                <Button Content="Toggle Light/Dark"
                        Command="{Binding ToggleThemeVariantCommand}"
                        Background="{DynamicResource MTM_Shared_Logic.AccentBrush}"
                        Foreground="White" Padding="12,6" CornerRadius="4"
                        HorizontalAlignment="Stretch" />

                <Button Content="Reset to Default"
                        Command="{Binding ResetToDefaultThemeCommand}"
                        Background="{DynamicResource MTM_Shared_Logic.ButtonSecondaryBrush}"
                        Padding="12,6" CornerRadius="4"
                        HorizontalAlignment="Stretch" />
              </StackPanel>
            </Grid>
          </Border>
        </Grid>
      </Border>

      <!-- Action Buttons Panel -->
      <Border Grid.Row="1" Background="{DynamicResource MTM_Shared_Logic.PanelBackgroundBrush}"
              BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
              BorderThickness="1,0,1,1" CornerRadius="0,0,8,8" Padding="16">

        <Grid x:Name="ActionButtonsGrid" ColumnDefinitions="Auto,*,Auto,Auto,Auto,Auto">

          <!-- Preview Status Indicator -->
          <Border Grid.Column="0" Background="#FF8F00" CornerRadius="4"
                  Padding="8,4" IsVisible="{Binding IsPreviewMode}" Margin="0,0,16,0">
            <TextBlock Text="Preview Active" FontSize="11" FontWeight="Bold"
                      Foreground="White" />
          </Border>

          <!-- Loading Indicator -->
          <ProgressBar Grid.Column="1" IsIndeterminate="{Binding IsApplyingTheme}"
                       Background="Transparent" Foreground="{DynamicResource MTM_Shared_Logic.AccentBrush}"
                       Height="4" VerticalAlignment="Center"
                       IsVisible="{Binding IsApplyingTheme}" />

          <!-- Cancel Preview Button -->
          <Button Grid.Column="2" Content="Cancel Preview"
                  Command="{Binding CancelPreviewCommand}"
                  Background="{DynamicResource MTM_Shared_Logic.WarningBrush}"
                  Foreground="White" Padding="16,10" CornerRadius="6"
                  FontWeight="SemiBold" Margin="8,0,0,0"
                  IsVisible="{Binding IsPreviewMode}" />

          <!-- Apply Theme Button -->
          <Button Grid.Column="3" Content="Apply Theme"
                  Command="{Binding ApplyThemeCommand}"
                  Background="{DynamicResource MTM_Shared_Logic.SuccessBrush}"
                  Foreground="White" Padding="16,10" CornerRadius="6"
                  FontWeight="Bold" Margin="8,0,0,0"
                  IsEnabled="{Binding SelectedTheme, Converter={x:Static ObjectConverters.IsNotNull}}" />

          <!-- Quick Apply Current -->
          <Button Grid.Column="4" Content="Quick Apply"
                  Command="{Binding ApplyThemeCommand}"
                  Background="{DynamicResource MTM_Shared_Logic.AccentBrush}"
                  Foreground="White" Padding="16,10" CornerRadius="6"
                  FontWeight="SemiBold" Margin="8,0,0,0"
                  IsVisible="{Binding PreviewTheme, Converter={x:Static ObjectConverters.IsNotNull}}"
                  ToolTip.Tip="Apply the currently previewed theme" />

          <!-- Cancel Button -->
          <Button Grid.Column="5" Content="Cancel"
                  Command="{Binding CancelCommand}"
                  Background="{DynamicResource MTM_Shared_Logic.ButtonSecondaryBrush}"
                  Foreground="{DynamicResource MTM_Shared_Logic.TextPrimaryBrush}"
                  Padding="16,10" CornerRadius="6"
                  FontWeight="SemiBold" Margin="8,0,0,0" />
        </Grid>
      </Border>
    </Grid>
  </ScrollViewer>
</UserControl>
