<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels.Overlay"
             xmlns:materialIcons="using:Material.Icons.Avalonia"
             xmlns:behaviors="using:MTM_WIP_Application_Avalonia.Behaviors"
             mc:Ignorable="d" d:DesignWidth="750" d:DesignHeight="650"
             x:Class="MTM_WIP_Application_Avalonia.Views.Overlay.EditInventoryView"
             x:CompileBindings="True"
             x:DataType="vm:EditInventoryViewModel">

  <UserControl.Styles>
    <!-- MTM Theme Input Field Styles -->
    <Style Selector="TextBox.input-field">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.BodyText}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="Padding" Value="4,2" />
      <Setter Property="MinHeight" Value="24" />
      <Setter Property="HorizontalContentAlignment" Value="Left" />
      <Setter Property="VerticalContentAlignment" Value="Center" />
    </Style>

    <!-- Error state styling -->
    <Style Selector="TextBox.input-field.error">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.ErrorBrush}" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.ErrorLightBrush}" />
    </Style>

    <!-- Success state styling -->
    <Style Selector="TextBox.input-field.success">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.SuccessBrush}" />
    </Style>

    <!-- Focus state styling -->
    <Style Selector="TextBox.input-field:focus">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.FocusBrush}" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.HoverBackground}" />
    </Style>

    <!-- Read-only styling -->
    <Style Selector="TextBox.input-field:disabled">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.DisabledBackground}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.DisabledText}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderLightBrush}" />
      <Setter Property="Opacity" Value="0.7" />
    </Style>

    <!-- ComboBox styling -->
    <Style Selector="ComboBox.input-field">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.BodyText}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="Padding" Value="8,6" />
      <Setter Property="MinHeight" Value="32" />
    </Style>

    <!-- Material Icons global styling -->
    <Style Selector="materialIcons|MaterialIcon">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.InteractiveText}" />
      <Setter Property="HorizontalAlignment" Value="Center" />
      <Setter Property="VerticalAlignment" Value="Center" />
    </Style>

    <!-- Primary Button styling -->
    <Style Selector="Button.primary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="MinHeight" Value="28" />
      <Setter Property="Padding" Value="8,4" />
    </Style>

    <!-- Secondary Button styling -->
    <Style Selector="Button.secondary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.HeadingText}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}" />
      <Setter Property="BorderThickness" Value="1.5" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="MinHeight" Value="28" />
      <Setter Property="Padding" Value="8,4" />
    </Style>

    <Style Selector="Button.secondary:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.HoverBackground}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}" />
    </Style>

    <!-- Warning Button styling -->
    <Style Selector="Button.warning">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.WarningBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.WarningBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="MinHeight" Value="28" />
      <Setter Property="Padding" Value="8,4" />
    </Style>

    <!-- Field label styling -->
    <Style Selector="TextBlock.field-label">
      <Setter Property="FontSize" Value="12" />
      <Setter Property="FontWeight" Value="Medium" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.HeadingText}" />
      <Setter Property="VerticalAlignment" Value="Center" />
    </Style>

    <!-- Status indicator styling -->
    <Style Selector="Border.status-indicator">
      <Setter Property="CornerRadius" Value="3" />
      <Setter Property="Padding" Value="6,3" />
      <Setter Property="HorizontalAlignment" Value="Left" />
    </Style>

    <Style Selector="Border.status-indicator.has-changes">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.WarningLightBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.WarningBrush}" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>

    <Style Selector="Border.status-indicator.validation-error">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.ErrorLightBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.ErrorBrush}" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>
  </UserControl.Styles>

  <!-- Main Dialog Container -->
  <Grid x:Name="MainContainer"
        RowDefinitions="Auto,*,Auto"
                HorizontalAlignment="Stretch"
        Margin="4"
        VerticalAlignment="Stretch">

    <!-- Dialog Header -->
    <Border Grid.Row="0"
            Background="{DynamicResource MTM_Shared_Logic.PrimaryAction}"
            CornerRadius="8,8,0,0"
            Padding="12,6">

      <Grid ColumnDefinitions="*,Auto">
        <StackPanel Grid.Column="0" Spacing="2">
          <TextBlock Text="Edit Inventory Item (Limited Access)"
                     FontSize="14"
                     FontWeight="Bold"
                     Foreground="White" />
          <TextBox Text="{Binding EditModel.PartId, StringFormat='Part: {0} - Only Operation, Quantity &amp; Notes editable', Mode=OneWay}"
                   FontSize="11"
                   MinHeight="22"
                   Classes="input-field"
                   Foreground="White"
                   Opacity="0.9"
                   IsReadOnly="True"
                   Background="Transparent"
                   BorderThickness="0"
                   Padding="0"
                   IsHitTestVisible="False"
                   Focusable="False"
                   IsTabStop="False" />
        </StackPanel>

        <!-- Status Indicators -->
        <StackPanel Grid.Column="1"
                    Orientation="Horizontal"
                    Spacing="4"
                    VerticalAlignment="Center">

          <!-- Changes Indicator -->
          <Border Classes="status-indicator has-changes"
                  IsVisible="{Binding EditModel.HasChanges}">
            <TextBlock Text="● Modified"
                       FontSize="11"
                       Foreground="{DynamicResource MTM_Shared_Logic.WarningBrush}" />
          </Border>

          <!-- Validation Error Indicator -->
          <Border Classes="status-indicator validation-error"
                  IsVisible="{Binding HasValidationErrors}">
            <TextBlock Text="⚠ Errors"
                       FontSize="11"
                       Foreground="{DynamicResource MTM_Shared_Logic.ErrorBrush}" />
          </Border>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Form Content -->
    <Border Grid.Row="1"
            Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
            BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
            BorderThickness="1,0,1,0">

      <ScrollViewer VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Disabled"
                    MaxHeight="480"
                    Padding="12">

        <Grid RowDefinitions="Auto,Auto,*" RowSpacing="6">

        <!-- Validation Error Display -->
        <Border Grid.Row="0"
                Background="{DynamicResource MTM_Shared_Logic.ErrorLightBrush}"
                BorderBrush="{DynamicResource MTM_Shared_Logic.ErrorBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="8,4"
                IsVisible="{Binding HasValidationErrors}">

          <StackPanel Spacing="3">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <materialIcons:MaterialIcon Kind="AlertCircle" Width="14" Height="14"
                                          Foreground="{DynamicResource MTM_Shared_Logic.ErrorBrush}" />
              <TextBlock Text="Please fix validation errors before saving"
                         FontSize="12" FontWeight="SemiBold"
                         Foreground="{DynamicResource MTM_Shared_Logic.ErrorBrush}" />
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- Permission Error Display -->
        <Border Grid.Row="1"
                Background="{DynamicResource MTM_Shared_Logic.WarningLightBrush}"
                BorderBrush="{DynamicResource MTM_Shared_Logic.WarningBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="8,4"
                IsVisible="{Binding !CanEditRecord}">

          <StackPanel Spacing="3">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <materialIcons:MaterialIcon Kind="Lock" Width="14" Height="14"
                                          Foreground="{DynamicResource MTM_Shared_Logic.WarningBrush}" />
              <TextBox Text="{Binding PermissionErrorMessage, Mode=OneWay}"
                       FontSize="11" FontWeight="SemiBold" MinHeight="22"
                                              Classes="input-field"
                       TextWrapping="Wrap"
                       Foreground="{DynamicResource MTM_Shared_Logic.WarningBrush}"
                       IsReadOnly="True"
                       Background="Transparent"
                       BorderThickness="0"
                       Padding="0"
                       IsHitTestVisible="False"
                       Focusable="False"
                       IsTabStop="False" />
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- Form Fields in Compact Layout -->
        <Grid Grid.Row="2" RowDefinitions="Auto,Auto,Auto,*" RowSpacing="6">

          <!-- Row 1: Part ID and Location (Read-Only) -->
          <Grid Grid.Row="0" ColumnDefinitions="*,12,*" >
            <!-- Part ID Field (LOCKED) -->
            <Grid Grid.Column="0" ColumnDefinitions="60,*,20" ColumnSpacing="6">
              <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                <materialIcons:MaterialIcon Kind="Identifier" Width="12" Height="12" />
                <TextBlock Text="Part ID:" Classes="field-label" FontSize="11" />
              </StackPanel>

              <Border Grid.Column="1"
                      Background="{DynamicResource MTM_Shared_Logic.DisabledBackground}"
                      BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                      BorderThickness="1"
                      CornerRadius="4"
                      Padding="4,3"
                      MinHeight="24">
                <TextBox Text="{Binding EditModel.PartId, Mode=OneWay}"
                         Classes="input-field"
                         Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}"
                         FontWeight="SemiBold"
                         FontSize="12"
                         MinHeight="24"
                         VerticalAlignment="Center"
                         IsReadOnly="True"
                         Background="Transparent"
                         BorderThickness="0"
                         Padding="0"
                         IsHitTestVisible="False"
                         Focusable="False"
                         IsTabStop="False"
                         ToolTip.Tip="Part identifier (LOCKED)" />
              </Border>

              <materialIcons:MaterialIcon Grid.Column="2"
                                          Kind="Lock"
                                          Width="12" Height="12"
                                          Foreground="{DynamicResource MTM_Shared_Logic.DisabledText}" />
            </Grid>

            <!-- Location Field (LOCKED) -->
            <Grid Grid.Column="2" ColumnDefinitions="60,*,20" ColumnSpacing="6">
              <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                <materialIcons:MaterialIcon Kind="MapMarker" Width="12" Height="12" />
                <TextBlock Text="Location:" Classes="field-label" FontSize="11" />
              </StackPanel>

              <Border Grid.Column="1"
                      Background="{DynamicResource MTM_Shared_Logic.DisabledBackground}"
                      BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                      BorderThickness="1"
                      CornerRadius="4"
                      Padding="4,3"
                      MinHeight="24">
                <TextBox Text="{Binding EditModel.Location, Mode=OneWay}"
                                       Classes="input-field"
                         Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}"
                         FontWeight="SemiBold"
                         FontSize="12"
                         MinHeight="24"
                         VerticalAlignment="Center"
                         IsReadOnly="True"
                         Background="Transparent"
                         BorderThickness="0"
                         Padding="0"
                         IsHitTestVisible="False"
                         Focusable="False"
                         IsTabStop="False"
                         ToolTip.Tip="Storage location (LOCKED)" />
              </Border>

              <materialIcons:MaterialIcon Grid.Column="2"
                                          Kind="Lock"
                                          Width="12" Height="12"
                                          Foreground="{DynamicResource MTM_Shared_Logic.DisabledText}" />
            </Grid>
          </Grid>

          <!-- Row 2: Operation and Quantity (Editable) -->
          <Grid Grid.Row="1" ColumnDefinitions="*,12,*">
            <!-- Operation Field (EDITABLE) -->
            <Grid Grid.Column="0" ColumnDefinitions="75,*,25" ColumnSpacing="8">
              <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                <materialIcons:MaterialIcon Kind="Cog" Width="14" Height="14" />
                <TextBlock Text="Operation:" Classes="field-label" FontSize="12" />
              </StackPanel>

              <TextBox Grid.Column="1"
                       Text="{Binding EditModel.Operation, Mode=TwoWay}"
                       Classes="input-field"
                       Classes.error="{Binding IsOperationInvalid}"
                       Classes.success="{Binding IsOperationValid}"
                       IsEnabled="{Binding CanEditRecord}"
                       MinHeight="28"
                       FontSize="12"
                       ToolTip.Tip="Operation number (e.g. 90, 100, 110) - EDITABLE"
                       behaviors:TextBoxFuzzyValidationBehavior.EnableFuzzyValidation="{Binding CanEditRecord}"
                       behaviors:TextBoxFuzzyValidationBehavior.ValidationSource="{Binding AvailableOperations}" />

              <materialIcons:MaterialIcon Grid.Column="2"
                                          Kind="CheckCircle"
                                          Width="14" Height="14"
                                          Foreground="{DynamicResource MTM_Shared_Logic.SuccessBrush}"
                                          IsVisible="{Binding IsOperationValid}"
                                          ToolTip.Tip="Valid Operation" />
              <materialIcons:MaterialIcon Grid.Column="2"
                                          Kind="Lock"
                                          Width="14" Height="14"
                                          Foreground="{DynamicResource MTM_Shared_Logic.DisabledText}"
                                          IsVisible="{Binding !CanEditRecord}"
                                          ToolTip.Tip="Field is locked" />
            </Grid>

            <!-- Quantity Field (EDITABLE) -->
            <Grid Grid.Column="2" ColumnDefinitions="75,*,25" ColumnSpacing="8">
              <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                <materialIcons:MaterialIcon Kind="Counter" Width="14" Height="14" />
                <TextBlock Text="Quantity:" Classes="field-label" FontSize="12" />
              </StackPanel>

              <StackPanel Grid.Column="1">
                <TextBox Text="{Binding QuantityText, Mode=TwoWay}"
                         Classes="input-field"
                         Classes.error="{Binding IsQuantityInvalid}"
                         IsEnabled="{Binding CanEditRecord}"
                         MinHeight="28"
                         FontSize="12"
                         ToolTip.Tip="Item quantity - EDITABLE" />

                <!-- Quantity Error Message -->
                <TextBlock Text="{Binding QuantityErrorMessage}"
                           FontSize="11"
                           Foreground="{DynamicResource MTM_Shared_Logic.ErrorBrush}"
                           Margin="2,2,0,0"
                           IsVisible="{Binding IsQuantityInvalid}" />
              </StackPanel>

              <!-- Success icon - only show if can edit and quantity is valid -->
              <materialIcons:MaterialIcon Grid.Column="2"
                                          Kind="CheckCircle"
                                          Width="14" Height="14"
                                          Foreground="Green"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Center"
                                          ToolTip.Tip="Valid Quantity">
                <materialIcons:MaterialIcon.IsVisible>
                  <MultiBinding Converter="{x:Static BoolConverters.And}">
                    <Binding Path="CanEditRecord" />
                    <Binding Path="IsQuantityValid" />
                  </MultiBinding>
                </materialIcons:MaterialIcon.IsVisible>
              </materialIcons:MaterialIcon>

              <!-- Lock icon - only show if cannot edit -->
              <materialIcons:MaterialIcon Grid.Column="2"
                                          Kind="Lock"
                                          Width="14" Height="14"
                                          Foreground="Gray"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Center"
                                          IsVisible="{Binding !CanEditRecord}"
                                          ToolTip.Tip="Field is locked" />
            </Grid>
          </Grid>

          <!-- Row 3: Notes Field (EDITABLE) - With Icon -->
          <Grid Grid.Row="2" ColumnDefinitions="75,*,25" ColumnSpacing="8">
            <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Top" Margin="0,4,0,0">
              <materialIcons:MaterialIcon Kind="NoteText" Width="14" Height="14" />
              <TextBlock Text="Notes:" Classes="field-label" FontSize="12" />
            </StackPanel>

            <TextBox Grid.Column="1"
                     Text="{Binding EditModel.Notes, Mode=TwoWay}"
                     Classes="input-field"
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     HorizontalAlignment="Stretch"
                     VerticalAlignment="Stretch"
                     MinHeight="40"
                     MaxHeight="60"
                     VerticalContentAlignment="Top"
                     FontSize="12"
                     IsEnabled="{Binding CanEditRecord}"
                     ToolTip.Tip="Optional notes or comments - EDITABLE" />

            <!-- Notes field icon - show edit or lock icon -->
            <materialIcons:MaterialIcon Grid.Column="2"
                                        Kind="PencilOutline"
                                        Width="14" Height="14"
                                        Foreground="Green"
                                        VerticalAlignment="Top"
                                        HorizontalAlignment="Center"
                                        Margin="0,8,0,0"
                                        IsVisible="{Binding CanEditRecord}"
                                        ToolTip.Tip="Editable Field" />
            <materialIcons:MaterialIcon Grid.Column="2"
                                        Kind="Lock"
                                        Width="14" Height="14"
                                        Foreground="Gray"
                                        VerticalAlignment="Top"
                                        HorizontalAlignment="Center"
                                        Margin="0,8,0,0"
                                        IsVisible="{Binding !CanEditRecord}"
                                        ToolTip.Tip="Field is locked" />
          </Grid>

          <!-- Row 4: Read-Only Information in Full-Width Expander -->
          <Expander Grid.Row="3"
                    Header="Additional Information"
                    IsExpanded="True"
                    VerticalAlignment="Stretch"
                    VerticalContentAlignment="Stretch"
                    HorizontalAlignment="Stretch"

                    ClipToBounds="True"
                    Margin="0,4,0,4"
                    Grid.ColumnSpan="3">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
              <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="6" Margin="0,0,6,0" VerticalAlignment="Stretch">

              <!-- Row 1: Item Type and Batch Number -->
              <Grid Grid.Row="0" ColumnDefinitions="*,12,*">
                <!-- Item Type -->
                <Grid Grid.Column="0" ColumnDefinitions="75,*,25" ColumnSpacing="8">
                  <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                    <materialIcons:MaterialIcon Kind="Category" Width="12" Height="12" />
                    <TextBlock Text="Item Type:" Classes="field-label" FontSize="11" />
                  </StackPanel>
                  <Border Grid.Column="1"
                          Background="{DynamicResource MTM_Shared_Logic.DisabledBackground}"
                          BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                          BorderThickness="1"
                          CornerRadius="3"
                          Padding="4,2"
                          MinHeight="24">
                    <TextBox Text="{Binding EditModel.ItemType, Mode=OneWay}"
                             Foreground="{DynamicResource MTM_Shared_Logic.BodyText}"
                                                    Classes="input-field"
                       MinHeight="26"
                       FontSize="11"
                             VerticalAlignment="Center"
                             IsReadOnly="True"
                             Background="Transparent"
                             BorderThickness="0"
                             Padding="0"
                             IsHitTestVisible="False"
                             Focusable="False"
                             IsTabStop="False" />
                  </Border>
                  <materialIcons:MaterialIcon Grid.Column="2" Kind="Lock" Width="12" Height="12"
                                              Foreground="{DynamicResource MTM_Shared_Logic.DisabledText}" />
                </Grid>

                <!-- Batch Number -->
                <Grid Grid.Column="2" ColumnDefinitions="75,*,25" ColumnSpacing="8">
                  <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                    <materialIcons:MaterialIcon Kind="Barcode" Width="12" Height="12" />
                    <TextBlock Text="Batch #:" Classes="field-label" FontSize="11" />
                  </StackPanel>
                  <Border Grid.Column="1"
                          Background="{DynamicResource MTM_Shared_Logic.DisabledBackground}"
                          BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                          BorderThickness="1"
                          CornerRadius="3"
                          Padding="4,2"
                          MinHeight="24">
                    <TextBox Text="{Binding EditModel.BatchNumber, Mode=OneWay}"
                                           Classes="input-field"
                             Foreground="{DynamicResource MTM_Shared_Logic.BodyText}"
                                                    MinHeight="26"
                             FontSize="11"
                             VerticalAlignment="Center"
                             IsReadOnly="True"
                             Background="Transparent"
                             BorderThickness="0"
                             Padding="0"
                             IsHitTestVisible="False"
                             Focusable="False"
                             IsTabStop="False" />
                  </Border>
                  <materialIcons:MaterialIcon Grid.Column="2" Kind="Lock" Width="12" Height="12"
                                              Foreground="{DynamicResource MTM_Shared_Logic.DisabledText}" />
                </Grid>
              </Grid>

              <!-- Row 2: User -->
              <Grid Grid.Row="1" ColumnDefinitions="75,*,25" ColumnSpacing="8">
                <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                  <materialIcons:MaterialIcon Kind="Account" Width="12" Height="12" />
                  <TextBlock Text="User:" Classes="field-label" FontSize="11" />
                </StackPanel>
                <Border Grid.Column="1"
                        Background="{DynamicResource MTM_Shared_Logic.DisabledBackground}"
                        BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                        BorderThickness="1"
                        CornerRadius="3"
                        Padding="4,2"
                        MinHeight="24">
                  <TextBox Text="{Binding EditModel.User, Mode=OneWay}"
                                         Classes="input-field"
                                         MinHeight="26"
                           Foreground="{DynamicResource MTM_Shared_Logic.BodyText}"
                           FontSize="11"
                           VerticalAlignment="Center"
                           IsReadOnly="True"
                           Background="Transparent"
                           BorderThickness="0"
                           Padding="0"
                           IsHitTestVisible="False"
                           Focusable="False"
                           IsTabStop="False" />
                </Border>
                <materialIcons:MaterialIcon Grid.Column="2" Kind="Lock" Width="12" Height="12"
                                            Foreground="{DynamicResource MTM_Shared_Logic.DisabledText}" />
              </Grid>

              <!-- Row 3: Timestamps -->
              <Grid Grid.Row="2" ColumnDefinitions="75,*" ColumnSpacing="8">
                <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Top" Margin="0,2,0,0">
                  <materialIcons:MaterialIcon Kind="Clock" Width="12" Height="12" />
                  <TextBlock Text="Timestamps:" Classes="field-label" FontSize="11" />
                </StackPanel>
                <StackPanel Grid.Column="1" Spacing="4">
                  <Border Background="{DynamicResource MTM_Shared_Logic.DisabledBackground}"
                          BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                          BorderThickness="1"
                          CornerRadius="3"
                          Padding="4,2"
                          MinHeight="24">
                    <TextBox Text="{Binding EditModel.ReceiveDate, StringFormat='Created: {0:MM/dd/yyyy HH:mm}', Mode=OneWay}"
                             Foreground="{DynamicResource MTM_Shared_Logic.BodyText}"
                             FontSize="11"
                             MinHeight="26"
                                                    Classes="input-field"
                             VerticalAlignment="Center"
                             IsReadOnly="True"
                             Background="Transparent"
                             BorderThickness="0"
                             Padding="0"
                             IsHitTestVisible="False"
                             Focusable="False"
                             IsTabStop="False" />
                  </Border>
                  <Border Background="{DynamicResource MTM_Shared_Logic.DisabledBackground}"
                          BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                          BorderThickness="1"
                          CornerRadius="3"
                          Padding="4,2"
                          MinHeight="24">
                    <TextBox Text="{Binding EditModel.LastUpdated, StringFormat='Last Updated: {0:MM/dd/yyyy HH:mm}', Mode=OneWay}"
                             Foreground="{DynamicResource MTM_Shared_Logic.BodyText}"
                             FontSize="11"
                                                    Classes="input-field"
                             VerticalAlignment="Center"
                             IsReadOnly="True"
                             Background="Transparent"
                             BorderThickness="0"
                             Padding="0"
                             IsHitTestVisible="False"
                             Focusable="False"
                             IsTabStop="False" />
                  </Border>
                  <!-- Spacer removed - not needed with fixed height -->
                </StackPanel>
              </Grid>
            </Grid>
            </ScrollViewer>
          </Expander>
        </Grid>
      </Grid>

      </ScrollViewer>
    </Border>

    <!-- Dialog Footer with Action Buttons -->
    <Border Grid.Row="2"
            Background="{DynamicResource MTM_Shared_Logic.PanelBackgroundBrush}"
            BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
            BorderThickness="1"
            CornerRadius="0,0,8,8"
            Padding="12,6"
            MinHeight="48">

      <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto" ColumnSpacing="8">

        <!-- Loading Indicator -->
        <StackPanel Grid.Column="0"
                    Orientation="Horizontal"
                    Spacing="8"
                    IsVisible="{Binding IsLoading}"
                    VerticalAlignment="Center">
          <materialIcons:MaterialIcon Kind="Loading"
                                      Width="16" Height="16"
                                      Foreground="{DynamicResource MTM_Shared_Logic.PrimaryAction}" />
          <TextBlock Text="Saving..."
                     FontSize="12"
                     Foreground="{DynamicResource MTM_Shared_Logic.BodyText}" />
        </StackPanel>

        <!-- Spacer -->
        <Border Grid.Column="1" />

        <!-- Revert Changes Button -->
        <Button Grid.Column="2"
                Classes="warning"
                Width="90"
                Command="{Binding RevertCommand}"
                IsEnabled="{Binding EditModel.HasChanges}"
                ToolTip.Tip="Revert all changes to original values">
          <StackPanel Orientation="Horizontal" Spacing="4">
            <materialIcons:MaterialIcon Kind="Undo" Width="12" Height="12" />
            <TextBlock Text="Revert" FontSize="11" />
          </StackPanel>
        </Button>

        <!-- Cancel Button -->
        <Button Grid.Column="3"
                Classes="secondary"
                Width="80"
                Command="{Binding CancelCommand}"
                ToolTip.Tip="Cancel editing and close dialog">
          <StackPanel Orientation="Horizontal" Spacing="4">
            <materialIcons:MaterialIcon Kind="Close" Width="12" Height="12" />
            <TextBlock Text="Cancel" FontSize="11" />
          </StackPanel>
        </Button>

        <!-- Save Button -->
        <Button Grid.Column="4"
                Classes="primary"
                Width="80"
                Command="{Binding SaveCommand}"
                IsEnabled="{Binding CanSave}"
                ToolTip.Tip="Save changes to inventory item">
          <StackPanel Orientation="Horizontal" Spacing="4">
            <materialIcons:MaterialIcon Kind="ContentSave" Width="12" Height="12" />
            <TextBlock Text="Save" FontSize="11" />
          </StackPanel>
        </Button>

      </Grid>
    </Border>

  </Grid>

</UserControl>
