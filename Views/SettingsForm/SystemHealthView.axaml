<UserControl xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels.SettingsForm" mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600" x:Class="MTM_WIP_Application_Avalonia.Views.SettingsForm.SystemHealthView" x:DataType="vm:SystemHealthViewModel">

    <!-- System Health &amp; Diagnostics Panel -->
    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
        <StackPanel Spacing="16">
            
            <!-- Header Section -->
            <Border Background="#2196F3" CornerRadius="8" Padding="16">
                <StackPanel>
                    <TextBlock Text="🩺 System Health &amp; Diagnostics" FontSize="20" FontWeight="Bold" Foreground="#212121" HorizontalAlignment="Center" />
                    <TextBlock Text="Monitor system status, performance, and troubleshoot issues" FontSize="14" Foreground="#212121" HorizontalAlignment="Center" Margin="0,4,0,0" />
                </StackPanel>
            </Border>

            <!-- Database Connection Status -->
            <Border Background="#FFFFFF" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Padding="16">
                
                <Grid RowDefinitions="Auto,Auto,Auto">
                    <TextBlock Grid.Row="0" Text="🗄️ Database Connection" FontSize="16" FontWeight="SemiBold" Foreground="#212121" Margin="0,0,0,12" />
                    
                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                        <StackPanel Grid.Column="0" Spacing="8">
                            <TextBlock Text="{Binding DatabaseConnectionStatus}" FontSize="14" Foreground="#424242" />
                            
                            <Border Background="#4CAF50" CornerRadius="12" Padding="8,4" HorizontalAlignment="Left" IsVisible="{Binding IsDatabaseConnected}">
                                <TextBlock Text="● Connected" FontSize="12" Foreground="#212121" FontWeight="SemiBold" />
                            </Border>
                            
                            <Border Background="#F44336" CornerRadius="12" Padding="8,4" HorizontalAlignment="Left" IsVisible="{Binding !IsDatabaseConnected}">
                                <TextBlock Text="● Disconnected" FontSize="12" Foreground="#212121" FontWeight="SemiBold" />
                            </Border>
                        </StackPanel>
                        
                        <Button Grid.Column="1" Content="🔄 Test Connection" Classes="mtm-primary" Command="{Binding TestDatabaseConnectionCommand}" IsEnabled="{Binding !IsTesting}" Height="36" />
                    </Grid>
                </Grid>
            </Border>

            <!-- System Performance Metrics -->
            <Border Background="#FFFFFF" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Padding="16">
                
                <Grid RowDefinitions="Auto,Auto">
                    <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,12">
                        <TextBlock Grid.Column="0" Text="📊 System Performance Metrics" FontSize="16" FontWeight="SemiBold" Foreground="#212121" />
                        
                        <Button Grid.Column="1" Content="🔄 Refresh" Classes="mtm-secondary" Command="{Binding RefreshMetricsCommand}" IsEnabled="{Binding !IsTesting}" Height="32" />
                    </Grid>
                    
                    <ItemsControl Grid.Row="1" ItemsSource="{Binding SystemMetrics}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="2" Rows="2" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#F5F5F5" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="6" Padding="12" Margin="4">
                                    
                                    <StackPanel Spacing="4">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <TextBlock Text="{Binding Icon}" FontSize="16" />
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" Foreground="#212121" />
                                        </StackPanel>
                                        
                                        <TextBlock Text="{Binding Value}" FontSize="18" FontWeight="Bold" Foreground="#2196F3" />
                                        
                                        <TextBlock Text="{Binding Timestamp, StringFormat='Updated: {0:HH:mm:ss}'}" FontSize="10" Foreground="#424242" />
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>
            </Border>

            <!-- System Information Summary -->
            <Border Background="#FFFFFF" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Padding="16">
                
                <Grid RowDefinitions="Auto,Auto">
                    <TextBlock Grid.Row="0" Text="💻 System Information" FontSize="16" FontWeight="SemiBold" Foreground="#212121" Margin="0,0,0,12" />
                    
                    <Grid Grid.Row="1" ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto,Auto">
                        <!-- Performance Level -->
                        <StackPanel Grid.Column="0" Grid.Row="0" Spacing="4">
                            <TextBlock Text="⚡ Performance" FontWeight="SemiBold" Foreground="#424242" />
                            <TextBlock Text="{Binding SystemPerformance}" Foreground="#212121" />
                        </StackPanel>
                        
                        <!-- Memory Usage -->
                        <StackPanel Grid.Column="1" Grid.Row="0" Spacing="4">
                            <TextBlock Text="💾 Memory" FontWeight="SemiBold" Foreground="#424242" />
                            <TextBlock Text="{Binding MemoryUsage}" Foreground="#212121" />
                        </StackPanel>
                        
                        <!-- Log File Size -->
                        <StackPanel Grid.Column="2" Grid.Row="0" Spacing="4">
                            <TextBlock Text="📄 Logs" FontWeight="SemiBold" Foreground="#424242" />
                            <TextBlock Text="{Binding LogFileSize}" Foreground="#212121" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>

            <!-- Recent Log Entries -->
            <Border Background="#FFFFFF" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Padding="16">
                
                <Grid RowDefinitions="Auto,*,Auto">
                    <TextBlock Grid.Row="0" Text="📋 Recent Log Entries" FontSize="16" FontWeight="SemiBold" Foreground="#212121" Margin="0,0,0,12" />
                    
                    <ScrollViewer Grid.Row="1" Height="200" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding LogEntries}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#F5F5F5" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Padding="8">
                                        
                                        <Grid ColumnDefinitions="80,60,*">
                                            <TextBlock Grid.Column="0" Text="{Binding FormattedTimestamp}" FontSize="12" FontFamily="Consolas,Courier New" Foreground="#424242" />
                                            
                                            <Border Grid.Column="1" Background="#2196F3" CornerRadius="4" Padding="4,2" HorizontalAlignment="Left">
                                                <TextBlock Text="{Binding Level}" FontSize="10" FontWeight="SemiBold" Foreground="#FFFFFF" />
                                            </Border>
                                            
                                            <TextBlock Grid.Column="2" Text="{Binding Message}" FontSize="12" Foreground="#212121" TextWrapping="Wrap" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- Log Actions -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right" Margin="0,12,0,0">
                        
                        <Button Content="🗑️ Clear Logs" Classes="mtm-secondary" Command="{Binding ClearLogsCommand}" Height="32" />
                        
                        <Button Content="📄 Export Report" Classes="mtm-primary" Command="{Binding ExportDiagnosticsCommand}" IsEnabled="{Binding !IsTesting}" Height="32" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Loading Indicator -->
            <Border Background="#FF9800" CornerRadius="8" Padding="12" IsVisible="{Binding IsTesting}">
                
                <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center">
                    <ProgressBar IsIndeterminate="True" Width="120" Height="6" />
                    <TextBlock Text="Running diagnostics..." Foreground="#212121" FontWeight="SemiBold" />
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>

</UserControl>
