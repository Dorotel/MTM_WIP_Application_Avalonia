<UserControl xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels.SettingsForm" mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600" x:Class="MTM_WIP_Application_Avalonia.Views.SettingsForm.SecurityPermissionsView" x:DataType="vm:SecurityPermissionsViewModel">

    <!-- Security &amp; Permissions Panel -->
    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
        <StackPanel Spacing="16">
            
            <!-- Header Section -->
            <Border Background="#2196F3" CornerRadius="8" Padding="16">
                <StackPanel>
                    <TextBlock Text="🔒 Security &amp; Permissions" FontSize="20" FontWeight="Bold" Foreground="#212121" HorizontalAlignment="Center" />
                    <TextBlock Text="Manage user roles, permissions, and security settings" FontSize="14" Foreground="#212121" HorizontalAlignment="Center" Margin="0,4,0,0" />
                </StackPanel>
            </Border>

            <!-- Password Policy -->
            <Border Background="#FFFFFF" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Padding="16">
                
                <Grid RowDefinitions="Auto,Auto">
                    <TextBlock Grid.Row="0" Text="🔐 Password Policy" FontSize="16" FontWeight="SemiBold" Foreground="#212121" Margin="0,0,0,16" />
                    
                    <Grid Grid.Row="1" ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto">
                        <!-- Password Requirements -->
                        <StackPanel Grid.Column="0" Grid.Row="0" Spacing="12">
                            <CheckBox IsChecked="{Binding RequirePasswordChange}" Content="Require password change on first login" />
                            
                            <CheckBox IsChecked="{Binding RequireSpecialCharacters}" Content="Require special characters" />
                            
                            <CheckBox IsChecked="{Binding RequireNumbers}" Content="Require numbers in passwords" />
                        </StackPanel>
                        
                        <!-- Numeric Settings -->
                        <StackPanel Grid.Column="1" Grid.Row="0" Spacing="12">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Minimum Password Length" FontWeight="SemiBold" Foreground="#424242" />
                                <NumericUpDown Value="{Binding PasswordMinLength}" Minimum="4" Maximum="32" Width="100" HorizontalAlignment="Left" />
                            </StackPanel>
                            
                            <StackPanel Spacing="4">
                                <TextBlock Text="Session Timeout (minutes)" FontWeight="SemiBold" Foreground="#424242" />
                                <NumericUpDown Value="{Binding SessionTimeoutMinutes}" Minimum="5" Maximum="480" Width="100" HorizontalAlignment="Left" />
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Audit Logging -->
                        <StackPanel Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2" Spacing="8" Margin="0,16,0,0">
                            <CheckBox IsChecked="{Binding EnableAuditLogging}" Content="Enable security audit logging" />
                            <TextBlock Text="Log all security-related events including logins, permission changes, and system access" FontSize="12" Foreground="#424242" TextWrapping="Wrap" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>

            <!-- User Roles Management -->
            <Border Background="#FFFFFF" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Padding="16">
                
                <Grid RowDefinitions="Auto,*,Auto">
                    <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,12">
                        <TextBlock Grid.Column="0" Text="👥 User Roles Management" FontSize="16" FontWeight="SemiBold" Foreground="#212121" />
                        
                        <Button Grid.Column="1" Content="➕ Add Role" Classes="mtm-primary" Command="{Binding AddRoleCommand}" Height="32" />
                    </Grid>
                    
                    <ScrollViewer Grid.Row="1" Height="250" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding UserRoles}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#F5F5F5" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="6" Padding="16" Margin="0,4">
                                        
                                        <Grid ColumnDefinitions="*,Auto,Auto">
                                            <!-- Role Information -->
                                            <StackPanel Grid.Column="0" Spacing="8">
                                                <Grid ColumnDefinitions="*,Auto">
                                                    <StackPanel Grid.Column="0">
                                                        <TextBlock Text="{Binding RoleName}" FontSize="16" FontWeight="Bold" Foreground="#212121" />
                                                        <TextBlock Text="{Binding Description}" FontSize="12" Foreground="#424242" TextWrapping="Wrap" />
                                                    </StackPanel>
                                                    
                                                    <Border Grid.Column="1" Background="#2196F3" CornerRadius="12" Padding="8,4">
                                                        <TextBlock Text="{Binding UserCount, StringFormat={}{0} users}" FontSize="12" FontWeight="SemiBold" Foreground="#FFFFFF" />
                                                    </Border>
                                                </Grid>
                                                
                                                <!-- Permissions Display -->
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <Border Background="#4CAF50" CornerRadius="4" Padding="4,2" IsVisible="{Binding CanAddItems}">
                                                        <TextBlock Text="Add" FontSize="10" Foreground="#212121" />
                                                    </Border>
                                                    
                                                    <Border Background="#FF9800" CornerRadius="4" Padding="4,2" IsVisible="{Binding CanEditItems}">
                                                        <TextBlock Text="Edit" FontSize="10" Foreground="#212121" />
                                                    </Border>
                                                    
                                                    <Border Background="#F44336" CornerRadius="4" Padding="4,2" IsVisible="{Binding CanDeleteItems}">
                                                        <TextBlock Text="Delete" FontSize="10" Foreground="#212121" />
                                                    </Border>
                                                    
                                                    <Border Background="#757575" CornerRadius="4" Padding="4,2" IsVisible="{Binding CanViewReports}">
                                                        <TextBlock Text="Reports" FontSize="10" Foreground="#212121" />
                                                    </Border>
                                                    
                                                    <Border Background="#2196F3" CornerRadius="4" Padding="4,2" IsVisible="{Binding CanManageUsers}">
                                                        <TextBlock Text="Admin" FontSize="10" Foreground="#FFFFFF" />
                                                    </Border>
                                                </StackPanel>
                                            </StackPanel>
                                            
                                            <!-- Action Buttons -->
                                            <Button Grid.Column="1" Content="✏️" Classes="mtm-secondary" Command="{Binding $parent[ItemsControl].((vm:SecurityPermissionsViewModel)DataContext).EditRoleCommand}" CommandParameter="{Binding}" Width="32" Height="32" Margin="8,0" />
                                            
                                            <Button Grid.Column="2" Content="🗑️" Classes="mtm-danger" Command="{Binding $parent[ItemsControl].((vm:SecurityPermissionsViewModel)DataContext).DeleteRoleCommand}" CommandParameter="{Binding}" Width="32" Height="32" Margin="4,0,0,0" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- Active Sessions -->
            <Border Background="#FFFFFF" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Padding="16">
                
                <Grid RowDefinitions="Auto,*">
                    <TextBlock Grid.Row="0" Text="🖥️ Active User Sessions" FontSize="16" FontWeight="SemiBold" Foreground="#212121" Margin="0,0,0,12" />
                    
                    <ScrollViewer Grid.Row="1" Height="150" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding ActiveSessions}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#F5F5F5" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Padding="12,8">
                                        
                                        <Grid ColumnDefinitions="*,Auto,Auto,Auto,Auto">
                                            <!-- User Info -->
                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="{Binding UserName}" FontWeight="SemiBold" Foreground="#212121" />
                                                <TextBlock Text="{Binding IpAddress}" FontSize="12" Foreground="#424242" />
                                            </StackPanel>
                                            
                                            <!-- Login Time -->
                                            <StackPanel Grid.Column="1" Margin="8,0">
                                                <TextBlock Text="Login" FontSize="10" Foreground="#424242" />
                                                <TextBlock Text="{Binding FormattedLoginTime}" FontSize="12" Foreground="#212121" />
                                            </StackPanel>
                                            
                                            <!-- Duration -->
                                            <StackPanel Grid.Column="2" Margin="8,0">
                                                <TextBlock Text="Duration" FontSize="10" Foreground="#424242" />
                                                <TextBlock Text="{Binding FormattedDuration}" FontSize="12" Foreground="#2196F3" />
                                            </StackPanel>
                                            
                                            <!-- Status -->
                                            <Border Grid.Column="3" Background="#4CAF50" CornerRadius="4" Padding="6,2" Margin="8,0">
                                                <TextBlock Text="{Binding Status}" FontSize="10" FontWeight="SemiBold" Foreground="#212121" />
                                            </Border>
                                            
                                            <!-- End Session Button -->
                                            <Button Grid.Column="4" Content="🚪" Classes="mtm-danger" Command="{Binding $parent[ItemsControl].((vm:SecurityPermissionsViewModel)DataContext).EndSessionCommand}" CommandParameter="{Binding}" Width="32" Height="28" Margin="8,0,0,0" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- Security Audit Log -->
            <Border Background="#FFFFFF" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Padding="16">
                
                <Grid RowDefinitions="Auto,*,Auto">
                    <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,12">
                        <TextBlock Grid.Column="0" Text="📋 Security Audit Log" FontSize="16" FontWeight="SemiBold" Foreground="#212121" />
                        
                        <Button Grid.Column="1" Content="📄 Export Log" Classes="mtm-secondary" Command="{Binding ExportAuditLogCommand}" Height="32" />
                    </Grid>
                    
                    <ScrollViewer Grid.Row="1" Height="200" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding SecurityAuditLog}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#F5F5F5" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Padding="8">
                                        
                                        <Grid ColumnDefinitions="140,100,80,80,*">
                                            <!-- Timestamp -->
                                            <TextBlock Grid.Column="0" Text="{Binding FormattedTimestamp}" FontSize="12" FontFamily="Consolas,Courier New" Foreground="#424242" />
                                            
                                            <!-- Action -->
                                            <Border Grid.Column="1" Background="#2196F3" CornerRadius="4" Padding="4,2" Margin="4,0" HorizontalAlignment="Left">
                                                <TextBlock Text="{Binding Action}" FontSize="10" FontWeight="SemiBold" Foreground="#FFFFFF" />
                                            </Border>
                                            
                                            <!-- User -->
                                            <TextBlock Grid.Column="2" Text="{Binding User}" FontSize="12" FontWeight="SemiBold" Foreground="#212121" />
                                            
                                            <!-- Result -->
                                            <Border Grid.Column="3" Background="#4CAF50" CornerRadius="4" Padding="4,2" Margin="4,0" HorizontalAlignment="Left">
                                                <TextBlock Text="{Binding Result}" FontSize="10" FontWeight="SemiBold" Foreground="#212121" />
                                            </Border>
                                            
                                            <!-- Details -->
                                            <TextBlock Grid.Column="4" Text="{Binding Details}" FontSize="12" Foreground="#212121" TextWrapping="Wrap" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- Loading Indicator -->
            <Border Background="#FF9800" CornerRadius="8" Padding="12" IsVisible="{Binding IsLoading}">
                
                <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center">
                    <ProgressBar IsIndeterminate="True" Width="120" Height="6" />
                    <TextBlock Text="Processing security operations..." Foreground="#212121" FontWeight="SemiBold" />
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>

</UserControl>
