<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels.MainForm"
             xmlns:materialIcons="using:Material.Icons.Avalonia"
             mc:Ignorable="d"
             d:DesignWidth="800"
             d:DesignHeight="600"
             x:Class="MTM_WIP_Application_Avalonia.Views.InventoryTabView"
             x:CompileBindings="True"
             x:DataType="vm:InventoryTabViewModel">

  <UserControl.Resources>
    <!-- Theme resources will be provided by DynamicResource bindings -->
    <!-- Remove hardcoded colors and use theme resources from App.axaml -->
  </UserControl.Resources>

  <UserControl.Styles>
    <!-- Color-Only Theme Styles - No Layout/Sizing Changes -->
    <Style Selector="TextBox.input-field">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}"/>
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.PrimaryTextBrush}"/>
    </Style>

    <!-- Error state styling - Color only -->
    <Style Selector="TextBox.input-field.error">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.ErrorBrush}"/>
    </Style>

    <!-- AutoCompleteBox Color Theme -->
    <Style Selector="AutoCompleteBox.input-field">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}"/>
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.PrimaryTextBrush}"/>
    </Style>

    <!-- Error state styling for AutoCompleteBox - Color only -->
    <Style Selector="AutoCompleteBox.input-field.error">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.ErrorBrush}"/>
    </Style>

    <!-- Loading indicator for AutoCompleteBox - Color only -->
    <Style Selector="AutoCompleteBox.input-field.loading">
      <Setter Property="Background" Value="#F0F0F0"/>
    </Style>

    <!-- Button Color Themes -->
    <Style Selector="Button.primary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.LightTextBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.PrimaryBrush}"/>
    </Style>
    <Style Selector="Button.primary:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryDarkBrush}"/>
    </Style>

    <Style Selector="Button.secondary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.PrimaryTextBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}"/>
    </Style>
    <Style Selector="Button.secondary:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.LightTextBrush}"/>
    </Style>

    <!-- Error message color styling -->
    <Style Selector="TextBlock.error-message">
      <Setter Property="Foreground" Value="{StaticResource ErrorBrush}"/>
    </Style>
  </UserControl.Styles>

  <!-- Main container with proper spacing -->
  <Grid RowDefinitions="*,Auto" 
        HorizontalAlignment="Stretch" 
        VerticalAlignment="Stretch"
        Margin="0"
        Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}">

    <!-- Main Panel -->
    <Border Grid.Row="0"
            Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
            BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Padding="4"
            Margin="4"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">
      
      <!-- Inventory Entry Form -->
      <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,*">
        
        <!-- Header -->
        <Border Grid.Row="0" 
                Background="{StaticResource PrimaryBrush}"
                CornerRadius="3"
                Padding="6,4"
                Margin="0,0,0,4">
          <Grid ColumnDefinitions="Auto,*,Auto">
            <materialIcons:MaterialIcon Grid.Column="0"
                                        Kind="Package"
                                        Width="14"
                                        Height="14"
                                        Foreground="White"
                                        VerticalAlignment="Center"
                                        Margin="0,0,4,0"/>
            <TextBlock Grid.Column="1"
                       Text="Inventory Entry"
                       FontSize="11"
                       FontWeight="SemiBold"
                       Foreground="White"
                       VerticalAlignment="Center"/>
          </Grid>
        </Border>

        <!-- Error Message Display -->
        <Border Grid.Row="1" 
                IsVisible="{Binding HasError}"
                Background="#FFE6E6"
                BorderBrush="{StaticResource ErrorBrush}"
                BorderThickness="1"
                CornerRadius="3"
                Padding="6,4"
                Margin="0,0,0,4">
          <TextBlock Text="{Binding ErrorMessage}"
                     Classes="error-message"
                     TextWrapping="Wrap"/>
        </Border>

        <!-- Part ID -->
        <StackPanel Grid.Row="2" Spacing="2" Margin="0,2">
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
            <materialIcons:MaterialIcon Grid.Column="0"
                                        Kind="Identifier"
                                        Width="10"
                                        Height="10"
                                        Foreground="{DynamicResource MTM_Shared_Logic.AccentTextBrush}"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Part ID"/>
            <TextBlock Grid.Column="1"
                       Text="Part ID:"
                       FontSize="9"
                       VerticalAlignment="Center"
                       Foreground="{DynamicResource MTM_Shared_Logic.PrimaryTextBrush}"/>
          </Grid>
          <AutoCompleteBox x:Name="PartAutoCompleteBox"
                          ItemsSource="{Binding PartIds}"
                          Text="{Binding SelectedPart, Mode=TwoWay}"
                          Classes="input-field"
                          Classes.error="{Binding !IsPartValid}"
                          Classes.loading="{Binding IsLoadingParts}"
                          HorizontalAlignment="Stretch"
                          Watermark="Select or enter part ID..."
                          ToolTip.Tip="Select or enter a part number"
                          TabIndex="1"
                          MinimumPrefixLength="1"
                          FilterMode="Contains"
                          MaxDropDownHeight="200"/>
        </StackPanel>

        <!-- Operation -->
        <StackPanel Grid.Row="3" Spacing="2" Margin="0,2">
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
            <materialIcons:MaterialIcon Grid.Column="0"
                                        Kind="Cog"
                                        Width="10"
                                        Height="10"
                                        Foreground="{DynamicResource MTM_Shared_Logic.AccentTextBrush}"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Operation"/>
            <TextBlock Grid.Column="1"
                       Text="Operation:"
                       FontSize="9"
                       VerticalAlignment="Center"
                       Foreground="{DynamicResource MTM_Shared_Logic.PrimaryTextBrush}"/>
          </Grid>
          <AutoCompleteBox x:Name="OperationAutoCompleteBox"
                          ItemsSource="{Binding Operations}"
                          Text="{Binding SelectedOperation, Mode=TwoWay}"
                          Classes="input-field"
                          Classes.error="{Binding !IsOperationValid}"
                          Classes.loading="{Binding IsLoadingOperations}"
                          HorizontalAlignment="Stretch"
                          Watermark="Select operation..."
                          ToolTip.Tip="Select an operation number"
                          TabIndex="2"
                          MinimumPrefixLength="0"
                          FilterMode="StartsWith"
                          MaxDropDownHeight="200"/>
        </StackPanel>

        <!-- Location -->
        <StackPanel Grid.Row="4" Spacing="2" Margin="0,2">
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
            <materialIcons:MaterialIcon Grid.Column="0"
                                        Kind="MapMarker"
                                        Width="10"
                                        Height="10"
                                        Foreground="{DynamicResource MTM_Shared_Logic.AccentTextBrush}"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Location"/>
            <TextBlock Grid.Column="1"
                       Text="Location:"
                       FontSize="9"
                       VerticalAlignment="Center"
                       Foreground="{DynamicResource MTM_Shared_Logic.PrimaryTextBrush}"/>
          </Grid>
          <AutoCompleteBox x:Name="LocationAutoCompleteBox"
                          ItemsSource="{Binding Locations}"
                          Text="{Binding SelectedLocation, Mode=TwoWay}"
                          Classes="input-field"
                          Classes.error="{Binding !IsLocationValid}"
                          Classes.loading="{Binding IsLoadingLocations}"
                          HorizontalAlignment="Stretch"
                          Watermark="Select location..."
                          ToolTip.Tip="Select a location"
                          TabIndex="3"
                          MinimumPrefixLength="0"
                          FilterMode="StartsWith"
                          MaxDropDownHeight="200"/>
        </StackPanel>

        <!-- Quantity -->
        <StackPanel Grid.Row="5" Spacing="2" Margin="0,2">
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
            <materialIcons:MaterialIcon Grid.Column="0"
                                        Kind="Counter"
                                        Width="10"
                                        Height="10"
                                        Foreground="{DynamicResource MTM_Shared_Logic.AccentTextBrush}"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Quantity"/>
            <TextBlock Grid.Column="1"
                       Text="Quantity:"
                       FontSize="9"
                       VerticalAlignment="Center"
                       Foreground="{DynamicResource MTM_Shared_Logic.PrimaryTextBrush}"/>
          </Grid>
          <TextBox x:Name="QuantityTextBox"
                   Text="{Binding Quantity, Mode=TwoWay}"
                   Classes="input-field"
                   Classes.error="{Binding !IsQuantityValid}"
                   HorizontalAlignment="Stretch"
                   Watermark="Enter quantity..."
                   ToolTip.Tip="Enter numeric quantity"
                   TabIndex="4"/>
        </StackPanel>

        <!-- Notes -->
        <StackPanel Grid.Row="6" Spacing="2" Margin="0,2">
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
            <materialIcons:MaterialIcon Grid.Column="0"
                                        Kind="NoteText"
                                        Width="10"
                                        Height="10"
                                        Foreground="{DynamicResource MTM_Shared_Logic.AccentTextBrush}"
                                        VerticalAlignment="Top"
                                        Margin="0,4,0,0"
                                        ToolTip.Tip="Notes"/>
            <TextBlock Grid.Column="1"
                       Text="Notes:"
                       FontSize="9"
                       VerticalAlignment="Center"
                       Foreground="{DynamicResource MTM_Shared_Logic.PrimaryTextBrush}"/>
          </Grid>
          <TextBox x:Name="NotesTextBox"
                   Text="{Binding Notes, Mode=TwoWay}"
                   Classes="input-field"
                   HorizontalAlignment="Stretch"
                   VerticalAlignment="Stretch"
                   AcceptsReturn="True"
                   TextWrapping="Wrap"
                   MinHeight="60"
                   Watermark="Optional notes..."
                   ToolTip.Tip="Optional notes or comments"
                   TabIndex="5"/>
        </StackPanel>

      </Grid>
    </Border>

    <!-- Compact Bottom Action Panel -->
    <Border Grid.Row="1"
            Background="{StaticResource CardBackgroundBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Padding="6"
            Margin="4,0,4,4">
      <Grid ColumnDefinitions="*,Auto">
        <!-- Left side buttons -->
        <StackPanel Grid.Column="0" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Left" 
                    Spacing="4">
          <Button x:Name="SaveButton"
                  Classes="action-button primary"
                  Width="60" 
                  Height="24"
                  Command="{Binding SaveCommand}"
                  IsEnabled="{Binding CanSave}"
                  ToolTip.Tip="Save inventory item (Enter to execute)"
                  TabIndex="6">
            <StackPanel Orientation="Horizontal" Spacing="3" 
                        HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="ContentSave" Width="10" Height="10"/>
              <TextBlock Text="Save" FontSize="9"/>
            </StackPanel>
          </Button>
          
          <Button Classes="action-button secondary"
                  Width="70" 
                  Height="24"
                  Command="{Binding AdvancedEntryCommand}"
                  ToolTip.Tip="Open advanced inventory features">
            <StackPanel Orientation="Horizontal" Spacing="3"
                        HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="Settings" Width="10" Height="10"/>
              <TextBlock Text="Advanced" FontSize="9"/>
            </StackPanel>
          </Button>
          
          <Button Classes="action-button secondary"
                  Width="50" 
                  Height="24"
                  Command="{Binding ResetCommand}"
                  CommandParameter="False"
                  ToolTip.Tip="Reset form (F5 for soft reset, Shift+F5 for hard reset)">
            <StackPanel Orientation="Horizontal" Spacing="3"
                        HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="Refresh" Width="10" Height="10"/>
              <TextBlock Text="Reset" FontSize="9"/>
            </StackPanel>
          </Button>
          
          <Button Classes="action-button secondary"
                  Width="50" 
                  Height="24"
                  Command="{Binding TogglePanelCommand}"
                  ToolTip.Tip="Toggle quick actions panel">
            <StackPanel Orientation="Horizontal" Spacing="3"
                        HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="ViewDashboard" Width="10" Height="10"/>
              <TextBlock Text="Panel" FontSize="9"/>
            </StackPanel>
          </Button>
        </StackPanel>

        <!-- Right side - version and loading indicator -->
        <StackPanel Grid.Column="1" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Spacing="8">
          <!-- Loading indicator -->
          <ProgressBar IsVisible="{Binding IsLoading}"
                       IsIndeterminate="True"
                       Width="80"
                       Height="16"
                       VerticalAlignment="Center"/>
          
          <!-- Version info -->
          <TextBlock Text="{Binding VersionText}"
                     FontSize="8"
                     Foreground="{DynamicResource MTM_Shared_Logic.PrimaryTextBrush}"
                     Opacity="0.7"
                     VerticalAlignment="Center"/>
        </StackPanel>
      </Grid>
    </Border>
  </Grid>
</UserControl>
