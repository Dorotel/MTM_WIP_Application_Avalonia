<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels"
             xmlns:materialIcons="using:Material.Icons.Avalonia"
             mc:Ignorable="d"
             d:DesignWidth="800"
             d:DesignHeight="600"
             x:Class="MTM_WIP_Application_Avalonia.Views.InventoryTabView"
             x:CompileBindings="True"
             x:DataType="vm:InventoryTabViewModel">

  <UserControl.Resources>
    <!-- MTM Color Scheme -->
    <SolidColorBrush x:Key="PrimaryBrush" Color="#6a0dad"/>           <!-- MTM Purple -->
    <SolidColorBrush x:Key="PrimaryDarkBrush" Color="#4a0880"/>       <!-- Dark MTM Purple -->
    <SolidColorBrush x:Key="SecondaryBrush" Color="#F5F5DC"/>         <!-- Beige -->
    <SolidColorBrush x:Key="CardBackgroundBrush" Color="#FFFFFF"/>    <!-- White -->
    <SolidColorBrush x:Key="BorderBrush" Color="#E0E0E0"/>            <!-- Light Gray -->
    <SolidColorBrush x:Key="PrimaryTextBrush" Color="#000000"/>       <!-- Black Text -->
    <SolidColorBrush x:Key="AccentBrush" Color="#4169E1"/>            <!-- Royal Blue for icons -->
    <SolidColorBrush x:Key="ErrorBrush" Color="#DC3545"/>             <!-- Error Red -->
    <SolidColorBrush x:Key="SuccessBrush" Color="#28A745"/>           <!-- Success Green -->
  </UserControl.Resources>

  <UserControl.Styles>
    <!-- Compact Input Styles -->
    <Style Selector="TextBox.input-field">
      <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="3"/>
      <Setter Property="Padding" Value="6,3"/>
      <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}"/>
      <Setter Property="FontSize" Value="10"/>
      <Setter Property="MinHeight" Value="24"/>
      <Setter Property="Margin" Value="2"/>
    </Style>

    <!-- Error state styling -->
    <Style Selector="TextBox.input-field.error">
      <Setter Property="BorderBrush" Value="{StaticResource ErrorBrush}"/>
      <Setter Property="BorderThickness" Value="2"/>
    </Style>

    <!-- AutoCompleteBox Styling -->
    <Style Selector="AutoCompleteBox.input-field">
      <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="3"/>
      <Setter Property="Padding" Value="6,3"/>
      <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}"/>
      <Setter Property="FontSize" Value="10"/>
      <Setter Property="MinHeight" Value="24"/>
      <Setter Property="Margin" Value="2"/>
      <Setter Property="MinimumPrefixLength" Value="0"/>
      <Setter Property="FilterMode" Value="Contains"/>
      <Setter Property="MaxDropDownHeight" Value="200"/>
    </Style>

    <!-- Error state styling for AutoCompleteBox -->
    <Style Selector="AutoCompleteBox.input-field.error">
      <Setter Property="BorderBrush" Value="{StaticResource ErrorBrush}"/>
      <Setter Property="BorderThickness" Value="2"/>
    </Style>

    <!-- Loading indicator for AutoCompleteBox -->
    <Style Selector="AutoCompleteBox.input-field.loading">
      <Setter Property="Background" Value="#F0F0F0"/>
    </Style>

    <!-- Compact Button Styles -->
    <Style Selector="Button.action-button">
      <Setter Property="Padding" Value="6,3"/>
      <Setter Property="Margin" Value="2"/>
      <Setter Property="FontSize" Value="10"/>
      <Setter Property="FontWeight" Value="Medium"/>
      <Setter Property="CornerRadius" Value="3"/>
      <Setter Property="MinHeight" Value="24"/>
      <Setter Property="Cursor" Value="Hand"/>
      <Setter Property="HorizontalContentAlignment" Value="Center"/>
      <Setter Property="VerticalContentAlignment" Value="Center"/>
    </Style>
    
    <Style Selector="Button.primary">
      <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
      <Setter Property="BorderThickness" Value="1"/>
    </Style>
    <Style Selector="Button.primary:pointerover">
      <Setter Property="Background" Value="{StaticResource PrimaryDarkBrush}"/>
    </Style>

    <Style Selector="Button.secondary">
      <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}"/>
      <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
      <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
      <Setter Property="BorderThickness" Value="1"/>
    </Style>
    <Style Selector="Button.secondary:pointerover">
      <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
      <Setter Property="Foreground" Value="White"/>
    </Style>

    <!-- Error message style -->
    <Style Selector="TextBlock.error-message">
      <Setter Property="Foreground" Value="{StaticResource ErrorBrush}"/>
      <Setter Property="FontSize" Value="9"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="Margin" Value="4,2,4,4"/>
    </Style>
  </UserControl.Styles>

  <!-- Main container with proper spacing -->
  <Grid RowDefinitions="*,Auto" 
        HorizontalAlignment="Stretch" 
        VerticalAlignment="Stretch"
        Margin="0"
        Background="{StaticResource CardBackgroundBrush}">

    <!-- Main Panel -->
    <Border Grid.Row="0"
            Background="{StaticResource CardBackgroundBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Padding="4"
            Margin="4"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">
      
      <!-- Inventory Entry Form -->
      <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,*">
        
        <!-- Header -->
        <Border Grid.Row="0" 
                Background="{StaticResource PrimaryBrush}"
                CornerRadius="3"
                Padding="6,4"
                Margin="0,0,0,4">
          <Grid ColumnDefinitions="Auto,*,Auto">
            <materialIcons:MaterialIcon Grid.Column="0"
                                        Kind="Package"
                                        Width="14"
                                        Height="14"
                                        Foreground="White"
                                        VerticalAlignment="Center"
                                        Margin="0,0,4,0"/>
            <TextBlock Grid.Column="1"
                       Text="Inventory Entry"
                       FontSize="11"
                       FontWeight="SemiBold"
                       Foreground="White"
                       VerticalAlignment="Center"/>
          </Grid>
        </Border>

        <!-- Error Message Display -->
        <Border Grid.Row="1" 
                IsVisible="{Binding HasError}"
                Background="#FFE6E6"
                BorderBrush="{StaticResource ErrorBrush}"
                BorderThickness="1"
                CornerRadius="3"
                Padding="6,4"
                Margin="0,0,0,4">
          <TextBlock Text="{Binding ErrorMessage}"
                     Classes="error-message"
                     TextWrapping="Wrap"/>
        </Border>

        <!-- Part ID -->
        <StackPanel Grid.Row="2" Spacing="2" Margin="0,2">
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
            <materialIcons:MaterialIcon Grid.Column="0"
                                        Kind="Identifier"
                                        Width="10"
                                        Height="10"
                                        Foreground="{StaticResource AccentBrush}"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Part ID"/>
            <TextBlock Grid.Column="1"
                       Text="Part ID:"
                       FontSize="9"
                       VerticalAlignment="Center"
                       Foreground="{StaticResource PrimaryTextBrush}"/>
          </Grid>
          <AutoCompleteBox x:Name="PartAutoCompleteBox"
                          ItemsSource="{Binding PartOptions}"
                          Text="{Binding SelectedPart, Mode=TwoWay}"
                          Classes="input-field"
                          Classes.error="{Binding !IsPartValid}"
                          Classes.loading="{Binding IsLoadingParts}"
                          HorizontalAlignment="Stretch"
                          Watermark="Select or enter part ID..."
                          ToolTip.Tip="Select or enter a part number"
                          TabIndex="1"
                          MinimumPrefixLength="1"
                          FilterMode="Contains"
                          MaxDropDownHeight="200"/>
        </StackPanel>

        <!-- Operation -->
        <StackPanel Grid.Row="3" Spacing="2" Margin="0,2">
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
            <materialIcons:MaterialIcon Grid.Column="0"
                                        Kind="Cog"
                                        Width="10"
                                        Height="10"
                                        Foreground="{StaticResource AccentBrush}"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Operation"/>
            <TextBlock Grid.Column="1"
                       Text="Operation:"
                       FontSize="9"
                       VerticalAlignment="Center"
                       Foreground="{StaticResource PrimaryTextBrush}"/>
          </Grid>
          <AutoCompleteBox x:Name="OperationAutoCompleteBox"
                          ItemsSource="{Binding OperationOptions}"
                          Text="{Binding SelectedOperation, Mode=TwoWay}"
                          Classes="input-field"
                          Classes.error="{Binding !IsOperationValid}"
                          Classes.loading="{Binding IsLoadingOperations}"
                          HorizontalAlignment="Stretch"
                          Watermark="Select operation..."
                          ToolTip.Tip="Select an operation number"
                          TabIndex="2"
                          MinimumPrefixLength="0"
                          FilterMode="StartsWith"
                          MaxDropDownHeight="200"/>
        </StackPanel>

        <!-- Location -->
        <StackPanel Grid.Row="4" Spacing="2" Margin="0,2">
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
            <materialIcons:MaterialIcon Grid.Column="0"
                                        Kind="MapMarker"
                                        Width="10"
                                        Height="10"
                                        Foreground="{StaticResource AccentBrush}"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Location"/>
            <TextBlock Grid.Column="1"
                       Text="Location:"
                       FontSize="9"
                       VerticalAlignment="Center"
                       Foreground="{StaticResource PrimaryTextBrush}"/>
          </Grid>
          <AutoCompleteBox x:Name="LocationAutoCompleteBox"
                          ItemsSource="{Binding LocationOptions}"
                          Text="{Binding SelectedLocation, Mode=TwoWay}"
                          Classes="input-field"
                          Classes.error="{Binding !IsLocationValid}"
                          Classes.loading="{Binding IsLoadingLocations}"
                          HorizontalAlignment="Stretch"
                          Watermark="Select location..."
                          ToolTip.Tip="Select a location"
                          TabIndex="3"
                          MinimumPrefixLength="0"
                          FilterMode="StartsWith"
                          MaxDropDownHeight="200"/>
        </StackPanel>

        <!-- Quantity -->
        <StackPanel Grid.Row="5" Spacing="2" Margin="0,2">
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
            <materialIcons:MaterialIcon Grid.Column="0"
                                        Kind="Counter"
                                        Width="10"
                                        Height="10"
                                        Foreground="{StaticResource AccentBrush}"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Quantity"/>
            <TextBlock Grid.Column="1"
                       Text="Quantity:"
                       FontSize="9"
                       VerticalAlignment="Center"
                       Foreground="{StaticResource PrimaryTextBrush}"/>
          </Grid>
          <TextBox x:Name="QuantityTextBox"
                   Text="{Binding Quantity, Mode=TwoWay}"
                   Classes="input-field"
                   Classes.error="{Binding !IsQuantityValid}"
                   HorizontalAlignment="Stretch"
                   Watermark="Enter quantity..."
                   ToolTip.Tip="Enter numeric quantity"
                   TabIndex="4"/>
        </StackPanel>

        <!-- Notes -->
        <StackPanel Grid.Row="6" Spacing="2" Margin="0,2">
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
            <materialIcons:MaterialIcon Grid.Column="0"
                                        Kind="NoteText"
                                        Width="10"
                                        Height="10"
                                        Foreground="{StaticResource AccentBrush}"
                                        VerticalAlignment="Top"
                                        Margin="0,4,0,0"
                                        ToolTip.Tip="Notes"/>
            <TextBlock Grid.Column="1"
                       Text="Notes:"
                       FontSize="9"
                       VerticalAlignment="Center"
                       Foreground="{StaticResource PrimaryTextBrush}"/>
          </Grid>
          <TextBox x:Name="NotesTextBox"
                   Text="{Binding Notes, Mode=TwoWay}"
                   Classes="input-field"
                   HorizontalAlignment="Stretch"
                   VerticalAlignment="Stretch"
                   AcceptsReturn="True"
                   TextWrapping="Wrap"
                   MinHeight="60"
                   Watermark="Optional notes..."
                   ToolTip.Tip="Optional notes or comments"
                   TabIndex="5"/>
        </StackPanel>

      </Grid>
    </Border>

    <!-- Compact Bottom Action Panel -->
    <Border Grid.Row="1"
            Background="{StaticResource CardBackgroundBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Padding="6"
            Margin="4,0,4,4">
      <Grid ColumnDefinitions="*,Auto">
        <!-- Left side buttons -->
        <StackPanel Grid.Column="0" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Left" 
                    Spacing="4">
          <Button x:Name="SaveButton"
                  Classes="action-button primary"
                  Width="60" 
                  Height="24"
                  Command="{Binding SaveCommand}"
                  IsEnabled="{Binding CanSave}"
                  ToolTip.Tip="Save inventory item (Enter to execute)"
                  TabIndex="6">
            <StackPanel Orientation="Horizontal" Spacing="3" 
                        HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="ContentSave" Width="10" Height="10"/>
              <TextBlock Text="Save" FontSize="9"/>
            </StackPanel>
          </Button>
          
          <Button Classes="action-button secondary"
                  Width="70" 
                  Height="24"
                  Command="{Binding AdvancedEntryCommand}"
                  ToolTip.Tip="Open advanced inventory features">
            <StackPanel Orientation="Horizontal" Spacing="3"
                        HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="Settings" Width="10" Height="10"/>
              <TextBlock Text="Advanced" FontSize="9"/>
            </StackPanel>
          </Button>
          
          <Button Classes="action-button secondary"
                  Width="50" 
                  Height="24"
                  Command="{Binding ResetCommand}"
                  CommandParameter="False"
                  ToolTip.Tip="Reset form (F5 for soft reset, Shift+F5 for hard reset)">
            <StackPanel Orientation="Horizontal" Spacing="3"
                        HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="Refresh" Width="10" Height="10"/>
              <TextBlock Text="Reset" FontSize="9"/>
            </StackPanel>
          </Button>
          
          <Button Classes="action-button secondary"
                  Width="50" 
                  Height="24"
                  Command="{Binding TogglePanelCommand}"
                  ToolTip.Tip="Toggle quick actions panel">
            <StackPanel Orientation="Horizontal" Spacing="3"
                        HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="ViewDashboard" Width="10" Height="10"/>
              <TextBlock Text="Panel" FontSize="9"/>
            </StackPanel>
          </Button>
        </StackPanel>

        <!-- Right side - version and loading indicator -->
        <StackPanel Grid.Column="1" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Spacing="8">
          <!-- Loading indicator -->
          <ProgressBar IsVisible="{Binding IsLoading}"
                       IsIndeterminate="True"
                       Width="80"
                       Height="16"
                       VerticalAlignment="Center"/>
          
          <!-- Version info -->
          <TextBlock Text="{Binding VersionText}"
                     FontSize="8"
                     Foreground="{StaticResource PrimaryTextBrush}"
                     Opacity="0.7"
                     VerticalAlignment="Center"/>
        </StackPanel>
      </Grid>
    </Border>
  </Grid>
</UserControl>
