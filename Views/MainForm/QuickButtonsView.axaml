<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels"
             mc:Ignorable="d"
             d:DesignWidth="240"
             d:DesignHeight="600"
             x:Class="MTM_WIP_Application_Avalonia.Views.QuickButtonsView"
             x:CompileBindings="True"
             x:DataType="vm:QuickButtonsViewModel">

  <UserControl.Resources>
    <!-- Resources are now provided by DynamicResource bindings from MTM_Amber.axaml -->
  </UserControl.Resources>

  <UserControl.Styles>
    <!-- MTM Amber Theme Quick Button Styles -->
    <Style Selector="Button.quick-button">
      <Setter Property="Padding" Value="8,8"/>
      <Setter Property="Margin" Value="3,2"/>
      <Setter Property="HorizontalAlignment" Value="Stretch"/>
      <Setter Property="VerticalAlignment" Value="Stretch"/>
      <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
      <Setter Property="VerticalContentAlignment" Value="Center"/>
      <Setter Property="CornerRadius" Value="6"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}"/>
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.BodyText}"/>
      <Setter Property="MinHeight" Value="36"/>
      <Setter Property="Cursor" Value="Hand"/>
      <Setter Property="FontWeight" Value="Medium"/>
    </Style>
    
    <Style Selector="Button.quick-button:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.HoverBackground}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}"/>
      <Setter Property="BorderThickness" Value="2"/>
    </Style>
    
    <Style Selector="Button.quick-button:pressed">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.SecondaryAction}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.TextonDark}"/>
    </Style>

    <!-- MTM Position indicator style -->
    <Style Selector="Border.position-indicator">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="Width" Value="24"/>
      <Setter Property="Height" Value="24"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>

    <!-- MTM Content text styles -->
    <Style Selector="TextBlock.primary-text">
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.HeadingText}"/>
      <Setter Property="TextWrapping" Value="Wrap"/>
      <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
    </Style>

    <Style Selector="TextBlock.secondary-text">
      <Setter Property="FontSize" Value="10"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.TertiaryTextBrush}"/>
      <Setter Property="TextWrapping" Value="Wrap"/>
      <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
    </Style>

    <Style Selector="TextBlock.operation-text">
      <Setter Property="FontSize" Value="10"/>
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.InteractiveText}"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
      <Setter Property="Margin" Value="4,0,0,0"/>
    </Style>

    <!-- MTM Drag and drop styling -->
    <Style Selector="Button.draggable-button">
      <Setter Property="Cursor" Value="Hand"/>
    </Style>
    
    <Style Selector="Button.draggable-button:pointerover Border.drag-handle">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryHoverBrush}"/>
    </Style>
    
    <Style Selector="Button.selected-for-drag">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.FocusBrush}"/>
      <Setter Property="BorderThickness" Value="2"/>
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.SelectionBrush}"/>
    </Style>
    
    <Style Selector="Button.dragging">
      <Setter Property="Opacity" Value="0.8"/>
      <Setter Property="RenderTransform" Value="scale(1.02)"/>
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.ProcessingBrush}"/>
    </Style>
    
    <Style Selector="Button.drop-target">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.HoverBackground}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.HighlightTextBrush}"/>
      <Setter Property="BorderThickness" Value="2"/>
    </Style>

    <!-- Header panel styling -->
    <Style Selector="Border.header-panel">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.SidebarGradientBrush}"/>
      <Setter Property="CornerRadius" Value="6,6,0,0"/>
    </Style>

    <!-- Context menu styling -->
    <Style Selector="ContextMenu">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="4"/>
    </Style>

    <Style Selector="MenuItem">
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.BodyText}"/>
      <Setter Property="Background" Value="Transparent"/>
    </Style>

    <Style Selector="MenuItem:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.HoverBackground}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.HeadingText}"/>
    </Style>
  </UserControl.Styles>

  <!-- Main container with MTM Amber background -->
  <Grid Margin="4" Background="{DynamicResource MTM_Shared_Logic.MainBackground}">
    <!-- Header Section and Quick Buttons Area -->
    <Grid RowDefinitions="Auto,*">
      <!-- Quick Actions Header with MTM Amber gradient -->
      <Border Grid.Row="0"
              Classes="header-panel"
              Padding="12,8"
              Margin="0,0,0,8">
        <Grid ColumnDefinitions="Auto,*,Auto">
          <!-- MTM Industrial Icon -->
          <Border Grid.Column="0"
                  Background="{DynamicResource MTM_Shared_Logic.TextonDark}"
                  CornerRadius="12"
                  Width="20"
                  Height="20"
                  VerticalAlignment="Center"
                  Margin="0,0,8,0">
            <TextBlock Text="âš¡"
                       FontSize="12"
                       Foreground="{DynamicResource MTM_Shared_Logic.PrimaryAction}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       ToolTip.Tip="Quick Actions"/>
          </Border>
          
          <!-- Title with MTM styling -->
          <TextBlock Grid.Column="1"
                     Text="Quick Actions"
                     FontSize="14"
                     FontWeight="Bold"
                     Foreground="{DynamicResource MTM_Shared_Logic.TextonDark}"
                     VerticalAlignment="Center"/>
          
          <!-- Count indicator with MTM accent -->
          <StackPanel Grid.Column="2" 
                      Orientation="Horizontal" 
                      Spacing="6">
            <Border Background="{DynamicResource MTM_Shared_Logic.TextonDark}"
                    CornerRadius="8"
                    Padding="6,2">
              <StackPanel Orientation="Horizontal" Spacing="4">
                <TextBlock Text="{Binding NonEmptyQuickButtonsCount}"
                           FontSize="11"
                           FontWeight="Bold"
                           Foreground="{DynamicResource MTM_Shared_Logic.PrimaryAction}"
                           VerticalAlignment="Center"/>
                <TextBlock Text="actions"
                           FontSize="10"
                           Foreground="{DynamicResource MTM_Shared_Logic.BodyText}"
                           VerticalAlignment="Center"/>
              </StackPanel>
            </Border>
          </StackPanel>
        </Grid>
      </Border>

      <!-- Quick Buttons Area with MTM styling and drag/drop support -->
      <ScrollViewer Grid.Row="1" 
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Disabled"
                    Background="{DynamicResource MTM_Shared_Logic.PanelBackgroundBrush}"
                    CornerRadius="0,0,6,6"
                    Padding="4">
        <ItemsControl ItemsSource="{Binding NonEmptyQuickButtons}">
          <!-- Use StackPanel for dynamic vertical layout with drag/drop -->
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <StackPanel Orientation="Vertical" Spacing="4"/>
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate DataType="vm:QuickButtonItemViewModel">
              <Button Classes="quick-button draggable-button"
                      Command="{Binding $parent[UserControl].((vm:QuickButtonsViewModel)DataContext).ExecuteQuickActionCommand}"
                      CommandParameter="{Binding}"
                      ToolTip.Tip="{Binding ToolTipText}"
                      PointerPressed="OnButtonPointerPressed"
                      PointerMoved="OnButtonPointerMoved"
                      PointerReleased="OnButtonPointerReleased">
                <Button.ContextMenu>
                  <ContextMenu>
                    <MenuItem Header="ðŸ—‘ï¸ Remove Button"
                              Click="OnRemoveButtonClick"
                              ToolTip.Tip="Delete this quick action"/>
                    <Separator/>
                    <MenuItem Header="â†‘ Move Up"
                              Command="{Binding $parent[UserControl].((vm:QuickButtonsViewModel)DataContext).MoveButtonUpCommand}"
                              CommandParameter="{Binding}"
                              ToolTip.Tip="Move button up in order"/>
                    <MenuItem Header="â†“ Move Down"
                              Command="{Binding $parent[UserControl].((vm:QuickButtonsViewModel)DataContext).MoveButtonDownCommand}"
                              CommandParameter="{Binding}"
                              ToolTip.Tip="Move button down in order"/>
                    <Separator/>
                    <MenuItem Header="ðŸ”„ Refresh Buttons"
                              Command="{Binding $parent[UserControl].((vm:QuickButtonsViewModel)DataContext).RefreshButtonsCommand}"
                              ToolTip.Tip="Reload quick actions from database"/>
                    <MenuItem Header="ðŸ§¹ Clear All Buttons"
                              Command="{Binding $parent[UserControl].((vm:QuickButtonsViewModel)DataContext).ClearAllButtonsCommand}"
                              ToolTip.Tip="Remove all quick actions"/>
                    <MenuItem Header="â†•ï¸ Reset Order"
                              Command="{Binding $parent[UserControl].((vm:QuickButtonsViewModel)DataContext).ResetOrderCommand}"
                              ToolTip.Tip="Restore default button order"/>
                  </ContextMenu>
                </Button.ContextMenu>
                <Grid ColumnDefinitions="Auto,8,*,Auto">
                  <!-- MTM Industrial position indicator with drag handle -->
                  <Border Grid.Column="0" Classes="position-indicator drag-handle">
                    <Grid>
                      <!-- Position number with MTM styling -->
                      <TextBlock Text="{Binding Position}"
                                 Foreground="{DynamicResource MTM_Shared_Logic.TextonDark}"
                                 FontSize="11"
                                 FontWeight="Bold"
                                 HorizontalAlignment="Center"
                                 VerticalAlignment="Center"
                                 ToolTip.Tip="Drag to reorder"/>
                      <!-- Industrial drag dots overlay -->
                      <Canvas HorizontalAlignment="Right" VerticalAlignment="Bottom" 
                              Width="8" Height="8" Margin="0,0,2,2">
                        <Ellipse Width="1.5" Height="1.5" Fill="{DynamicResource MTM_Shared_Logic.TextonDark}" 
                                 Canvas.Left="0" Canvas.Top="0" Opacity="0.8"/>
                        <Ellipse Width="1.5" Height="1.5" Fill="{DynamicResource MTM_Shared_Logic.TextonDark}" 
                                 Canvas.Left="3" Canvas.Top="0" Opacity="0.8"/>
                        <Ellipse Width="1.5" Height="1.5" Fill="{DynamicResource MTM_Shared_Logic.TextonDark}" 
                                 Canvas.Left="6" Canvas.Top="0" Opacity="0.8"/>
                        <Ellipse Width="1.5" Height="1.5" Fill="{DynamicResource MTM_Shared_Logic.TextonDark}" 
                                 Canvas.Left="0" Canvas.Top="3" Opacity="0.8"/>
                        <Ellipse Width="1.5" Height="1.5" Fill="{DynamicResource MTM_Shared_Logic.TextonDark}" 
                                 Canvas.Left="3" Canvas.Top="3" Opacity="0.8"/>
                        <Ellipse Width="1.5" Height="1.5" Fill="{DynamicResource MTM_Shared_Logic.TextonDark}" 
                                 Canvas.Left="6" Canvas.Top="3" Opacity="0.8"/>
                        <Ellipse Width="1.5" Height="1.5" Fill="{DynamicResource MTM_Shared_Logic.TextonDark}" 
                                 Canvas.Left="0" Canvas.Top="6" Opacity="0.8"/>
                        <Ellipse Width="1.5" Height="1.5" Fill="{DynamicResource MTM_Shared_Logic.TextonDark}" 
                                 Canvas.Left="3" Canvas.Top="6" Opacity="0.8"/>
                        <Ellipse Width="1.5" Height="1.5" Fill="{DynamicResource MTM_Shared_Logic.TextonDark}" 
                                 Canvas.Left="6" Canvas.Top="6" Opacity="0.8"/>
                      </Canvas>
                    </Grid>
                  </Border>
                  
                  <!-- Button content with MTM typography -->
                  <StackPanel Grid.Column="2" Spacing="2" VerticalAlignment="Center">
                    <TextBlock Text="{Binding DisplayText}"
                               Classes="primary-text"/>
                    <TextBlock Text="{Binding SubText}"
                               Classes="secondary-text"/>
                  </StackPanel>
                  
                  <!-- Operation indicator with MTM accent color -->
                  <Border Grid.Column="3"
                          Background="{DynamicResource MTM_Shared_Logic.InteractiveText}"
                          CornerRadius="4"
                          Padding="6,2"
                          VerticalAlignment="Center">
                    <TextBlock Text="{Binding Operation}"
                               Foreground="{DynamicResource MTM_Shared_Logic.TextonDark}"
                               FontSize="10"
                               FontWeight="Bold"
                               ToolTip.Tip="Operation Number"/>
                  </Border>
                </Grid>
              </Button>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </Grid>
  </Grid>
</UserControl>
