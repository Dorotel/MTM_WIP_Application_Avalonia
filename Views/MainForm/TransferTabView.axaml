<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels"
             xmlns:controls="using:Avalonia.Controls"
             xmlns:materialIcons="using:Material.Icons.Avalonia"
             mc:Ignorable="d"
             d:DesignWidth="800"
             d:DesignHeight="600"
             x:Class="MTM_WIP_Application_Avalonia.Views.TransferTabView"
             x:CompileBindings="True"
             x:DataType="vm:TransferItemViewModel">

  <UserControl.Styles>
    <!-- Input field styles with MTM theme -->
    <Style Selector="ComboBox.input-field">
      <Setter Property="Margin" Value="4"/>
      <Setter Property="Padding" Value="8,4"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}"/>
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"/>
    </Style>
    
    <!-- NumericUpDown styles -->
    <Style Selector="NumericUpDown.input-field">
      <Setter Property="Margin" Value="4"/>
      <Setter Property="Padding" Value="8,4"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}"/>
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"/>
    </Style>
    
    <!-- Label styles -->
    <Style Selector="TextBlock.field-label">
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="FontWeight" Value="Medium"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
      <Setter Property="Margin" Value="4,0"/>
      <Setter Property="HorizontalAlignment" Value="Right"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.PrimaryTextBrush}"/>
    </Style>

    <!-- Button styles -->
    <Style Selector="Button.action-button">
      <Setter Property="Padding" Value="12,6"/>
      <Setter Property="Margin" Value="4"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="FontWeight" Value="Medium"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="MinWidth" Value="80"/>
    </Style>
    
    <Style Selector="Button.primary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.LightTextBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.PrimaryBrush}"/>
    </Style>
    <Style Selector="Button.primary:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryHoverBrush}"/>
    </Style>
    <Style Selector="Button.primary:disabled">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryDisabledBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.SecondaryTextBrush}"/>
    </Style>

    <Style Selector="Button.secondary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.PrimaryTextBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}"/>
      <Setter Property="BorderThickness" Value="1"/>
    </Style>
    <Style Selector="Button.secondary:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.LightTextBrush}"/>
    </Style>

    <Style Selector="Button.transfer">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.SuccessBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.LightTextBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.SuccessBrush}"/>
    </Style>
    <Style Selector="Button.transfer:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.SuccessHoverBrush}"/>
    </Style>
    <Style Selector="Button.transfer:disabled">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.SecondaryTextBrush}"/>
    </Style>

    <Style Selector="DataGrid">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="GridLinesVisibility" Value="Horizontal"/>
      <Setter Property="HeadersVisibility" Value="Column"/>
      <Setter Property="CanUserReorderColumns" Value="True"/>
      <Setter Property="CanUserResizeColumns" Value="True"/>
      <Setter Property="CanUserSortColumns" Value="True"/>
      <Setter Property="SelectionMode" Value="Single"/>
    </Style>

    <!-- Transfer configuration styles -->
    <Style Selector="Border.transfer-config">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.SuccessLightBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.SuccessBrush}"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="Padding" Value="8"/>
      <Setter Property="Margin" Value="4"/>
    </Style>
  </UserControl.Styles>

  <!-- Main container with proper stretching layout -->
  <Grid RowDefinitions="Auto,Auto,Auto,*,Auto"
        HorizontalAlignment="Stretch"
        VerticalAlignment="Stretch"
        Background="{DynamicResource MTM_Shared_Logic.AppBackgroundBrush}">
    
    <!-- Header -->
    <StackPanel Grid.Row="0" 
                Orientation="Horizontal" 
                Margin="8,4" 
                Spacing="8"
                HorizontalAlignment="Left">
      <materialIcons:MaterialIcon Kind="SwapHorizontal" 
                                  Width="16" 
                                  Height="16" 
                                  Foreground="{DynamicResource MTM_Shared_Logic.SuccessBrush}"
                                  VerticalAlignment="Center"/>
      <TextBlock Text="Inventory Transfer"
                 FontSize="14"
                 FontWeight="SemiBold"
                 VerticalAlignment="Center"
                 Foreground="{DynamicResource MTM_Shared_Logic.PrimaryTextBrush}"/>
    </StackPanel>
    
    <!-- Search Controls Row -->
    <Border Grid.Row="1"
            BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
            Margin="4,2"
            Padding="8">
      <Grid ColumnDefinitions="Auto,*,Auto,*,Auto,Auto"
            HorizontalAlignment="Stretch">
        
        <!-- Part ID ComboBox -->
        <TextBlock Grid.Column="0"
                   Classes="field-label"
                   Text="Part ID:"/>
        <ComboBox Grid.Column="1"
                  x:Name="Control_TransferTab_ComboBox_Part"
                  Classes="input-field"
                  PlaceholderText="Select Part ID"
                  HorizontalAlignment="Stretch"
                  ItemsSource="{Binding PartOptions}"
                  SelectedItem="{Binding SelectedPart, Mode=TwoWay}"
                  IsTextSearchEnabled="True"
                  ToolTip.Tip="Select or search for a part number"/>

        <!-- Operation ComboBox -->
        <TextBlock Grid.Column="2"
                   Classes="field-label"
                   Text="Operation:"
                   Margin="16,0,4,0"/>
        <ComboBox Grid.Column="3"
                  x:Name="Control_TransferTab_ComboBox_Operation"
                  Classes="input-field"
                  PlaceholderText="Select Operation"
                  HorizontalAlignment="Stretch"
                  ItemsSource="{Binding OperationOptions}"
                  SelectedItem="{Binding SelectedOperation, Mode=TwoWay}"
                  ToolTip.Tip="Select an operation number (optional)"/>

        <!-- Search Button -->
        <Button Grid.Column="4"
                x:Name="Control_TransferTab_Button_Search"
                Classes="action-button primary"
                Command="{Binding SearchCommand}"
                ToolTip.Tip="Search inventory (F5)"
                Margin="8,4,4,4">
          <StackPanel Orientation="Horizontal" Spacing="6">
            <materialIcons:MaterialIcon Kind="Magnify" 
                                        Width="14" 
                                        Height="14"/>
            <TextBlock Text="Search"/>
          </StackPanel>
        </Button>

        <!-- Reset Button -->
        <Button Grid.Column="5"
                x:Name="Control_TransferTab_Button_Reset"
                Classes="action-button secondary"
                Command="{Binding ResetCommand}"
                ToolTip.Tip="Reset search criteria and refresh all data">
          <StackPanel Orientation="Horizontal" Spacing="6">
            <materialIcons:MaterialIcon Kind="Refresh" 
                                        Width="14" 
                                        Height="14"/>
            <TextBlock Text="Reset"/>
          </StackPanel>
        </Button>
      </Grid>
    </Border>

    <!-- Transfer Configuration Row -->
    <Border Grid.Row="2" 
            Classes="transfer-config"
            Margin="4,2">
      <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto,*" 
            Margin="4"
            HorizontalAlignment="Stretch">
        
        <!-- To Location Label and ComboBox -->
        <TextBlock Grid.Column="0"
                   Classes="field-label"
                   Text="To Location:"
                   Margin="0,0,8,0"/>
        <ComboBox Grid.Column="1"
                  x:Name="Control_TransferTab_ComboBox_ToLocation"
                  Classes="input-field"
                  PlaceholderText="Select Destination"
                  HorizontalAlignment="Stretch"
                  ItemsSource="{Binding LocationOptions}"
                  SelectedItem="{Binding SelectedToLocation, Mode=TwoWay}"
                  ToolTip.Tip="Select the destination location for transfer"/>

        <!-- Quantity Label and NumericUpDown -->
        <TextBlock Grid.Column="2"
                   Classes="field-label"
                   Text="Quantity:"
                   Margin="16,0,8,0"/>
        <NumericUpDown Grid.Column="3"
                       x:Name="Control_TransferTab_NumericUpDown_Quantity"
                       Classes="input-field"
                       Value="{Binding TransferQuantity, Mode=TwoWay}"
                       Minimum="1"
                       Maximum="{Binding MaxTransferQuantity}"
                       Width="100"
                       ToolTip.Tip="Specify the quantity to transfer"/>

        <!-- Max Quantity Display -->
        <TextBlock Grid.Column="4"
                   Text="{Binding MaxTransferQuantity, StringFormat='/ {0}'}"
                   VerticalAlignment="Center"
                   Margin="4,0,0,0"
                   FontSize="11"
                   Opacity="0.7"
                   Foreground="{DynamicResource MTM_Shared_Logic.SecondaryTextBrush}"
                   ToolTip.Tip="Maximum available quantity"/>
        
        <!-- Transfer Button -->
        <Button Grid.Column="5"
                x:Name="Control_TransferTab_Button_Transfer"
                Classes="action-button transfer"
                Command="{Binding TransferCommand}"
                IsEnabled="{Binding CanTransfer}"
                HorizontalAlignment="Right"
                Margin="16,0,0,0"
                ToolTip.Tip="Execute transfer operation (Enter key)">
          <StackPanel Orientation="Horizontal" Spacing="6">
            <materialIcons:MaterialIcon Kind="ArrowRightBold" 
                                        Width="14" 
                                        Height="14" 
                                        Foreground="White"/>
            <TextBlock Text="Transfer"/>
          </StackPanel>
        </Button>
      </Grid>
    </Border>

    <!-- Data Display Area -->
    <Border Grid.Row="3"
            BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
            Margin="4,2"
            Padding="4"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">
      <Panel x:Name="Control_TransferTab_Panel_DataGridView"
             HorizontalAlignment="Stretch"
             VerticalAlignment="Stretch">
        <!-- Main DataGrid -->
        <DataGrid x:Name="Control_TransferTab_DataGridView_Main"
                  ItemsSource="{Binding InventoryItems}"
                  SelectedItem="{Binding SelectedInventoryItem, Mode=TwoWay}"
                  IsVisible="{Binding HasInventoryItems}"
                  AutoGenerateColumns="False"
                  SelectionMode="Single"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch">
          <DataGrid.Columns>
            <DataGridTextColumn Header="Location" 
                                Binding="{Binding Location}" 
                                Width="*"/>
            <DataGridTextColumn Header="Part ID" 
                                Binding="{Binding PartId}" 
                                Width="*"/>
            <DataGridTextColumn Header="Operation" 
                                Binding="{Binding Operation}" 
                                Width="Auto"/>
            <DataGridTextColumn Header="Quantity" 
                                Binding="{Binding Quantity}" 
                                Width="Auto"/>
            <DataGridTextColumn Header="Batch #" 
                                Binding="{Binding BatchNumber}" 
                                Width="Auto"/>
            <DataGridTextColumn Header="Notes" 
                                Binding="{Binding Notes}" 
                                Width="2*"/>
            <DataGridTextColumn Header="Last Updated" 
                                Binding="{Binding LastUpdated, StringFormat='{}{0:MM/dd/yy HH:mm}'}" 
                                Width="Auto"/>
          </DataGrid.Columns>
        </DataGrid>

        <!-- Nothing Found Display -->
        <StackPanel x:Name="Control_TransferTab_Image_NothingFound"
                   IsVisible="{Binding !HasInventoryItems}"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Orientation="Vertical"
                   Spacing="12">
          <Border Background="{DynamicResource MTM_Shared_Logic.BorderBrush}"
                  CornerRadius="60"
                  Width="120" Height="120"
                  HorizontalAlignment="Center">
            <materialIcons:MaterialIcon Kind="PackageVariant" 
                                        Width="60" 
                                        Height="60"
                                        Foreground="{DynamicResource MTM_Shared_Logic.SuccessBrush}"
                                        Opacity="0.6"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
          </Border>
          <TextBlock Text="No inventory items found"
                     HorizontalAlignment="Center"
                     FontSize="12"
                     FontWeight="Medium"
                     Opacity="0.7"
                     Foreground="{DynamicResource MTM_Shared_Logic.SecondaryTextBrush}"/>
          <TextBlock Text="Use the search criteria above to find items for transfer"
                     HorizontalAlignment="Center"
                     FontSize="10"
                     Opacity="0.5"
                     TextWrapping="Wrap"
                     TextAlignment="Center"
                     MaxWidth="200"
                     Foreground="{DynamicResource MTM_Shared_Logic.SecondaryTextBrush}"/>
        </StackPanel>
      </Panel>
    </Border>

    <!-- Action Controls Row -->
    <Border Grid.Row="4"
            BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
            Margin="4,2"
            Padding="8">
      <Grid ColumnDefinitions="Auto,Auto,*,Auto"
            HorizontalAlignment="Stretch">
        
        <!-- Selected Item Info -->
        <StackPanel Grid.Column="0" 
                    Orientation="Horizontal" 
                    Spacing="8"
                    VerticalAlignment="Center"
                    IsVisible="{Binding SelectedInventoryItem, Converter={x:Static ObjectConverters.IsNotNull}}">
          <materialIcons:MaterialIcon Kind="CheckCircle" 
                                      Width="14" 
                                      Height="14" 
                                      Foreground="{DynamicResource MTM_Shared_Logic.SuccessBrush}"/>
          <TextBlock Text="Selected:" 
                     FontSize="11" 
                     Opacity="0.7"
                     Foreground="{DynamicResource MTM_Shared_Logic.SecondaryTextBrush}"/>
          <TextBlock Text="{Binding SelectedInventoryItem.PartId}" 
                     FontWeight="Medium" 
                     FontSize="11"
                     Foreground="{DynamicResource MTM_Shared_Logic.PrimaryTextBrush}"/>
          <TextBlock Text="{Binding SelectedInventoryItem.Location, StringFormat='at {0}'}" 
                     FontSize="11" 
                     Opacity="0.7"
                     Foreground="{DynamicResource MTM_Shared_Logic.SecondaryTextBrush}"/>
          <TextBlock Text="{Binding SelectedInventoryItem.Quantity, StringFormat='({0} available)'}" 
                     FontSize="11" 
                     Opacity="0.7"
                     Foreground="{DynamicResource MTM_Shared_Logic.SecondaryTextBrush}"/>
        </StackPanel>

        <!-- Print Button -->
        <Button Grid.Column="1"
                x:Name="Control_TransferTab_Button_Print"
                Classes="action-button secondary"
                Command="{Binding PrintCommand}"
                IsEnabled="{Binding HasInventoryItems}"
                ToolTip.Tip="Print current inventory transfer view (Ctrl+P)">
          <StackPanel Orientation="Horizontal" Spacing="6">
            <materialIcons:MaterialIcon Kind="Printer" 
                                        Width="14" 
                                        Height="14"/>
            <TextBlock Text="Print"/>
          </StackPanel>
        </Button>

        <!-- Spacer -->
        <Border Grid.Column="2"/>

        <!-- Toggle Right Panel Button -->
        <Button Grid.Column="3"
                x:Name="Control_TransferTab_Button_Toggle_RightPanel"
                Classes="action-button secondary"
                Command="{Binding TogglePanelCommand}"
                ToolTip.Tip="Toggle quick actions panel"
                MinWidth="36">
          <materialIcons:MaterialIcon Kind="DotsVertical" 
                                      Width="16" 
                                      Height="16"/>
        </Button>
      </Grid>
    </Border>
  </Grid>
</UserControl>
