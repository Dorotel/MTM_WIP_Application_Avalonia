<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels.MainForm"
             xmlns:materialIcons="using:Material.Icons.Avalonia"
             xmlns:controls="using:MTM_WIP_Application_Avalonia.Controls"
             xmlns:customDataGrid="using:MTM_WIP_Application_Avalonia.Controls.CustomDataGrid"
             xmlns:views="using:MTM_WIP_Application_Avalonia.Views"
             xmlns:overlayViews="using:MTM_WIP_Application_Avalonia.Views.Overlay"
             xmlns:conv="using:MTM_WIP_Application_Avalonia.Converters"
             mc:Ignorable="d"
             d:DesignHeight="600"
             x:Class="MTM_WIP_Application_Avalonia.Views.TransferTabView"
             x:CompileBindings="True"
             x:DataType="vm:TransferItemViewModel">

  <UserControl.Resources>
    <conv:NullToBoolConverter x:Key="NullToBoolConverter" />
    <conv:ColorToBoxShadowConverter x:Key="ColorToBoxShadowConverter" />
  </UserControl.Resources>

  <UserControl.Styles>
    <!-- MTM Theme Input Field Styles -->
    <Style Selector="TextBox.input-field">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.BodyText}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="Padding" Value="8,6" />
      <Setter Property="MinHeight" Value="32" />
      <Setter Property="HorizontalContentAlignment" Value="Left" />
      <Setter Property="VerticalContentAlignment" Value="Center" />
    </Style>

    <!-- Error state styling -->
    <Style Selector="TextBox.input-field.error">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.ErrorBrush}" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.ErrorLightBrush}" />
    </Style>

    <!-- Focus state styling -->
    <Style Selector="TextBox.input-field:focus">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.FocusBrush}" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.HoverBackground}" />
    </Style>

    <!-- Material Icons global styling -->
    <Style Selector="materialIcons|MaterialIcon">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.InteractiveText}" />
      <Setter Property="HorizontalAlignment" Value="Center" />
      <Setter Property="VerticalAlignment" Value="Center" />
    </Style>

    <!-- Primary Button styling -->
    <Style Selector="Button.primary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="MinHeight" Value="32" />
      <Setter Property="Padding" Value="12,6" />
    </Style>

    <!-- Secondary Button styling - Enhanced border visibility -->
    <Style Selector="Button.secondary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.HeadingText}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}" />
      <Setter Property="BorderThickness" Value="1.5" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="MinHeight" Value="32" />
      <Setter Property="Padding" Value="12,6" />
    </Style>

    <Style Selector="Button.secondary:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.HoverBackground}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}" />
    </Style>

    <!-- Transfer Button styling -->
    <Style Selector="Button.transfer">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.SuccessBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.SuccessBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="MinHeight" Value="32" />
      <Setter Property="Padding" Value="12,6" />
    </Style>

    <Style Selector="Button.transfer:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.SuccessDarkBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.SuccessDarkBrush}" />
    </Style>

  </UserControl.Styles>

  <!-- Root Grid for overlay positioning -->
  <Grid x:Name="RootContainer">

    <!-- Main Layout Grid with columns for content and QuickButtons -->
    <Grid x:Name="LayoutContainer" ColumnDefinitions="*,Auto" Margin="8" Background="{DynamicResource MTM_Shared_Logic.MainBackground}">

    <!-- Left Panel: Main Transfer Content -->
    <ScrollViewer Grid.Column="0" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">

      <Grid x:Name="MainContainer" RowDefinitions="*,Auto,Auto" MinWidth="600" MinHeight="400" Margin="0,0,8,0">

        <!-- Main Transfer Configuration Panel -->
        <Border Grid.Row="0" Background="{DynamicResource MTM_Shared_Logic.PanelBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}" BorderThickness="1" CornerRadius="6" Padding="16" Margin="0,0,0,8">

          <Grid x:Name="TransferFormGrid" RowDefinitions="Auto,*">

            <!-- Search Configuration Panel (Simplified) -->
            <controls:CollapsiblePanel Grid.Row="0"
                                      x:Name="SearchConfigPanel"
                                      Header="Search Configuration"
                                      HeaderPosition="Top"
                                      IsExpanded="True"
                                      ToolTip.Tip="Configure search criteria for inventory transfer candidates"
                                      Margin="0,0,0,16">

              <Grid x:Name="SearchFieldsGrid" RowDefinitions="Auto,Auto" RowSpacing="12" Margin="12">

                <!-- Part ID Field -->
                <Grid x:Name="PartIdGrid" Grid.Row="0" ColumnDefinitions="90,*" ColumnSpacing="12">
                  <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center" Width="90">
                    <materialIcons:MaterialIcon Kind="Identifier" Width="14" Height="14" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" />
                    <TextBlock Text="Part ID:" FontSize="12" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" VerticalAlignment="Center" />
                  </StackPanel>
                  <TextBox Grid.Column="1" x:Name="PartTextBox" Text="{Binding PartText, Mode=TwoWay}" Watermark="Enter part ID for transfer..." Classes="input-field" ToolTip.Tip="Select or enter part ID to search for transfer candidates" TabIndex="1" />
                </Grid>

                <!-- Operation Field -->
                <Grid x:Name="OperationGrid" Grid.Row="1" ColumnDefinitions="90,*" ColumnSpacing="12">
                  <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center" Width="90">
                    <materialIcons:MaterialIcon Kind="Cog" Width="14" Height="14" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" />
                    <TextBlock Text="Operation:" FontSize="12" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" VerticalAlignment="Center" />
                  </StackPanel>
                  <TextBox Grid.Column="1" x:Name="OperationTextBox" Text="{Binding OperationText, Mode=TwoWay}" Watermark="Enter operation number (optional)..." Classes="input-field" ToolTip.Tip="Select or enter operation number to filter transfer candidates" TabIndex="2" />
                </Grid>

              </Grid>

            </controls:CollapsiblePanel>

            <!-- DataGrid for Available Inventory -->
            <Border Grid.Row="1"
                    Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
                    BorderBrush="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="8">

              <Grid RowDefinitions="Auto,*">

                <!-- DataGrid Header -->
                <Border Grid.Row="0"
                        Background="{DynamicResource MTM_Shared_Logic.SidebarGradientBrush}"
                        CornerRadius="4"
                        Padding="12,8"
                        Margin="0,0,0,8">
                  <Grid ColumnDefinitions="Auto,*,Auto">
                    <materialIcons:MaterialIcon Grid.Column="0"
                                              Kind="ViewList"
                                              Width="16"
                                              Height="16"
                                              Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}"
                                              VerticalAlignment="Center"
                                              Margin="0,0,8,0" />
                    <TextBlock Grid.Column="1"
                              Text="Available Inventory for Transfer"
                              FontSize="14"
                              FontWeight="Bold"
                              Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}"
                              ToolTip.Tip="Select items to transfer. Use Ctrl+Click for multiple selection."
                              VerticalAlignment="Center" />
                    <Border Grid.Column="2"
                            Background="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}"
                            CornerRadius="8"
                            Padding="8,4">
                      <StackPanel Orientation="Horizontal" Spacing="6">
                        <TextBlock Text="{Binding InventoryItems.Count}"
                                  FontSize="12"
                                  FontWeight="Bold"
                                  Foreground="{DynamicResource MTM_Shared_Logic.PrimaryAction}"
                                  VerticalAlignment="Center" />
                        <TextBlock Text="items"
                                  FontSize="11"
                                  Foreground="{DynamicResource MTM_Shared_Logic.BodyText}"
                                  VerticalAlignment="Center" />
                      </StackPanel>
                    </Border>
                  </Grid>
                </Border>

                <!-- Data Display Area - TransferCustomDataGrid Integration -->
                <Grid Grid.Row="1" RowDefinitions="*,Auto">

                  <!-- TransferCustomDataGrid for Transfer Operations -->
                  <customDataGrid:TransferCustomDataGrid Grid.Row="0"
                                                       x:Name="TransferInventoryDataGrid"
                                                       ItemsSource="{Binding InventoryItems}"
                                                       SelectedItem="{Binding SelectedInventoryItem, Mode=TwoWay}"
                                                       SelectedItemsCollection="{Binding SelectedInventoryItems}"
                                                       ExecuteTransferCommand="{Binding TransferCommand}"
                                                       IsVisible="{Binding HasInventoryItems}"
                                                       Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
                                                       BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                                                       BorderThickness="1"
                                                       CornerRadius="4"
                                                       MinHeight="300"
                                                       MaxHeight="600">

                    <!-- [TRANSFER-DEBUG] TransferCustomDataGrid Debug Info -->
                    <ToolTip.Tip>
                      <StackPanel>
                        <TextBlock Text="{Binding InventoryItems.Count, StringFormat='Items Count: {0}'}" />
                        <TextBlock Text="{Binding HasInventoryItems, StringFormat='HasInventoryItems: {0}'}" />
                        <TextBlock Text="{Binding SelectedInventoryItem.PartId, StringFormat='Selected Part: {0}', TargetNullValue='None'}" />
                        <TextBlock Text="{Binding SelectedInventoryItems.Count, StringFormat='Selected Items: {0}'}" />
                      </StackPanel>
                    </ToolTip.Tip>

                  </customDataGrid:TransferCustomDataGrid>

                  <!-- Nothing Found Indicator -->
                  <Border Grid.Row="0"
                          IsVisible="{Binding ShowNothingFoundIndicator}"
                          Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
                          BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                          BorderThickness="1"
                          CornerRadius="4"
                          Padding="32"
                          MinHeight="200">

                    <!-- [TRANSFER-DEBUG] Nothing Found Debug Info -->
                    <ToolTip.Tip>
                      <StackPanel>
                        <TextBlock Text="{Binding IsLoading, StringFormat='IsLoading: {0}'}" />
                        <TextBlock Text="{Binding HasInventoryItems, StringFormat='HasInventoryItems: {0}'}" />
                        <TextBlock Text="{Binding ShowNothingFoundIndicator, StringFormat='ShowNothingFoundIndicator: {0}'}" />
                        <TextBlock Text="{Binding PartText, StringFormat='PartText: {0}', TargetNullValue='Empty'}" />
                        <TextBlock Text="{Binding OperationText, StringFormat='OperationText: {0}', TargetNullValue='Empty'}" />
                      </StackPanel>
                    </ToolTip.Tip>

                    <StackPanel HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Spacing="16">
                      <materialIcons:MaterialIcon Kind="Transfer"
                                                Width="48"
                                                Height="48"
                                                Foreground="{DynamicResource MTM_Shared_Logic.TertiaryTextBrush}"/>
                      <TextBlock Text="No transfer candidates found"
                                FontSize="16"
                                FontWeight="Medium"
                                Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}"
                                HorizontalAlignment="Center"/>
                      <TextBlock Text="Enter search criteria above and click Search"
                                FontSize="12"
                                Foreground="{DynamicResource MTM_Shared_Logic.BodyText}"
                                HorizontalAlignment="Center"/>
                    </StackPanel>
                  </Border>

                  <!-- Loading Indicator -->
                  <Border Grid.Row="0"
                          IsVisible="{Binding IsLoading}"
                          Background="#80000000"
                          MinHeight="200">

                    <!-- [TRANSFER-DEBUG] Loading Indicator Debug Info -->
                    <ToolTip.Tip>
                      <StackPanel>
                        <TextBlock Text="{Binding IsLoading, StringFormat='IsLoading: {0}'}" />
                        <TextBlock Text="{Binding StatusMessage, StringFormat='StatusMessage: {0}', TargetNullValue='Empty'}" />
                        <TextBlock Text="{Binding CanSearch, StringFormat='CanSearch: {0}'}" />
                        <TextBlock Text="{Binding CanTransfer, StringFormat='CanTransfer: {0}'}" />
                      </StackPanel>
                    </ToolTip.Tip>

                    <StackPanel HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Spacing="16">
                      <ProgressBar IsIndeterminate="True"
                                  Width="200"
                                  Height="4"
                                  Foreground="{DynamicResource MTM_Shared_Logic.PrimaryAction}"/>
                      <TextBlock Text="Loading inventory data..."
                                FontSize="14"
                                Foreground="{DynamicResource MTM_Shared_Logic.HighlightTextBrush}"
                                HorizontalAlignment="Center"/>
                      <!-- [TRANSFER-DEBUG] Status Message Display -->
                      <TextBlock Text="{Binding StatusMessage, TargetNullValue='Preparing...'}"
                                FontSize="12"
                                Foreground="LightGray"
                                HorizontalAlignment="Center"/>
                    </StackPanel>
                  </Border>

                </Grid>

              </Grid>
            </Border>

          </Grid>
        </Border>

        <!-- Transfer Controls Card (Always Visible) -->
        <Border Grid.Row="1"
                Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
                BorderBrush="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}"
                BorderThickness="1"
                CornerRadius="6"
                Padding="16"
                Margin="0,0,0,8">

          <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="12">

            <!-- Transfer Controls Header -->
            <Border Grid.Row="0"
                    Background="{DynamicResource MTM_Shared_Logic.PrimaryAction}"
                    CornerRadius="4"
                    Padding="12,8">
              <Grid ColumnDefinitions="Auto,*">
                <materialIcons:MaterialIcon Grid.Column="0"
                                          Kind="ArrowRightBold"
                                          Width="16"
                                          Height="16"
                                          Foreground="White"
                                          VerticalAlignment="Center"
                                          Margin="0,0,8,0" />
                <TextBlock Grid.Column="1"
                          Text="Transfer Configuration"
                          FontSize="14"
                          FontWeight="Bold"
                          Foreground="White"
                          VerticalAlignment="Center" />
              </Grid>
            </Border>

            <!-- Transfer Configuration Fields with Transfer Button -->
            <Grid Grid.Row="1" ColumnDefinitions="*,*,Auto" ColumnSpacing="16">

              <!-- To Location Field -->
              <Grid Grid.Column="0" RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
                <Grid Grid.Row="0" ColumnDefinitions="Auto,*" ColumnSpacing="8">
                  <materialIcons:MaterialIcon Grid.Column="0"
                                            Kind="MapMarkerRadius"
                                            Width="14"
                                            Height="14"
                                            Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}"
                                            VerticalAlignment="Center" />
                  <TextBlock Grid.Column="1"
                            Text="Destination Location:"
                            FontSize="12"
                            FontWeight="Medium"
                            Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}"
                            VerticalAlignment="Center" />
                </Grid>

                <TextBox Grid.Row="1"
                         x:Name="ToLocationTextBox"
                         Text="{Binding ToLocationText, Mode=TwoWay}"
                         Watermark="Select destination location..."
                         Classes="input-field"
                         Classes.error="{Binding HasLocationValidationError}"
                         ToolTip.Tip="Select or enter destination location for transfer"
                         TabIndex="3" />

                <!-- Location Validation Message -->
                <TextBlock Grid.Row="2"
                          Text="Location is required and must be different from source"
                          FontSize="10"
                          Foreground="{DynamicResource MTM_Shared_Logic.ErrorBrush}"
                          IsVisible="{Binding HasLocationValidationError}" />
              </Grid>

              <!-- Transfer Quantity Field -->
              <Grid Grid.Column="1" RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
                <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">
                  <materialIcons:MaterialIcon Grid.Column="0"
                                            Kind="Counter"
                                            Width="14"
                                            Height="14"
                                            Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}"
                                            VerticalAlignment="Center" />
                  <TextBlock Grid.Column="1"
                            Text="Transfer Quantity:"
                            FontSize="12"
                            FontWeight="Medium"
                            Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}"
                            VerticalAlignment="Center" />
                  <Border Grid.Column="2"
                          Background="{DynamicResource MTM_Shared_Logic.InteractiveText}"
                          CornerRadius="4"
                          Padding="6,2"
                          IsVisible="{Binding SelectedInventoryItem, Converter={x:Static ObjectConverters.IsNotNull}}">
                    <TextBlock Text="{Binding MaxTransferQuantity, StringFormat='Max: {0}'}"
                              FontSize="10"
                              FontWeight="SemiBold"
                              Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}"
                              ToolTip.Tip="Maximum available quantity for selected item" />
                  </Border>
                </Grid>

                <TextBox Grid.Row="1"
                         x:Name="QuantityTextBox"
                         Text="{Binding TransferQuantityText, Mode=TwoWay}"
                         Watermark="Enter quantity to transfer..."
                         Classes="input-field"
                         Classes.error="{Binding HasQuantityValidationError}"
                         ToolTip.Tip="Enter numeric quantity to transfer"
                         TabIndex="4" />

                <!-- Quantity Validation Message -->
                <TextBlock Grid.Row="2"
                          Text="Quantity must be between 1 and maximum available"
                          FontSize="10"
                          Foreground="{DynamicResource MTM_Shared_Logic.ErrorBrush}"
                          IsVisible="{Binding HasQuantityValidationError}" />
              </Grid>

              <!-- Transfer Action Button -->
              <StackPanel Grid.Column="2" VerticalAlignment="Top" Margin="8,24,0,0">
                <Button x:Name="TransferButton"
                        Classes="transfer"
                        Width="120"
                        Height="40"
                        Command="{Binding TransferCommand}"
                        IsEnabled="{Binding CanTransfer}"
                        TabIndex="5">

                  <!-- [TRANSFER-DEBUG] Transfer Button Debug Info -->
                  <ToolTip.Tip>
                    <StackPanel>
                      <TextBlock Text="Execute transfer (Enter)" FontWeight="Bold" />
                      <Separator Margin="0,4" />
                      <TextBlock Text="{Binding SelectedInventoryItem.PartId, StringFormat='Selected Part: {0}', TargetNullValue='None'}" />
                      <TextBlock Text="{Binding SelectedInventoryItems.Count, StringFormat='Selected Items: {0}'}" />
                      <TextBlock Text="{Binding ToLocationText, StringFormat='Destination: {0}', TargetNullValue='Not Set'}" />
                      <TextBlock Text="{Binding TransferQuantity, StringFormat='Transfer Qty: {0}'}" />
                      <TextBlock Text="{Binding MaxTransferQuantity, StringFormat='Max Available: {0}'}" />
                      <TextBlock Text="{Binding CanTransfer, StringFormat='CanTransfer: {0}'}" />
                      <TextBlock Text="{Binding HasLocationValidationError, StringFormat='Location Error: {0}'}" />
                      <TextBlock Text="{Binding HasQuantityValidationError, StringFormat='Quantity Error: {0}'}" />
                    </StackPanel>
                  </ToolTip.Tip>

                  <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="6">
                    <materialIcons:MaterialIcon Kind="ArrowRightBold" Width="16" Height="16" HorizontalAlignment="Center" VerticalAlignment="Center" />
                    <TextBlock Text="Transfer" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="SemiBold" />
                  </StackPanel>
                </Button>
              </StackPanel>

            </Grid>

            <!-- Transfer Status and Instructions -->
            <Grid Grid.Row="2" ColumnDefinitions="Auto,*">
              <materialIcons:MaterialIcon Grid.Column="0"
                                        Kind="InformationOutline"
                                        Width="16"
                                        Height="16"
                                        Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}"
                                        VerticalAlignment="Top"
                                        Margin="0,2,8,0" />
              <TextBlock Grid.Column="1"
                        Text="Select an item from the table above, enter a destination location and quantity, then click Transfer to complete the operation."
                        FontSize="11"
                        Foreground="{DynamicResource MTM_Shared_Logic.BodyText}"
                        TextWrapping="Wrap" />
            </Grid>

          </Grid>
        </Border>

        <!-- Action Buttons Panel -->
        <Border Grid.Row="2" Background="{DynamicResource MTM_Shared_Logic.PanelBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,0,8">

          <Grid x:Name="ActionButtonsGrid" ColumnDefinitions="Auto,*">

            <!-- Action buttons -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left" Spacing="8">

              <Button x:Name="SearchButton" Classes="primary" Width="100" Command="{Binding SearchCommand}" IsEnabled="{Binding CanSearch}" TabIndex="6">

                <!-- [TRANSFER-DEBUG] Search Button Debug Info -->
                <ToolTip.Tip>
                  <StackPanel>
                    <TextBlock Text="Search for transfer candidates (F5)" FontWeight="Bold" />
                    <Separator Margin="0,4" />
                    <TextBlock Text="{Binding PartText, StringFormat='PartText: {0}', TargetNullValue='Empty'}" />
                    <TextBlock Text="{Binding OperationText, StringFormat='OperationText: {0}', TargetNullValue='Empty'}" />
                    <TextBlock Text="{Binding CanSearch, StringFormat='CanSearch: {0}'}" />
                    <TextBlock Text="{Binding IsLoading, StringFormat='IsLoading: {0}'}" />
                    <TextBlock Text="{Binding InventoryItems.Count, StringFormat='Current Results: {0} items'}" />
                  </StackPanel>
                </ToolTip.Tip>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="6">
                  <materialIcons:MaterialIcon Kind="Magnify" Width="14" Height="14" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                  <TextBlock Text="Search" FontSize="11" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" />
                </StackPanel>
              </Button>

              <Button Classes="secondary" Width="100" Command="{Binding ResetCommand}" ToolTip.Tip="Reset form (Escape)" TabIndex="7">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="6">
                  <materialIcons:MaterialIcon Kind="Refresh" Width="14" Height="14" HorizontalAlignment="Center" VerticalAlignment="Center" />
                  <TextBlock Text="Reset" FontSize="11" HorizontalAlignment="Center" VerticalAlignment="Center" />
                </StackPanel>
              </Button>

            </StackPanel>

            <Grid Grid.Column="1" HorizontalAlignment="Right">
              <Button Classes="secondary" Width="120" Command="{Binding PrintCommand}" ToolTip.Tip="Test print functionality with mock data (Ctrl+P)" TabIndex="8">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="6">
                  <materialIcons:MaterialIcon Kind="TestTube" Width="14" Height="14" HorizontalAlignment="Center" VerticalAlignment="Center" />
                  <TextBlock Text="Test Print" FontSize="11" HorizontalAlignment="Center" VerticalAlignment="Center" />
                </StackPanel>
              </Button>
            </Grid>

          </Grid>
        </Border>

      </Grid>
    </ScrollViewer>

    <!-- Right Panel: Collapsible Quick Actions -->
    <controls:CollapsiblePanel Grid.Column="1"
                              HeaderPosition="Right"
                              IsExpanded="{Binding IsQuickActionsPanelExpanded, Mode=TwoWay}"
                              IsVisible="{Binding IsAdvancedPanelVisible, FallbackValue=True}"
                              Margin="0,0,0,0"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch"
                              MinWidth="40">
      <views:QuickButtonsView DataContext="{Binding QuickButtonsViewModel}"
                             HorizontalAlignment="Stretch"
                             VerticalAlignment="Stretch"/>
    </controls:CollapsiblePanel>
  </Grid>

  </Grid> <!-- Close RootContainer -->

</UserControl>
