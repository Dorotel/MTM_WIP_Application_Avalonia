<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels"
             xmlns:apivm="using:API.ViewModels.MainForm"
             xmlns:materialIcons="using:Material.Icons.Avalonia"
             xmlns:controls="using:MTM_WIP_Application_Avalonia.Controls"
             xmlns:views="using:MTM_WIP_Application_Avalonia.Views"
             xmlns:overlayViews="using:MTM_WIP_Application_Avalonia.Views.Overlay"
             xmlns:conv="using:MTM_WIP_Application_Avalonia.Converters"
             mc:Ignorable="d"
             d:DesignWidth="800"
             d:DesignHeight="600"
             x:Class="MTM_WIP_Application_Avalonia.Views.RemoveTabView">

  <!-- ================================================================== -->
  <!-- RESOURCES -->
  <!-- ================================================================== -->
  <UserControl.Resources>
    <conv:NullToBoolConverter x:Key="NullToBoolConverter" />
  </UserControl.Resources>

  <!-- ================================================================== -->
  <!-- KEY BINDINGS -->
  <!-- ================================================================== -->
  <UserControl.KeyBindings>
    <KeyBinding Gesture="F5" Command="{Binding SearchCommand}" />
    <KeyBinding Gesture="Escape" Command="{Binding ResetCommand}" />
    <KeyBinding Gesture="Delete" Command="{Binding DeleteCommand}" />
    <KeyBinding Gesture="Ctrl+Z" Command="{Binding UndoCommand}" />
    <KeyBinding Gesture="Ctrl+P" Command="{Binding PrintCommand}" />
  </UserControl.KeyBindings>

  <!-- ================================================================== -->
  <!-- ROOT CONTAINER -->
  <!-- ================================================================== -->
  <Grid x:Name="RootContainer">

    <!-- ================================================================ -->
    <!-- MASTER CONTAINER -->
    <!-- ================================================================ -->
    <Border x:Name="MasterContainer"
            Background="Transparent"
            BorderThickness="0"
            CornerRadius="0"
            Padding="8"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">

      <!-- ============================================================== -->
      <!-- MAIN CONTAINER GRID -->
      <!-- ============================================================== -->
      <Grid x:Name="MainContainer"
            RowDefinitions="Auto,*,Auto"
            Background="Transparent"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">

        <!-- ============================================================ -->
        <!-- SEARCH CRITERIA SECTION -->
        <!-- ============================================================ -->
        <Border Grid.Row="0"
                Classes="Card"
                Padding="16"
                Margin="0,4,0,4"
                HorizontalAlignment="Stretch">

          <StackPanel Spacing="16" HorizontalAlignment="Stretch">

          <!-- ========================================================================================= -->
          <!-- FORM TITLE SECTION - Manufacturing header with icon -->
          <!-- ========================================================================================= -->
          <StackPanel Classes="ManufacturingFormTitle"  Margin="0" >
            <Border Classes="ManufacturingTitleIcon" Margin="0">
              <materialIcons:MaterialIcon Kind="Package" Classes="ManufacturingTitleIcon"/>
            </Border>
            <TextBlock Classes="ManufacturingFormTitle" Margin="0" Text="Remove Inventory Item"/>
          </StackPanel>

            <!-- Search Form Grid -->
            <Grid Classes="ManufacturingForm"
                  RowDefinitions="Auto"
                  HorizontalAlignment="Stretch">

              <!-- Search Fields Row -->
              <Grid Grid.Row="0"
                    Classes="ManufacturingTwoColumn"
                    ColumnDefinitions="1*,6,1*">

                <!-- Part ID Field -->
                <Border Grid.Column="0" Classes="ManufacturingField">
                  <StackPanel Classes="ManufacturingFieldContent">

                    <StackPanel Classes="ManufacturingFieldHeader">
                      <materialIcons:MaterialIcon Kind="Identifier" Classes="ManufacturingFieldIcon"/>
                      <TextBlock Classes="ManufacturingFieldLabel" Text="Part ID"/>
                    </StackPanel>

                    <TextBox x:Name="PartTextBox"
                             Classes="ManufacturingInput"
                             Text="{Binding SelectedPart, Mode=TwoWay}"
                             Watermark="{Binding PartWatermark}"
                             ToolTip.Tip="Enter part number to search"
                             TabIndex="1"
                             IsEnabled="{Binding AreSearchFieldsEnabled}"/>
                  </StackPanel>
                </Border>

                <!-- Operation Field -->
                <Border Grid.Column="2" Classes="ManufacturingField">
                  <StackPanel Classes="ManufacturingFieldContent">

                    <StackPanel Classes="ManufacturingFieldHeader">
                      <materialIcons:MaterialIcon Kind="Cog" Classes="ManufacturingFieldIcon"/>
                      <TextBlock Classes="ManufacturingFieldLabel" Text="Operation"/>
                    </StackPanel>

                    <TextBox x:Name="OperationTextBox"
                             Classes="ManufacturingInput"
                             Text="{Binding SelectedOperation, Mode=TwoWay}"
                             Watermark="{Binding OperationWatermark}"
                             ToolTip.Tip="Enter operation number (90, 100, 110)"
                             TabIndex="2"
                             IsEnabled="{Binding AreSearchFieldsEnabled}"/>
                  </StackPanel>
                </Border>

              </Grid>
            </Grid>

            <!-- Search Actions -->
            <Grid Classes="ManufacturingActions" ColumnDefinitions="Auto,*,Auto">

                <!-- Search Button - Left Side -->
                <StackPanel Grid.Column="0"
                                        Orientation="Horizontal"
                                        Spacing="8"
                                        HorizontalAlignment="Left">

                    <Button x:Name="SearchButton"
                                    Classes="Primary ManufacturingSave"
                                    Command="{Binding SearchCommand}"
                                    ToolTip.Tip="Search inventory (F5)"
                                    Height="32"
                                    MinWidth="100">
                        <StackPanel Orientation="Horizontal"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Spacing="6">
                            <materialIcons:MaterialIcon Kind="Magnify" Classes="ManufacturingActionIcon"/>
                            <TextBlock Classes="Caption" Text="Search"/>
                        </StackPanel>
                    </Button>

                </StackPanel>

                <!-- Flexible Gap - Column 1 (auto-expands/contracts with screen width) -->

                <!-- Reset Button - Right Side -->
                <StackPanel Grid.Column="2"
                                        Orientation="Horizontal"
                                        Spacing="8"
                                        HorizontalAlignment="Right">

                    <Button Classes="Tertiary ManufacturingAdvanced"
                                    Command="{Binding ResetCommand}"
                                    ToolTip.Tip="Reset search criteria (Escape)"
                                    Height="32"
                                    MinWidth="80">
                        <StackPanel Orientation="Horizontal"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Spacing="6">
                            <materialIcons:MaterialIcon Kind="Refresh" Classes="ManufacturingLargeIcon"/>
                            <TextBlock Classes="Caption" Text="Reset"/>
                        </StackPanel>
                    </Button>

                </StackPanel>
            </Grid>

          </StackPanel>
        </Border>

        <!-- ============================================================ -->
        <!-- RESULTS DATAGRID SECTION -->
        <!-- ============================================================ -->
        <Border Grid.Row="1"
                Classes="Card"
                Padding="16"
                Margin="0,4,0,4"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">

          <Grid RowDefinitions="*">

            <!-- Inventory Results DataGrid -->
            <DataGrid Grid.Row="0"
                      x:Name="InventoryDataGrid"
                      ItemsSource="{Binding InventoryItems}"
                      IsVisible="{Binding HasInventoryItems}"
                      AutoGenerateColumns="True"
                      IsReadOnly="True"
                      CanUserReorderColumns="True"
                      CanUserResizeColumns="True"
                      CanUserSortColumns="True"
                      GridLinesVisibility="All"
                      HeadersVisibility="All"
                      Background="{DynamicResource MTM_Shared_Logic.DataGridBackgroundBrush}"
                      BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}"
                      BorderThickness="1"
                      CornerRadius="4"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch" />

            <!-- Nothing Found Indicator -->
            <Border Grid.Row="0"
                    IsVisible="{Binding !HasInventoryItems}"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    MinHeight="200">

              <StackPanel HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Spacing="16">

                <materialIcons:MaterialIcon Kind="DatabaseRemove"
                                            Width="48"
                                            Height="48"
                                            Classes="ManufacturingSecondaryIcon"/>

                <TextBlock Classes="ManufacturingFieldLabel"
                           Text="No inventory items found"
                           HorizontalAlignment="Center" />

                <TextBlock Classes="Caption"
                           Text="Enter search criteria above and click Search"
                           HorizontalAlignment="Center" />
              </StackPanel>
            </Border>

            <!-- Loading Indicator -->
            <Border Grid.Row="0"
                    IsVisible="{Binding IsLoading}"
                    Background="#80000000"
                    MinHeight="200">

              <StackPanel HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Spacing="16">

                <ProgressBar IsIndeterminate="True"
                             Width="20"
                             Height="4"/>

                <TextBlock Text="Loading inventory data..."
                           Classes="Caption"
                           HorizontalAlignment="Center" />
              </StackPanel>
            </Border>

          </Grid>
        </Border>

        <!-- ============================================================ -->
        <!-- ACTION BUTTONS PANEL -->
        <!-- ============================================================ -->


          <Grid Classes="ManufacturingActions"
                ColumnDefinitions="Auto,*,Auto"
                Grid.Row="2"
                Margin="0,4,0,4">

            <!-- Primary Actions -->
            <StackPanel Grid.Column="0"
                        Orientation="Horizontal"
                        Spacing="8"
                        HorizontalAlignment="Left">

              <!-- Delete Selected Button -->
              <Button x:Name="DeleteButton"
                      Classes="Primary ManufacturingSave"
                      Command="{Binding DeleteCommand}"
                      IsEnabled="{Binding CanDelete}"
                      ToolTip.Tip="Delete selected items (Delete key)"
                      Height="32"
                      MinWidth="120">
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="6">
                  <materialIcons:MaterialIcon Kind="Delete" Classes="ManufacturingActionIcon"/>
                  <TextBlock Classes="Caption" Text="Delete Selected"/>
                </StackPanel>
              </Button>

              <!-- Undo Button -->
              <Button Classes="Secondary ManufacturingReset"
                      Command="{Binding UndoCommand}"
                      IsEnabled="{Binding CanUndo}"
                      ToolTip.Tip="Undo last removal (Ctrl+Z)"
                      Height="32"
                      MinWidth="80">
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="6">
                  <materialIcons:MaterialIcon Kind="Undo" Classes="ManufacturingSecondaryIcon"/>
                  <TextBlock Classes="Caption" Text="Undo"/>
                </StackPanel>
              </Button>

            </StackPanel>

            <!-- Secondary Actions -->
            <StackPanel Grid.Column="2"
                        Orientation="Horizontal"
                        Spacing="8"
                        HorizontalAlignment="Right">

              <!-- Print Button -->
              <Button Classes="Icon ManufacturingAdvanced"
                      Command="{Binding PrintCommand}"
                      IsEnabled="{Binding HasInventoryItems}"
                      ToolTip.Tip="Print inventory list (Ctrl+P)"
                      Height="32"
                      Width="32">
                <materialIcons:MaterialIcon Kind="Printer" Classes="ManufacturingLargeIcon"/>
              </Button>

              <!-- Advanced Options Button -->
              <Button Classes="Icon ManufacturingAdvanced"
                      Command="{Binding AdvancedRemovalCommand}"
                      ToolTip.Tip="Advanced removal options"
                      Height="32"
                      Width="32">
                <materialIcons:MaterialIcon Kind="Settings" Classes="ManufacturingLargeIcon"/>
              </Button>

            </StackPanel>
          </Grid>

      </Grid>
    </Border>

    <!-- ================================================================ -->
    <!-- OVERLAY SECTIONS -->
    <!-- ================================================================ -->

    <!-- Note Editor Overlay -->
    <Border x:Name="NoteEditorOverlay"
            IsVisible="{Binding IsNoteEditorVisible}"
            Background="#CC000000"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">

      <Border Classes="Card"
              MaxWidth="600"
              MaxHeight="500"
              Margin="50"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">
        <views:NoteEditorView DataContext="{Binding NoteEditorViewModel}" />
      </Border>
    </Border>

    <!-- Edit Inventory Dialog Overlay -->
    <Border x:Name="EditInventoryDialogOverlay"
            IsVisible="{Binding IsEditDialogVisible}"
            Background="#CC000000"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">

      <Border Classes="Card"
              Margin="30"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch">
        <overlayViews:EditInventoryView DataContext="{Binding EditDialogViewModel}" />
      </Border>
    </Border>

    <!-- Confirmation Dialog Overlay -->
    <Border IsVisible="{Binding ConfirmationOverlayViewModel, Converter={StaticResource NullToBoolConverter}}">
      <views:ConfirmationOverlayView DataContext="{Binding ConfirmationOverlayViewModel}" />
    </Border>

  </Grid>
</UserControl>
