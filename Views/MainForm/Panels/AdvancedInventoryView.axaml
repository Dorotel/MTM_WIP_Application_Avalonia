<UserControl xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels.MainForm" xmlns:materialIcons="using:Material.Icons.Avalonia" xmlns:i="using:Avalonia.Xaml.Interactivity" xmlns:behaviors="using:MTM_WIP_Application_Avalonia.Behaviors" xmlns:controls="using:MTM_WIP_Application_Avalonia.Controls" mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800" x:Class="MTM_WIP_Application_Avalonia.Views.AdvancedInventoryView" x:CompileBindings="True" x:DataType="vm:AdvancedInventoryViewModel">

  <UserControl.Resources>
    <!-- Theme resources will be provided by DynamicResource bindings -->
    <!-- Remove hardcoded colors and use theme resources from App.axaml -->
  </UserControl.Resources>

  <UserControl.Styles>
    <!-- Compact Input Styles -->
    <Style Selector="TextBox.input-field">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="3" />
      <Setter Property="Padding" Value="6,3" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="FontSize" Value="10" />
      <Setter Property="MinHeight" Value="24" />
      <Setter Property="Margin" Value="2" />
    </Style>

    <Style Selector="AutoCompleteBox.input-field">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="3" />
      <Setter Property="Padding" Value="6,3" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="FontSize" Value="10" />
      <Setter Property="MinHeight" Value="24" />
      <Setter Property="Margin" Value="2" />
      <Setter Property="FilterMode" Value="Contains" />
      <Setter Property="MinimumPrefixLength" Value="0" />
      <Setter Property="MaxDropDownHeight" Value="200" />
      <Setter Property="IsTextCompletionEnabled" Value="True" />
    </Style>

    <!-- Compact Button Styles -->
    <Style Selector="Button.action-button">
      <Setter Property="Padding" Value="6,3" />
      <Setter Property="Margin" Value="2" />
      <Setter Property="FontSize" Value="10" />
      <Setter Property="FontWeight" Value="Medium" />
      <Setter Property="CornerRadius" Value="3" />
      <Setter Property="MinHeight" Value="24" />
      <Setter Property="Cursor" Value="Hand" />
      <Setter Property="HorizontalContentAlignment" Value="Center" />
      <Setter Property="VerticalContentAlignment" Value="Center" />
    </Style>
    
    <Style Selector="Button.primary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.HeadingText}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>
    <Style Selector="Button.primary:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryHoverBrush}" />
    </Style>

    <Style Selector="Button.secondary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.HeadingText}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>
    <Style Selector="Button.secondary:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.HeadingText}" />
    </Style>

    <Style Selector="Button.success">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.SuccessBrush}" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.SuccessBrush}" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>

    <Style Selector="Button.warning">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.Warning}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.HeadingText}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.Warning}" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>

    <!-- DataGrid styling -->
    <Style Selector="DataGrid">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="3" />
      <Setter Property="GridLinesVisibility" Value="Horizontal" />
      <Setter Property="HeadersVisibility" Value="Column" />
      <Setter Property="CanUserReorderColumns" Value="True" />
      <Setter Property="CanUserResizeColumns" Value="True" />
      <Setter Property="CanUserSortColumns" Value="True" />
      <Setter Property="IsReadOnly" Value="True" />
      <Setter Property="SelectionMode" Value="Extended" />
    </Style>
  </UserControl.Styles>

  <!-- Main Layout Container - ScrollViewer for overflow handling -->
  <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Background="{DynamicResource MTM_Shared_Logic.MainBackground}">
    
    <Grid x:Name="MainContainer" RowDefinitions="*,Auto" MinWidth="600" MinHeight="400" Margin="8">

      <!-- Main Three-Panel Layout with CollapsiblePanel -->
      <Border Grid.Row="0" Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}" BorderThickness="1" CornerRadius="8" Padding="8" Margin="0,0,0,8">
        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
          
          <!-- Left Panel: Mode & Entry -->
          <controls:CollapsiblePanel Grid.Column="0" 
                                   IsExpanded="{Binding IsModeSelectionExpanded}"
                                   HeaderPosition="Left"
                                   MinWidth="200">
            <controls:CollapsiblePanel.Header>
              <Border>
                <TextBlock Text="Mode &amp; Entry" 
                           VerticalAlignment="Center" 
                           HorizontalAlignment="Center"
                           FontSize="10" 
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}"
                           RenderTransformOrigin="0.5,0.5">
                  <TextBlock.RenderTransform>
                    <RotateTransform Angle="-90"/>
                  </TextBlock.RenderTransform>
                </TextBlock>
              </Border>
            </controls:CollapsiblePanel.Header>
            
            <StackPanel Spacing="8">
              
              <!-- Mode Selection -->
              <Border Background="{DynamicResource MTM_Shared_Logic.PrimaryAction}" CornerRadius="4" Padding="8" Margin="0,0,0,8">
                <StackPanel Orientation="Vertical" Spacing="6">
                  <TextBlock Text="Operation Mode" Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" 
                             FontWeight="SemiBold" FontSize="10" />
                  <RadioButton Content="Multiple Times" IsChecked="{Binding IsMultipleTimesMode}" 
                               Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}"
                               ToolTip.Tip="Add same item multiple times" />
                  <RadioButton Content="Multiple Locations" IsChecked="{Binding IsMultipleLocationsMode}"
                               Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}"
                               ToolTip.Tip="Add item to multiple locations" />
                </StackPanel>
              </Border>

              <!-- Multiple Times Mode Controls -->
              <Border IsVisible="{Binding IsMultipleTimesMode}" Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}" BorderThickness="1" CornerRadius="4" Padding="8">
                <StackPanel Spacing="6">
                  
                  <!-- Part Number -->
                  <StackPanel>
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                      <materialIcons:MaterialIcon Grid.Column="0" Kind="Identifier" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="Part ID" />
                    </Grid>
                    <AutoCompleteBox ItemsSource="{Binding PartIDOptions}" SelectedItem="{Binding SelectedPartID, Mode=TwoWay}" Text="{Binding PartIDText, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" Watermark="Enter part ID..." ToolTip.Tip="Select or enter part number" MinimumPrefixLength="0" FilterMode="Contains" MaxDropDownHeight="200" IsTextCompletionEnabled="False" behaviors:ComboBoxBehavior.EnableComboBoxBehavior="True" />
                  </StackPanel>

                  <!-- Operation -->
                  <StackPanel>
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                      <materialIcons:MaterialIcon Grid.Column="0" Kind="Cog" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="Operation" />
                    </Grid>
                    <AutoCompleteBox ItemsSource="{Binding OperationOptions}" SelectedItem="{Binding SelectedOperation, Mode=TwoWay}" Text="{Binding OperationText, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" Watermark="Enter operation..." ToolTip.Tip="Select operation number" MinimumPrefixLength="0" FilterMode="StartsWith" MaxDropDownHeight="200" IsTextCompletionEnabled="False" behaviors:ComboBoxBehavior.EnableComboBoxBehavior="True" />
                  </StackPanel>

                  <!-- Quantity -->
                  <StackPanel>
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                      <materialIcons:MaterialIcon Grid.Column="0" Kind="Counter" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="Quantity" />
                    </Grid>
                    <TextBox Text="{Binding QuantityText, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" Watermark="Enter quantity..." ToolTip.Tip="Enter numeric quantity" />
                  </StackPanel>

                  <!-- Location -->
                  <StackPanel>
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                      <materialIcons:MaterialIcon Grid.Column="0" Kind="MapMarker" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="Location" />
                    </Grid>
                    <AutoCompleteBox ItemsSource="{Binding LocationOptions}" SelectedItem="{Binding SelectedLocation, Mode=TwoWay}" Text="{Binding LocationText, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" Watermark="Enter location..." ToolTip.Tip="Select location" MinimumPrefixLength="0" FilterMode="StartsWith" MaxDropDownHeight="200" IsTextCompletionEnabled="False" behaviors:ComboBoxBehavior.EnableComboBoxBehavior="True" />
                  </StackPanel>

                  <!-- Repeat Times -->
                  <StackPanel>
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                      <materialIcons:MaterialIcon Grid.Column="0" Kind="Repeat" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="Repeat Count" />
                    </Grid>
                    <TextBox Text="{Binding RepeatTimesText, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" Watermark="How many times..." ToolTip.Tip="Number of transactions to create" />
                  </StackPanel>

                </StackPanel>
              </Border>

              <!-- Multiple Locations Mode Controls -->
              <Border IsVisible="{Binding IsMultipleLocationsMode}" Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}" BorderThickness="1" CornerRadius="4" Padding="8">
                <StackPanel Spacing="6">
                  
                  <!-- Part Number -->
                  <StackPanel>
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                      <materialIcons:MaterialIcon Grid.Column="0" Kind="Identifier" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="Part ID" />
                    </Grid>
                    <AutoCompleteBox ItemsSource="{Binding PartIDOptions}" SelectedItem="{Binding MultiLocationPartID, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" Watermark="Enter part ID..." ToolTip.Tip="Part for multiple locations" MinimumPrefixLength="0" FilterMode="Contains" MaxDropDownHeight="200" IsTextCompletionEnabled="False" />
                  </StackPanel>

                  <!-- Operation -->
                  <StackPanel>
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                      <materialIcons:MaterialIcon Grid.Column="0" Kind="Cog" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="Operation" />
                    </Grid>
                    <AutoCompleteBox ItemsSource="{Binding OperationOptions}" SelectedItem="{Binding MultiLocationOperation, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" Watermark="Enter operation..." ToolTip.Tip="Select operation number" MinimumPrefixLength="0" FilterMode="StartsWith" MaxDropDownHeight="200" IsTextCompletionEnabled="False" />
                  </StackPanel>

                  <!-- Quantity -->
                  <StackPanel>
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                      <materialIcons:MaterialIcon Grid.Column="0" Kind="Counter" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="Quantity" />
                    </Grid>
                    <TextBox Text="{Binding MultiLocationQuantityText, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" Watermark="Enter quantity..." ToolTip.Tip="Quantity for each location" />
                  </StackPanel>

                  <!-- Location Selection Actions -->
                  <StackPanel Orientation="Horizontal" Spacing="4">
                    <Button Classes="action-button secondary" Width="70" Height="20" Command="{Binding SelectAllLocationsCommand}" ToolTip.Tip="Select all locations">
                      <StackPanel Orientation="Horizontal" Spacing="2">
                        <materialIcons:MaterialIcon Kind="CheckAll" Width="8" Height="8" />
                        <TextBlock Text="All" FontSize="8" />
                      </StackPanel>
                    </Button>
                    <Button Classes="action-button secondary" Width="70" Height="20" Command="{Binding ClearAllLocationsCommand}" ToolTip.Tip="Clear all selections">
                      <StackPanel Orientation="Horizontal" Spacing="2">
                        <materialIcons:MaterialIcon Kind="Close" Width="8" Height="8" />
                        <TextBlock Text="Clear" FontSize="8" />
                      </StackPanel>
                    </Button>
                  </StackPanel>

                </StackPanel>
              </Border>
              
            </StackPanel>
          </controls:CollapsiblePanel>

          <!-- Center Panel: Preview Grid -->
          <Border Grid.Column="1" Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}" BorderThickness="1" CornerRadius="4" Padding="4">
            <Grid RowDefinitions="Auto,*">
              <!-- Grid Header -->
              <Border Grid.Row="0" Background="{DynamicResource MTM_Shared_Logic.PrimaryAction}" CornerRadius="3" Padding="6,4" Margin="0,0,0,4">
                <Grid ColumnDefinitions="Auto,*,Auto">
                  <materialIcons:MaterialIcon Grid.Column="0" Kind="Eye" Width="14" Height="14" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" Margin="0,0,4,0" />
                  <TextBlock Grid.Column="1" Text="Transaction Preview" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" VerticalAlignment="Center" />
                  <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="3">
                    <TextBlock Text="{Binding SelectedLocations.Count}" FontSize="10" FontWeight="Bold" Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" VerticalAlignment="Center" />
                    <TextBlock Text="items" FontSize="9" Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" VerticalAlignment="Center" />
                  </StackPanel>
                </Grid>
              </Border>
              
              <!-- Preview Data Grid -->
              <DataGrid Grid.Row="1" ItemsSource="{Binding SelectedLocations}" AutoGenerateColumns="False" FontSize="9" RowHeight="20">
                <DataGrid.Columns>
                  <DataGridTextColumn Header="Location" Binding="{Binding .}" Width="*" />
                </DataGrid.Columns>
              </DataGrid>
            </Grid>
          </Border>
          
        </Grid>
      </Border>

    <!-- Action Buttons Panel -->
    <Border Grid.Row="1" Background="{DynamicResource MTM_Shared_Logic.PanelBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,0,8">
      <Grid ColumnDefinitions="*,Auto">
        <!-- Left side buttons -->
        <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left" Spacing="4">
          <Button Classes="action-button primary" Width="80" Height="24" Command="{Binding AddMultipleTimesCommand}" IsEnabled="{Binding CanAddMultipleTimes}" ToolTip.Tip="Add to preview">
            <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="Plus" Width="10" Height="10" />
              <TextBlock Text="Add Preview" FontSize="9" />
            </StackPanel>
          </Button>
          <Button Classes="action-button success" Width="70" Height="24" Command="{Binding AddToMultipleLocationsCommand}" IsEnabled="{Binding CanAddToMultipleLocations}" ToolTip.Tip="Save all transactions">
            <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="ContentSave" Width="10" Height="10" />
              <TextBlock Text="Save All" FontSize="9" />
            </StackPanel>
          </Button>
          <Button Classes="action-button warning" Width="50" Height="24" Command="{Binding ResetMultipleLocationsCommand}" ToolTip.Tip="Reset form">
            <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="Refresh" Width="10" Height="10" />
              <TextBlock Text="Reset" FontSize="9" />
            </StackPanel>
          </Button>
        </StackPanel>

        <!-- Right side - back button -->
        <Button Grid.Column="1" Classes="action-button secondary" Width="100" Height="24" Command="{Binding BackToNormalCommand}" ToolTip.Tip="Back to normal entry">
          <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center" VerticalAlignment="Center">
            <materialIcons:MaterialIcon Kind="ArrowLeft" Width="10" Height="10" />
            <TextBlock Text="Back to Normal" FontSize="9" />
          </StackPanel>
        </Button>
      </Grid>
    </Border>

    </Grid>
  </ScrollViewer>
</UserControl>
