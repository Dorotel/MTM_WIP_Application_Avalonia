<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels.MainForm"
             xmlns:views="using:MTM_WIP_Application_Avalonia.Views"
             xmlns:overlayViews="using:MTM_WIP_Application_Avalonia.Views.Overlay"
             xmlns:overlays="using:MTM_WIP_Application_Avalonia.Views.MainForm.Overlays"
             xmlns:panelViews="using:MTM_WIP_Application_Avalonia.Views.MainForm.Panels"
             xmlns:controls="using:MTM_WIP_Application_Avalonia.Controls"
             xmlns:converters="using:MTM_WIP_Application_Avalonia.Converters"
             xmlns:materialIcons="using:Material.Icons.Avalonia"
             mc:Ignorable="d"
             d:DesignWidth="1200"
             d:DesignHeight="700"
             x:Class="MTM_WIP_Application_Avalonia.Views.MainView"
             x:CompileBindings="True"
             x:DataType="vm:MainViewViewModel"
             HorizontalAlignment="Stretch"
             VerticalAlignment="Stretch"
             VerticalContentAlignment="Stretch"
             HorizontalContentAlignment="Stretch"
             Background="{DynamicResource ThemeV2.Background.Canvas}">

  <UserControl.Resources>
    <!-- Theme V2 Resources - Professional gradient effects and modern styling -->
    <ResourceDictionary>
      <converters:ColorToBoxShadowConverter x:Key="ColorToBoxShadowConverter"/>
    </ResourceDictionary>
  </UserControl.Resources>

  <UserControl.Styles>
    <!-- Beautiful MTM icon styling with gradient effects -->
    <Style Selector="materialIcons|MaterialIcon.nav-icon">
      <Setter Property="Foreground">
        <Setter.Value>
          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
            <GradientStop Color="{DynamicResource ThemeV2.Color.Blue.600}" Offset="0" />
            <GradientStop Color="{DynamicResource ThemeV2.Color.Blue.400}" Offset="1" />
          </LinearGradientBrush>
        </Setter.Value>
      </Setter>
      <Setter Property="Width" Value="20" />
      <Setter Property="Height" Value="20" />
    </Style>

    <!-- Beautiful form title styling with professional gradient -->
    <Style Selector="TextBlock.main-title">
      <Setter Property="Foreground">
        <Setter.Value>
          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,0%">
            <GradientStop Color="{DynamicResource ThemeV2.Color.Blue.700}" Offset="0" />
            <GradientStop Color="{DynamicResource ThemeV2.Color.Blue.500}" Offset="1" />
          </LinearGradientBrush>
        </Setter.Value>
      </Setter>
      <Setter Property="FontWeight" Value="Bold" />
      <Setter Property="FontSize" Value="24" />
    </Style>
  </UserControl.Styles>

  <UserControl.Styles>
    <!-- TabControl styling is now handled globally by MTMComponents.axaml -->
  </UserControl.Styles>

  <!-- Keyboard shortcuts -->
  <UserControl.KeyBindings>
    <KeyBinding Gesture="F5" Command="{Binding RefreshCommand}"/>
    <KeyBinding Gesture="Ctrl+S" Command="{Binding OpenSettingsCommand}"/>
    <KeyBinding Gesture="Ctrl+H" Command="{Binding OpenPersonalHistoryCommand}"/>
    <KeyBinding Gesture="Escape" Command="{Binding CancelCommand}"/>
    <!-- Remove tab specific shortcuts -->
    <KeyBinding Gesture="Delete" Command="{Binding RemoveItemViewModel.DeleteCommand}"/>
    <KeyBinding Gesture="Ctrl+Z" Command="{Binding RemoveItemViewModel.UndoCommand}"/>
    <KeyBinding Gesture="Ctrl+P" Command="{Binding RemoveItemViewModel.PrintCommand}"/>
  </UserControl.KeyBindings>

  <!-- Main container that stretches to fill entire available space -->
  <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
    <DockPanel HorizontalAlignment="Stretch"
               VerticalAlignment="Stretch"
               LastChildFill="True">

    <!-- Header Menu with MTM Branding and beautiful styling -->
    <Border DockPanel.Dock="Top"
            Padding="24,8"
            HorizontalAlignment="Stretch">
      <Border.Background>
        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,0%">
          <GradientStop Color="{DynamicResource ThemeV2.Color.Blue.600}" Offset="0" />
          <GradientStop Color="{DynamicResource ThemeV2.Color.Blue.500}" Offset="1" />
        </LinearGradientBrush>
      </Border.Background>
      <Border.Effect>
        <DropShadowEffect Color="{DynamicResource ThemeV2.Color.Blue.400}"
                          BlurRadius="8"
                          OffsetX="0"
                          OffsetY="2"
                          Opacity="0.3"/>
      </Border.Effect>
      <Grid ColumnDefinitions="*,Auto" HorizontalAlignment="Stretch">
        <!-- Left side: Beautiful Menu with professional styling -->
        <Menu Grid.Column="0"
              Background="Transparent"
              Foreground="White"
              HorizontalAlignment="Left">
          <MenuItem Header="_File" Foreground="White" FontWeight="SemiBold">
            <MenuItem Header="_Settings" Command="{Binding OpenSettingsCommand}" Foreground="{DynamicResource ThemeV2.Content.Primary}"/>
            <Separator/>
            <MenuItem Header="E_xit" Command="{Binding ExitCommand}" Foreground="{DynamicResource ThemeV2.Content.Primary}"/>
          </MenuItem>
          <MenuItem Header="_View" Foreground="White" FontWeight="SemiBold">
            <MenuItem Header="_Personal History" Command="{Binding OpenPersonalHistoryCommand}" Foreground="{DynamicResource ThemeV2.Content.Primary}"/>
          </MenuItem>
          <!-- Development builds only -->
          <MenuItem Header="_Help"
                    Foreground="White"
                    FontWeight="SemiBold"
                    IsVisible="{Binding ShowDevelopmentMenu, FallbackValue=False}">
            <MenuItem Header="_About" Command="{Binding OpenAboutCommand}" Foreground="{DynamicResource ThemeV2.Content.Primary}"/>
          </MenuItem>
        </Menu>

        <!-- Right side: Theme Quick Switcher -->
        <overlays:ThemeQuickSwitcher x:Name="ThemeQuickSwitcher"
                                 Grid.Column="1"
                                 HorizontalAlignment="Right"
                                 VerticalAlignment="Center"
                                 Margin="16,0,0,0"/>
      </Grid>
    </Border>

    <!-- Enhanced Status Bar with beautiful theming -->
    <Border DockPanel.Dock="Bottom"
            Background="{DynamicResource ThemeV2.Background.Surface}"
            Padding="24,12"
            HorizontalAlignment="Stretch"
            MinHeight="48"
            BorderBrush="{DynamicResource ThemeV2.Border.Subtle}"
            BorderThickness="0,1,0,0">
      <Border.Effect>
        <DropShadowEffect Color="{DynamicResource ThemeV2.Color.Gray.400}"
                          BlurRadius="4"
                          OffsetX="0"
                          OffsetY="-1"
                          Opacity="0.2"/>
      </Border.Effect>
      <Grid ColumnDefinitions="Auto,*,Auto,Auto"
            ColumnSpacing="16"
            HorizontalAlignment="Stretch">

        <!-- Progress Overlay Display -->
        <overlayViews:ProgressOverlayView Grid.Column="0"
                                         HorizontalAlignment="Left"
                                         VerticalAlignment="Center"
                                         DataContext="{Binding ProgressOverlayService.CurrentProgressOverlay}"
                                         MinWidth="200"
                                         MaxWidth="280" />

        <!-- Spacer -->
        <Border Grid.Column="1" Background="Transparent"/>

        <!-- Enhanced Status Text Box with beautiful styling -->
        <Border Grid.Column="2"
                Background="{DynamicResource ThemeV2.Background.Card}"
                BorderBrush="{DynamicResource ThemeV2.Border.Default}"
                BorderThickness="1"
                Padding="16,10"
                CornerRadius="8"
                MinWidth="140"
                HorizontalAlignment="Right">
          <Border.Effect>
            <DropShadowEffect Color="{DynamicResource ThemeV2.Color.Gray.300}"
                              BlurRadius="4"
                              OffsetX="0"
                              OffsetY="1"
                              Opacity="0.2"/>
          </Border.Effect>
          <TextBlock Text="{Binding StatusText, FallbackValue='Ready', TargetNullValue='Ready'}"
                     Foreground="{DynamicResource ThemeV2.Content.Primary}"
                     FontSize="12"
                     FontWeight="SemiBold"
                     VerticalAlignment="Center"
                     TextTrimming="CharacterEllipsis"
                     ToolTip.Tip="{Binding StatusText}"/>
        </Border>

        <!-- Enhanced Version Display with professional gradient -->
        <Border Grid.Column="3"
                CornerRadius="16"
                Padding="16,8"
                HorizontalAlignment="Right">
          <Border.Background>
            <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
              <GradientStop Color="{DynamicResource ThemeV2.Color.Blue.600}" Offset="0" />
              <GradientStop Color="{DynamicResource ThemeV2.Color.Blue.500}" Offset="1" />
            </LinearGradientBrush>
          </Border.Background>
          <Border.Effect>
            <DropShadowEffect Color="{DynamicResource ThemeV2.Color.Blue.400}"
                              BlurRadius="6"
                              OffsetX="0"
                              OffsetY="2"
                              Opacity="0.3"/>
          </Border.Effect>
          <TextBlock Text="Ver. 5.0"
                     Foreground="White"
                     FontSize="11"
                     FontWeight="Bold"
                     VerticalAlignment="Center"/>
        </Border>
      </Grid>
    </Border>

    <!-- Main Content Area - Fills remaining space -->
    <Grid HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch"
          Margin="8">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" MinWidth="400"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>

      <!-- Left Panel: Tab Control - Stretches fully -->
      <Grid Grid.Column="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
        <!-- Beautiful Main Tab Control with enhanced visual design -->
        <Border Background="{DynamicResource ThemeV2.Background.Card}"
                BorderBrush="{DynamicResource ThemeV2.Border.Default}"
                BorderThickness="1"
                CornerRadius="12"
                Margin="8"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
          <Border.Effect>
            <DropShadowEffect Color="{DynamicResource ThemeV2.Color.Gray.400}"
                              BlurRadius="12"
                              OffsetX="0"
                              OffsetY="4"
                              Opacity="0.15"/>
          </Border.Effect>
          <TabControl x:Name="MainForm_TabControl"
                      SelectedIndex="{Binding SelectedTabIndex, Mode=TwoWay, FallbackValue=0}"
                      SelectionChanged="OnTabSelectionChanged"
                      PointerPressed="OnTabControlPointerPressed"
                      Background="Transparent"
                      HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    HorizontalContentAlignment="Stretch"
                    VerticalContentAlignment="Stretch">

          <!-- Beautiful Inventory Tab with Material Design icons -->
          <TabItem>
            <TabItem.Header>
              <StackPanel Orientation="Horizontal" Spacing="12">
                <Border Background="{DynamicResource ThemeV2.Action.Primary}"
                        CornerRadius="6"
                        Width="28"
                        Height="28"
                        Padding="4">
                  <materialIcons:MaterialIcon Kind="Archive"
                                              Classes="nav-icon"
                                              Foreground="White"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                </Border>
                <TextBlock Text="Inventory"
                           Classes="main-title"
                           FontSize="16"
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"/>
              </StackPanel>
            </TabItem.Header>
            <!-- Content container that stretches to fill all available space -->
            <DockPanel HorizontalAlignment="Stretch" VerticalAlignment="Stretch" LastChildFill="True">
              <ContentControl Content="{Binding InventoryContent}"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch"
                              HorizontalContentAlignment="Stretch"
                              VerticalContentAlignment="Stretch"/>
            </DockPanel>
          </TabItem>

          <!-- Beautiful Remove Tab with Material Design -->
          <TabItem>
            <TabItem.Header>
              <StackPanel Orientation="Horizontal" Spacing="12">
                <Border Background="{DynamicResource ThemeV2.Status.Warning}"
                        CornerRadius="6"
                        Width="28"
                        Height="28"
                        Padding="4">
                  <materialIcons:MaterialIcon Kind="Delete"
                                              Foreground="White"
                                              Width="18"
                                              Height="18"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                </Border>
                <TextBlock Text="Remove"
                           Classes="main-title"
                           FontSize="16"
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"/>
              </StackPanel>
            </TabItem.Header>
            <!-- Content container that stretches to fill all available space -->
            <DockPanel HorizontalAlignment="Stretch" VerticalAlignment="Stretch" LastChildFill="True">
              <ContentControl Content="{Binding RemoveContent}"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch"
                              HorizontalContentAlignment="Stretch"
                              VerticalContentAlignment="Stretch"/>
            </DockPanel>
          </TabItem>

          <!-- Beautiful Transfer Tab with Material Design -->
          <TabItem>
            <TabItem.Header>
              <StackPanel Orientation="Horizontal" Spacing="12">
                <Border Background="{DynamicResource ThemeV2.Status.Success}"
                        CornerRadius="6"
                        Width="28"
                        Height="28"
                        Padding="4">
                  <materialIcons:MaterialIcon Kind="SwapHorizontal"
                                              Foreground="White"
                                              Width="18"
                                              Height="18"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                </Border>
                <TextBlock Text="Transfer"
                           Classes="main-title"
                           FontSize="16"
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"/>
              </StackPanel>
            </TabItem.Header>
            <!-- Content container that stretches to fill all available space -->
            <DockPanel HorizontalAlignment="Stretch" VerticalAlignment="Stretch" LastChildFill="True">
              <ContentControl Content="{Binding TransferContent}"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch"
                              HorizontalContentAlignment="Stretch"
                              VerticalContentAlignment="Stretch"/>
            </DockPanel>
          </TabItem>
        </TabControl>
        </Border>

        <!-- Enhanced Suggestion Overlay Panel with beautiful theming -->
        <Border x:Name="SuggestionOverlayPanel"
                IsVisible="False"
                Background="{DynamicResource ThemeV2.Overlay.Background}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Margin="8"
                CornerRadius="12"
                ZIndex="1003">
          <!-- Centered overlay container with enhanced styling -->
          <Border Padding="20"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch"
                  Background="{DynamicResource ThemeV2.Background.Card}"
                  BorderBrush="{DynamicResource ThemeV2.Border.Default}"
                  BorderThickness="1"
                  CornerRadius="16">
            <Border.Effect>
              <DropShadowEffect Color="{DynamicResource ThemeV2.Color.Gray.500}"
                                BlurRadius="20"
                                OffsetX="0"
                                OffsetY="8"
                                Opacity="0.25"/>
            </Border.Effect>
            <!-- Overlay content will be dynamically set -->
            <ContentControl x:Name="SuggestionOverlayContent"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            HorizontalContentAlignment="Stretch"
                            VerticalContentAlignment="Stretch"/>
          </Border>
        </Border>

        <!-- Enhanced Success Overlay Panel with professional design -->
        <Border x:Name="SuccessOverlayPanel"
                IsVisible="False"
                Background="{DynamicResource ThemeV2.Overlay.Background}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Margin="8"
                CornerRadius="12"
                ZIndex="1001">
          <!-- Success overlay content will be dynamically set -->
          <ContentControl x:Name="SuccessOverlayContent"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch"
                          VerticalContentAlignment="Stretch"/>
        </Border>

        <!-- Enhanced NewQuickButton View Panel with beautiful overlay -->
        <Border x:Name="NewQuickButtonOverlayPanel"
                IsVisible="False"
                Background="{DynamicResource ThemeV2.Overlay.Background}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Margin="8"
                CornerRadius="12"
                ZIndex="1002">
          <!-- NewQuickButton view content -->
          <views:NewQuickButtonView x:Name="NewQuickButtonView"
                                        DataContext="{x:Null}"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        MaxWidth="600"
                                        MaxHeight="500"/>
        </Border>
      </Grid>

      <!-- Right Panel: Collapsible Quick Actions with increased width -->
      <controls:CollapsiblePanel Grid.Column="1"
                                HeaderPosition="Right"
                                IsExpanded="{Binding IsQuickActionsPanelExpanded, Mode=TwoWay}"
                                IsVisible="{Binding IsAdvancedPanelVisible, FallbackValue=True}"
                                Margin="0,8,8,8"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Stretch"
                                MinWidth="280"
                                MaxWidth="320">
        <views:QuickButtonsView DataContext="{Binding QuickButtonsViewModel}"
                               HorizontalAlignment="Stretch"
                               VerticalAlignment="Stretch"/>
      </controls:CollapsiblePanel>
    </Grid>
  </DockPanel>

  <!-- SuggestionOverlayView removed for overlay ViewModel reset -->
  </Grid>
</UserControl>
