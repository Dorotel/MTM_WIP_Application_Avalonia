<UserControl xmlns="https://github.com/avaloniaui"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels.MainForm"
xmlns:materialIcons="using:Material.Icons.Avalonia"
xmlns:controls="using:MTM_WIP_Application_Avalonia.Views.Overlay"
xmlns:behaviors="using:MTM_WIP_Application_Avalonia.Behaviors"
mc:Ignorable="d"
d:DesignWidth="800"
d:DesignHeight="600"
x:Class="MTM_WIP_Application_Avalonia.Views.InventoryTabView"
x:CompileBindings="True"
x:DataType="vm:InventoryTabViewModel">

  <UserControl.Styles>
    <!-- MTM Theme Input Field Styles -->
    <Style Selector="TextBox.input-field">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.BodyText}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="Padding" Value="8,6" />
      <Setter Property="MinHeight" Value="32" />
      <Setter Property="HorizontalContentAlignment" Value="Left" />
      <Setter Property="VerticalContentAlignment" Value="Center" />
    </Style>

    <!-- Error state styling -->
    <Style Selector="TextBox.input-field.error">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.ErrorBrush}" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.ErrorLightBrush}" />
    </Style>

    <!-- Focus state styling -->
    <Style Selector="TextBox.input-field:focus">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.FocusBrush}" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.HoverBackground}" />
    </Style>

    <!-- AutoCompleteBox styling -->
    <Style Selector="AutoCompleteBox.input-field">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.BodyText}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="Padding" Value="8,6" />
      <Setter Property="MinHeight" Value="32" />
    </Style>

    <!-- Material Icons global styling -->
    <Style Selector="materialIcons|MaterialIcon">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.InteractiveText}" />
      <Setter Property="HorizontalAlignment" Value="Center" />
      <Setter Property="VerticalAlignment" Value="Center" />
    </Style>

    <!-- Primary Button styling -->
    <Style Selector="Button.primary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="MinHeight" Value="32" />
      <Setter Property="Padding" Value="12,6" />
    </Style>

    <!-- Secondary Button styling - Enhanced border visibility -->
    <Style Selector="Button.secondary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.HeadingText}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}" />
      <Setter Property="BorderThickness" Value="1.5" />
      <Setter Property="CornerRadius" Value="4" />
      <Setter Property="MinHeight" Value="32" />
      <Setter Property="Padding" Value="12,6" />
    </Style>

    <Style Selector="Button.secondary:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.HoverBackground}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.BorderDarkBrush}" />
    </Style>

    <!-- Note: Error and success message styling removed - handled by SuccessOverlayView -->
  </UserControl.Styles>

  <!-- Root Container with Overlay Support -->
  <Grid x:Name="RootContainer">

    <!-- Main Content Layer -->
    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Background="{DynamicResource MTM_Shared_Logic.MainBackground}">

      <Grid x:Name="MainContainer" RowDefinitions="*,Auto" MinWidth="600" MinHeight="400" Margin="8">

      <!-- Main Entry Panel -->
      <Border Grid.Row="0"  Background="{DynamicResource MTM_Shared_Logic.PanelBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}" BorderThickness="1" CornerRadius="6" Padding="16" Margin="0,0,0,8">

        <Grid x:Name="EntryFormGrid" RowDefinitions="Auto,*">

          <!-- Form Fields Section -->
          <Grid x:Name="FormFieldsGrid" Grid.Row="1" RowDefinitions="Auto,Auto,Auto,Auto,*" RowSpacing="12">

            <!-- Part ID Field -->
            <Grid x:Name="PartIdGrid" Grid.Row="0" ColumnDefinitions="90,*" ColumnSpacing="12">
              <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center" Width="90">
                <materialIcons:MaterialIcon Kind="Identifier" Width="14" Height="14" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" />
                <TextBlock Text="Part ID:" FontSize="12" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" VerticalAlignment="Center" />
              </StackPanel>
              <TextBox Grid.Column="1" x:Name="PartTextBox" Text="{Binding SelectedPart, Mode=TwoWay}" Watermark="{Binding PartWatermark}" Classes="input-field" ToolTip.Tip="Select or enter a part number" TabIndex="1" behaviors:TextBoxFuzzyValidationBehavior.EnableFuzzyValidation="True" behaviors:TextBoxFuzzyValidationBehavior.ValidationSource="{Binding PartIds}" />
            </Grid>

            <!-- Operation Field -->
            <Grid x:Name="OperationGrid" Grid.Row="1" ColumnDefinitions="90,*" ColumnSpacing="12">
              <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center" Width="90">
                <materialIcons:MaterialIcon Kind="Cog" Width="14" Height="14" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" />
                <TextBlock Text="Operation:" FontSize="12" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" VerticalAlignment="Center" />
              </StackPanel>
              <TextBox Grid.Column="1" x:Name="OperationTextBox" Text="{Binding SelectedOperation, Mode=TwoWay}" Watermark="{Binding OperationWatermark}" Classes="input-field" ToolTip.Tip="Select or enter an operation number" TabIndex="2" behaviors:TextBoxFuzzyValidationBehavior.EnableFuzzyValidation="True" behaviors:TextBoxFuzzyValidationBehavior.ValidationSource="{Binding Operations}" />
            </Grid>

            <!-- Location Field -->
            <Grid x:Name="LocationGrid" Grid.Row="2" ColumnDefinitions="90,*" ColumnSpacing="12">
              <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center" Width="90">
                <materialIcons:MaterialIcon Kind="MapMarker" Width="14" Height="14" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" />
                <TextBlock Text="Location:" FontSize="12" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" VerticalAlignment="Center" />
              </StackPanel>
              <TextBox Grid.Column="1" x:Name="LocationTextBox" Text="{Binding SelectedLocation, Mode=TwoWay}" Watermark="{Binding LocationWatermark}" Classes="input-field" ToolTip.Tip="Select or enter a location" TabIndex="3" behaviors:TextBoxFuzzyValidationBehavior.EnableFuzzyValidation="True" behaviors:TextBoxFuzzyValidationBehavior.ValidationSource="{Binding Locations}" />
            </Grid>

            <!-- Quantity Field -->
            <Grid x:Name="QuantityGrid" Grid.Row="3" ColumnDefinitions="90,*" ColumnSpacing="12">
              <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center" Width="90">
                <materialIcons:MaterialIcon Kind="Counter" Width="14" Height="14" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" />
                <TextBlock Text="Quantity:" FontSize="12" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" VerticalAlignment="Center" />
              </StackPanel>
              <TextBox Grid.Column="1" x:Name="QuantityTextBox" Text="{Binding QuantityText, Mode=TwoWay}" Watermark="{Binding QuantityWatermark}" Classes="input-field" Classes.error="{Binding !IsQuantityValid}" ToolTip.Tip="Enter numeric quantity" TabIndex="4" />
            </Grid>

            <!-- Notes Field -->
            <Grid x:Name="NotesGrid" Grid.Row="4" ColumnDefinitions="90,*" ColumnSpacing="12">
              <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Top" Width="90" Margin="0,4,0,0">
                <materialIcons:MaterialIcon Kind="NoteText" Width="14" Height="14" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" />
                <TextBlock Text="Notes:" FontSize="12" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" VerticalAlignment="Center" />
              </StackPanel>
              <TextBox Grid.Column="1" x:Name="NotesTextBox" Text="{Binding Notes, Mode=TwoWay}" Watermark="{Binding NotesWatermark}" Classes="input-field" AcceptsReturn="True" TextWrapping="Wrap" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" VerticalContentAlignment="Top" ToolTip.Tip="Optional notes or comments" TabIndex="5" />
            </Grid>

          </Grid>
        </Grid>
      </Border>

      <!-- Action Buttons Panel -->
      <Border Grid.Row="1" Background="{DynamicResource MTM_Shared_Logic.PanelBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,0,8">

        <Grid x:Name="ActionButtonsGrid" ColumnDefinitions="Auto,*">

          <!-- Action buttons -->
          <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left" Spacing="8">

            <Button x:Name="SaveButton" Classes="primary" Width="100" Command="{Binding SaveCommand}" IsEnabled="{Binding CanSave}" ToolTip.Tip="Save inventory item (Enter to execute)" TabIndex="6">
              <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="6">
                <materialIcons:MaterialIcon Kind="ContentSave" Width="14" Height="14" HorizontalAlignment="Center"  VerticalAlignment="Center" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                <TextBlock Text="Save" FontSize="11" HorizontalAlignment="Center"  VerticalAlignment="Center"  FontWeight="SemiBold" Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" />
              </StackPanel>
            </Button>

            <Button Classes="secondary" Width="100" Command="{Binding ResetCommand}" CommandParameter="False" ToolTip.Tip="Reset form (F5 for soft reset, Shift+F5 for hard reset)">
              <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="6">
                <materialIcons:MaterialIcon Kind="Refresh" Width="14" Height="14" HorizontalAlignment="Center" VerticalAlignment="Center" />
                <TextBlock Text="Reset" FontSize="11" HorizontalAlignment="Center" VerticalAlignment="Center" />
              </StackPanel>
            </Button>
                                  </StackPanel>
          <Grid Grid.Column="1" HorizontalAlignment="Right" >
            <Button Classes="secondary" Width="100" Command="{Binding AdvancedEntryCommand}" ToolTip.Tip="Open advanced inventory features">
              <StackPanel Orientation="Horizontal" HorizontalAlignment="Center"  VerticalAlignment="Center" Spacing="6">
                <materialIcons:MaterialIcon Kind="Settings" Width="14" Height="14" HorizontalAlignment="Center"  VerticalAlignment="Center"  />
                <TextBlock Text="Advanced" FontSize="11" HorizontalAlignment="Center"  VerticalAlignment="Center"  />
              </StackPanel>
            </Button>
          </Grid>

        </Grid>
      </Border>

    </Grid>
  </ScrollViewer>

  <!-- Overlay Layer - Positioned on top with high Z-Index -->
  <!-- Loading Overlay -->
  <Border x:Name="LoadingOverlayContainer"
          Background="#80000000"
          IsVisible="{Binding IsLoading}"
          ZIndex="1000">
    <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
      <Border Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
              BorderBrush="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}"
              BorderThickness="1"
              CornerRadius="8"
              Padding="24"
              MinWidth="200"
              MinHeight="100">
        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
          <!-- Loading Spinner -->
          <Border Width="32" Height="32"
                  BorderBrush="{DynamicResource MTM_Shared_Logic.PrimaryAction}"
                  BorderThickness="3"
                  CornerRadius="16">
            <Border.RenderTransform>
              <RotateTransform x:Name="LoadingSpinnerTransform" />
            </Border.RenderTransform>
            <Border.Styles>
              <Style Selector="Border[IsVisible=True]">
                <Style.Animations>
                  <Animation Duration="0:0:1" IterationCount="INFINITE">
                    <KeyFrame Cue="0%">
                      <Setter Property="RenderTransform.Angle" Value="0" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                      <Setter Property="RenderTransform.Angle" Value="360" />
                    </KeyFrame>
                  </Animation>
                </Style.Animations>
              </Style>
            </Border.Styles>
          </Border>

          <!-- Loading Message -->
          <TextBlock Text="Saving inventory item..."
                     FontSize="14"
                     FontWeight="Medium"
                     Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}"
                     HorizontalAlignment="Center"
                     TextAlignment="Center" />

          <!-- Progress Indicator (optional) -->
          <TextBlock Text="{Binding ApplicationStateService.CurrentProgressMessage}"
                     FontSize="12"
                     Foreground="{DynamicResource MTM_Shared_Logic.BodyText}"
                     HorizontalAlignment="Center"
                     TextAlignment="Center"
                     IsVisible="{Binding ApplicationStateService.HasProgress}" />
        </StackPanel>
      </Border>
    </Grid>
  </Border>

  </Grid>
</UserControl>

