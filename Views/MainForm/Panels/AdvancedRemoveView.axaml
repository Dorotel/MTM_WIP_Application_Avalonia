<UserControl xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:vm="using:MTM_WIP_Application_Avalonia.ViewModels.MainForm" xmlns:materialIcons="using:Material.Icons.Avalonia" xmlns:controls="using:MTM_WIP_Application_Avalonia.Controls" xmlns:i="using:Avalonia.Xaml.Interactivity" xmlns:behaviors="using:MTM_WIP_Application_Avalonia.Behaviors" mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800" x:Class="MTM_WIP_Application_Avalonia.Views.AdvancedRemoveView"  HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" x:CompileBindings="True" x:DataType="vm:AdvancedRemoveViewModel">

  <UserControl.Resources>
    <!-- Theme resources will be provided by DynamicResource bindings -->
    <!-- Remove hardcoded colors and use theme resources from App.axaml -->
  </UserControl.Resources>

  <UserControl.Styles>
    <!-- Compact Input Styles -->
    <Style Selector="TextBox.input-field">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="3" />
      <Setter Property="Padding" Value="6,3" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="FontSize" Value="10" />
      <Setter Property="Margin" Value="2" />
    </Style>

    <Style Selector="AutoCompleteBox.input-field">
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="3" />
      <Setter Property="Padding" Value="6,3" />
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="FontSize" Value="10" />
      <Setter Property="Margin" Value="2" />
    </Style>

    <!-- Compact Button Styles -->
    <Style Selector="Button.action-button">
      <Setter Property="Padding" Value="6,3" />
      <Setter Property="Margin" Value="2" />
      <Setter Property="FontSize" Value="10" />
      <Setter Property="FontWeight" Value="Medium" />
      <Setter Property="CornerRadius" Value="3" />
      <Setter Property="Cursor" Value="Hand" />
      <Setter Property="HorizontalContentAlignment" Value="Center" />
      <Setter Property="VerticalContentAlignment" Value="Center" />
    </Style>

    <Style Selector="Button.primary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.HeadingText}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>
    <Style Selector="Button.primary:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.DarkNavigation}" />
    </Style>

    <Style Selector="Button.secondary">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.HeadingText}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>
    <Style Selector="Button.secondary:pointerover">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.PrimaryAction}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.HeadingText}" />
    </Style>

    <Style Selector="Button.danger">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.ErrorBrush}" />
      <Setter Property="Foreground" Value="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.ErrorBrush}" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>

    <!-- DataGrid styling -->
    <Style Selector="DataGrid">
      <Setter Property="Background" Value="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" />
      <Setter Property="BorderBrush" Value="{DynamicResource MTM_Shared_Logic.BorderBrush}" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="3" />
      <Setter Property="GridLinesVisibility" Value="Horizontal" />
      <Setter Property="HeadersVisibility" Value="Column" />
      <Setter Property="CanUserReorderColumns" Value="True" />
      <Setter Property="CanUserResizeColumns" Value="True" />
      <Setter Property="CanUserSortColumns" Value="True" />
      <Setter Property="IsReadOnly" Value="True" />
      <Setter Property="SelectionMode" Value="Extended" />
    </Style>
  </UserControl.Styles>

  <!-- Main Layout Container - ScrollViewer for overflow handling -->


    <Grid x:Name="MainContainer" RowDefinitions="*,Auto" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" MinWidth="600" MinHeight="400" Margin="8">

      <!-- Main Entry Panel -->
      <Border Grid.Row="0" Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}" BorderThickness="1" CornerRadius="8" Padding="16" Margin="0,0,0,8">
      <Grid ColumnSpacing="6">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />   <!-- Left Panel: Auto-sizes based on CollapsiblePanel state -->
          <ColumnDefinition Width="*" />      <!-- Center Panel: Stretches to fill available space -->
          <ColumnDefinition Width="Auto" />   <!-- Right Panel: Auto-sizes based on CollapsiblePanel state -->
        </Grid.ColumnDefinitions>

        <!-- Left Panel: Search Criteria using CollapsiblePanel -->
        <!-- HeaderPosition options: Left, Right, Top, Bottom -->
        <controls:CollapsiblePanel Grid.Column="0" IsExpanded="{Binding IsFilterPanelExpanded, Mode=TwoWay}" HeaderPosition="Left">
          <!-- Filter Content -->
          <StackPanel Spacing="6">

            <!-- Part ID -->
            <StackPanel>
              <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                <materialIcons:MaterialIcon Grid.Column="0" Kind="Identifier" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="Part ID" />
              </Grid>
              <AutoCompleteBox ItemsSource="{Binding PartIDOptions}" Text="{Binding FilterPartIDText, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" Watermark="Enter Part ID..." ToolTip.Tip="Select or enter part ID to filter" MinimumPrefixLength="0" FilterMode="Contains" MaxDropDownHeight="200" IsTextCompletionEnabled="False" behaviors:ComboBoxBehavior.EnableComboBoxBehavior="True" />
            </StackPanel>

            <!-- Location -->
            <StackPanel>
              <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                <materialIcons:MaterialIcon Grid.Column="0" Kind="MapMarker" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="Location" />
              </Grid>
              <AutoCompleteBox ItemsSource="{Binding LocationOptions}" Text="{Binding FilterLocationText, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" Watermark="Enter Location..." ToolTip.Tip="Select or enter location to filter" MinimumPrefixLength="0" FilterMode="Contains" MaxDropDownHeight="200" IsTextCompletionEnabled="False" behaviors:ComboBoxBehavior.EnableComboBoxBehavior="True" />
            </StackPanel>

            <!-- Operation -->
            <StackPanel>
              <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                <materialIcons:MaterialIcon Grid.Column="0" Kind="Cog" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="Operation" />
              </Grid>
              <AutoCompleteBox ItemsSource="{Binding OperationOptions}" Text="{Binding FilterOperation, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" Watermark="Enter Operation..." ToolTip.Tip="Select or enter operation to filter" MinimumPrefixLength="0" FilterMode="StartsWith" MaxDropDownHeight="200" IsTextCompletionEnabled="False" behaviors:ComboBoxBehavior.EnableComboBoxBehavior="True" />
            </StackPanel>

            <!-- User -->
            <StackPanel>
              <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                <materialIcons:MaterialIcon Grid.Column="0" Kind="Account" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="User" />
              </Grid>
              <AutoCompleteBox ItemsSource="{Binding UserOptions}" Text="{Binding FilterUserText, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" Watermark="Enter User..." ToolTip.Tip="Select or enter user to filter" MinimumPrefixLength="0" FilterMode="Contains" MaxDropDownHeight="200" IsTextCompletionEnabled="False" behaviors:ComboBoxBehavior.EnableComboBoxBehavior="True" />
            </StackPanel>

            <!-- Notes -->
            <StackPanel>
              <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                <materialIcons:MaterialIcon Grid.Column="0" Kind="NoteText" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="Notes" />
              </Grid>
              <TextBox Text="{Binding FilterNotes, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" Watermark="Enter Notes..." ToolTip.Tip="Enter notes text to filter" />
            </StackPanel>

            <!-- Quantity Range -->
            <StackPanel>
              <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3" Margin="0,0,0,1">
                <materialIcons:MaterialIcon Grid.Column="0" Kind="Counter" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" ToolTip.Tip="Quantity Range" />
              </Grid>
              <Grid ColumnDefinitions="*,3,*" ColumnSpacing="3">
                <TextBox Grid.Column="0" Watermark="Min" Text="{Binding QuantityMin, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" ToolTip.Tip="Minimum quantity" />
                <TextBox Grid.Column="2" Watermark="Max" Text="{Binding QuantityMax, Mode=TwoWay}" Classes="input-field" HorizontalAlignment="Stretch" ToolTip.Tip="Maximum quantity" />
              </Grid>
            </StackPanel>

            <!-- Date Range -->
            <StackPanel>
              <CheckBox IsChecked="{Binding UseDateRange, Mode=TwoWay}" FontSize="9" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" Margin="0,0,0,3" ToolTip.Tip="Enable date range filtering">
                <CheckBox.Content>
                  <Grid ColumnDefinitions="Auto,*" ColumnSpacing="3">
                    <materialIcons:MaterialIcon Grid.Column="0" Kind="CalendarRange" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" />
                    <TextBlock Grid.Column="1" Text="Date Range:" FontSize="9" FontWeight="Medium" />
                  </Grid>
                </CheckBox.Content>
              </CheckBox>
              <Grid ColumnDefinitions="*,3,*" ColumnSpacing="3" IsEnabled="{Binding UseDateRange}">
                <!-- Start Date -->
                <Border Grid.Column="0" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}" BorderThickness="1" CornerRadius="3" Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" Cursor="Hand">
                  <Grid>
                    <TextBox Text="{Binding RemovalDateRangeStart, StringFormat='{}{0:MM/dd/yyyy}', Mode=OneWay}" IsReadOnly="True" Classes="input-field" Background="Transparent" BorderThickness="0" Watermark="Start Date" HorizontalAlignment="Stretch" Padding="6,3,20,3" ToolTip.Tip="Click to select start date" />
                    <materialIcons:MaterialIcon Kind="Calendar" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,4,0" IsHitTestVisible="False" />
                    <Button Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Cursor="Hand" Padding="0" Margin="0">
                      <Button.Flyout>
                        <Flyout Placement="BottomEdgeAlignedLeft">
                          <Border Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}" BorderThickness="1" CornerRadius="4" Padding="8">
                            <StackPanel Spacing="6">
                              <Grid ColumnDefinitions="Auto,*" ColumnSpacing="4">
                                <materialIcons:MaterialIcon Grid.Column="0" Kind="CalendarStart" Width="12" Height="12" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" />
                                <TextBlock Grid.Column="1" Text="Select Start Date" FontSize="10" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                              </Grid>
                              <DatePicker SelectedDate="{Binding RemovalDateRangeStart, Mode=TwoWay}" FontSize="9" MinWidth="160" />
                            </StackPanel>
                          </Border>
                        </Flyout>
                      </Button.Flyout>
                    </Button>
                  </Grid>
                </Border>

                <!-- End Date -->
                <Border Grid.Column="2" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}" BorderThickness="1" CornerRadius="3" Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" Cursor="Hand">
                  <Grid>
                    <TextBox Text="{Binding RemovalDateRangeEnd, StringFormat='{}{0:MM/dd/yyyy}', Mode=OneWay}" IsReadOnly="True" Classes="input-field" Background="Transparent" BorderThickness="0" Watermark="End Date" HorizontalAlignment="Stretch" Padding="6,3,20,3" ToolTip.Tip="Click to select end date" />
                    <materialIcons:MaterialIcon Kind="Calendar" Width="10" Height="10" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,4,0" IsHitTestVisible="False" />
                    <Button Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Cursor="Hand" Padding="0" Margin="0">
                      <Button.Flyout>
                        <Flyout Placement="BottomEdgeAlignedLeft">
                          <Border Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}" BorderThickness="1" CornerRadius="4" Padding="8">
                            <StackPanel Spacing="6">
                              <Grid ColumnDefinitions="Auto,*" ColumnSpacing="4">
                                <materialIcons:MaterialIcon Grid.Column="0" Kind="CalendarEnd" Width="12" Height="12" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" />
                                <TextBlock Grid.Column="1" Text="Select End Date" FontSize="10" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                              </Grid>
                              <DatePicker SelectedDate="{Binding RemovalDateRangeEnd, Mode=TwoWay}" FontSize="9" MinWidth="160" />
                            </StackPanel>
                          </Border>
                        </Flyout>
                      </Button.Flyout>
                    </Button>
                  </Grid>
                </Border>
              </Grid>
            </StackPanel>

          </StackPanel>
        </controls:CollapsiblePanel>

        <!-- Center Panel: Main Results Grid (No CollapsiblePanel - static) -->
        <Border Grid.Column="1" Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}" BorderThickness="1" CornerRadius="4" Padding="16" Margin="3,0">
          <!-- Results Grid Content -->
          <Grid RowDefinitions="Auto,*">
            <!-- Grid Header -->
            <Border Grid.Row="0" Background="{DynamicResource MTM_Shared_Logic.PrimaryAction}" CornerRadius="3" Padding="6,4" Margin="0,0,0,4">
              <Grid ColumnDefinitions="Auto,*,Auto">
                <materialIcons:MaterialIcon Grid.Column="0" Kind="History" Width="14" Height="14" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" Margin="0,0,4,0" />
                <TextBlock Grid.Column="1" Text="Removal History" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" VerticalAlignment="Center" />
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="3">
                  <TextBlock Text="{Binding RemovalHistoryGrid.Count}" FontSize="10" FontWeight="Bold" Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" VerticalAlignment="Center" />
                  <TextBlock Text="records" FontSize="9" Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}" VerticalAlignment="Center" />
                </StackPanel>
              </Grid>
            </Border>

            <!-- Data Grid -->
            <DataGrid Grid.Row="1" ItemsSource="{Binding RemovalHistoryGrid}" SelectedItem="{Binding SelectedHistoryItem, Mode=TwoWay}" AutoGenerateColumns="False" FontSize="9" RowHeight="20">
              <DataGrid.Columns>
                <DataGridTextColumn Header="Date/Time" Binding="{Binding TransactionTime, StringFormat='yyyy-MM-dd HH:mm'}" Width="120" />
                <DataGridTextColumn Header="Part ID" Binding="{Binding PartId}" Width="100" />
                <DataGridTextColumn Header="Op" Binding="{Binding Operation}" Width="35" />
                <DataGridTextColumn Header="Location" Binding="{Binding Location}" Width="60" />
                <DataGridTextColumn Header="Qty" Binding="{Binding Quantity}" Width="40" />
                <DataGridTextColumn Header="User" Binding="{Binding User}" Width="50" />
                <DataGridTextColumn Header="Batch" Binding="{Binding BatchNumber}" Width="80" />
                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="60" />
              </DataGrid.Columns>
            </DataGrid>
          </Grid>
        </Border>

        <!-- Right Panel: Details/Actions Panel using CollapsiblePanel -->
        <controls:CollapsiblePanel Grid.Column="2" IsExpanded="True" HeaderPosition="Right">
          <!-- Details Content -->
          <StackPanel Spacing="8">

            <!-- Selected Item Details -->
            <Border Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}" BorderThickness="1" CornerRadius="4" Padding="8">
              <StackPanel Spacing="6">
                <!-- Header -->
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="4">
                  <materialIcons:MaterialIcon Grid.Column="0" Kind="InformationOutline" Width="12" Height="12" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" />
                  <TextBlock Grid.Column="1" Text="Selected Item Details" FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                </Grid>

                <!-- Details when item is selected -->
                <StackPanel Spacing="4" IsVisible="{Binding SelectedHistoryItem, Converter={x:Static ObjectConverters.IsNotNull}}">
                  <Grid ColumnDefinitions="60,*" ColumnSpacing="6">
                    <TextBlock Grid.Column="0" Text="Part ID:" FontSize="9" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                    <TextBlock Grid.Column="1" Text="{Binding SelectedHistoryItem.PartId}" FontSize="9" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                  </Grid>
                  <Grid ColumnDefinitions="60,*" ColumnSpacing="6">
                    <TextBlock Grid.Column="0" Text="Operation:" FontSize="9" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                    <TextBlock Grid.Column="1" Text="{Binding SelectedHistoryItem.Operation}" FontSize="9" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                  </Grid>
                  <Grid ColumnDefinitions="60,*" ColumnSpacing="6">
                    <TextBlock Grid.Column="0" Text="Quantity:" FontSize="9" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                    <TextBlock Grid.Column="1" Text="{Binding SelectedHistoryItem.Quantity}" FontSize="9" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                  </Grid>
                  <Grid ColumnDefinitions="60,*" ColumnSpacing="6">
                    <TextBlock Grid.Column="0" Text="Location:" FontSize="9" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                    <TextBlock Grid.Column="1" Text="{Binding SelectedHistoryItem.Location}" FontSize="9" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                  </Grid>
                  <Grid ColumnDefinitions="60,*" ColumnSpacing="6">
                    <TextBlock Grid.Column="0" Text="User:" FontSize="9" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                    <TextBlock Grid.Column="1" Text="{Binding SelectedHistoryItem.User}" FontSize="9" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                  </Grid>
                  <Grid ColumnDefinitions="60,*" ColumnSpacing="6">
                    <TextBlock Grid.Column="0" Text="Date:" FontSize="9" FontWeight="Medium" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                    <TextBlock Grid.Column="1" Text="{Binding SelectedHistoryItem.TransactionTime, StringFormat='{}{0:MM/dd/yyyy HH:mm}'}" FontSize="9" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                  </Grid>
                </StackPanel>

                <!-- No selection message -->
                <TextBlock Text="Select an item to view details" FontSize="9" FontStyle="Italic" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" HorizontalAlignment="Center" IsVisible="{Binding SelectedHistoryItem, Converter={x:Static ObjectConverters.IsNull}}" />
              </StackPanel>
            </Border>

            <!-- Quick Actions for Selected Item -->
            <Border Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}" BorderThickness="1" CornerRadius="4" Padding="8" IsEnabled="{Binding SelectedHistoryItem, Converter={x:Static ObjectConverters.IsNotNull}}">
              <StackPanel Spacing="6">
                <!-- Header -->
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="4">
                  <materialIcons:MaterialIcon Grid.Column="0" Kind="FlashOutline" Width="12" Height="12" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" />
                  <TextBlock Grid.Column="1" Text="Quick Actions" FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                </Grid>

                <!-- Action Buttons -->
                <StackPanel Spacing="4">
                  <Button Classes="action-button secondary" Height="28" Command="{Binding UndoRemovalCommand}" IsEnabled="{Binding CanUndo}" ToolTip.Tip="Undo this removal">
                    <StackPanel Orientation="Horizontal" Spacing="4" HorizontalAlignment="Center" VerticalAlignment="Center">
                      <materialIcons:MaterialIcon Kind="Undo" Width="12" Height="12" />
                      <TextBlock Text="Undo Removal" FontSize="9" />
                    </StackPanel>
                  </Button>

                  <Button Classes="action-button secondary" Height="28" ToolTip.Tip="View detailed information">
                    <StackPanel Orientation="Horizontal" Spacing="4" HorizontalAlignment="Center" VerticalAlignment="Center">
                      <materialIcons:MaterialIcon Kind="Eye" Width="12" Height="12" />
                      <TextBlock Text="View Details" FontSize="9" />
                    </StackPanel>
                  </Button>

                  <Button Classes="action-button secondary" Height="28" ToolTip.Tip="Export selected item">
                    <StackPanel Orientation="Horizontal" Spacing="4" HorizontalAlignment="Center" VerticalAlignment="Center">
                      <materialIcons:MaterialIcon Kind="Export" Width="12" Height="12" />
                      <TextBlock Text="Export" FontSize="9" />
                    </StackPanel>
                  </Button>
                </StackPanel>
              </StackPanel>
            </Border>

            <!-- Summary Statistics -->
            <Border Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderBrush}" BorderThickness="1" CornerRadius="4" Padding="8">
              <StackPanel Spacing="6">
                <!-- Header -->
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="4">
                  <materialIcons:MaterialIcon Grid.Column="0" Kind="ChartLine" Width="12" Height="12" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" VerticalAlignment="Center" />
                  <TextBlock Grid.Column="1" Text="Summary" FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                </Grid>

                <!-- Statistics -->
                <StackPanel Spacing="3">
                  <Grid ColumnDefinitions="*,Auto" ColumnSpacing="6">
                    <TextBlock Grid.Column="0" Text="Total Records:" FontSize="9" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                    <TextBlock Grid.Column="1" Text="{Binding RemovalHistoryGrid.Count}" FontSize="9" FontWeight="Bold" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" />
                  </Grid>
                  <Grid ColumnDefinitions="*,Auto" ColumnSpacing="6">
                    <TextBlock Grid.Column="0" Text="Total Quantity:" FontSize="9" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                    <TextBlock Grid.Column="1" Text="0" FontSize="9" FontWeight="Bold" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" />
                  </Grid>
                  <Grid ColumnDefinitions="*,Auto" ColumnSpacing="6">
                    <TextBlock Grid.Column="0" Text="Unique Parts:" FontSize="9" Foreground="{DynamicResource MTM_Shared_Logic.HeadingText}" />
                    <TextBlock Grid.Column="1" Text="0" FontSize="9" FontWeight="Bold" Foreground="{DynamicResource MTM_Shared_Logic.InteractiveText}" />
                  </Grid>
                </StackPanel>
              </StackPanel>
            </Border>

          </StackPanel>
        </controls:CollapsiblePanel>

      </Grid>
    </Border>

    <!-- Action Buttons Panel -->
    <Border Grid.Row="1" Background="{DynamicResource MTM_Shared_Logic.PanelBackgroundBrush}" BorderBrush="{DynamicResource MTM_Shared_Logic.BorderAccentBrush}" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,0,8">
      <Grid ColumnDefinitions="*,Auto">
        <!-- Left side buttons -->
        <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left" Spacing="4">
          <Button Classes="action-button primary" Width="60" Height="24" Command="{Binding SearchCommand}" ToolTip.Tip="Search removal history">
            <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="Magnify" Width="10" Height="10" />
              <TextBlock Text="Search" FontSize="9" />
            </StackPanel>
          </Button>
          <Button Classes="action-button secondary" Width="60" Height="24" Command="{Binding UndoRemovalCommand}" IsEnabled="{Binding CanUndo}" ToolTip.Tip="Undo selected removal">
            <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="Undo" Width="10" Height="10" />
              <TextBlock Text="Undo" FontSize="9" />
            </StackPanel>
          </Button>
          <Button Classes="action-button danger" Width="60" Height="24" Command="{Binding RemoveSelectedCommand}" ToolTip.Tip="Remove selected items">
            <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="Delete" Width="10" Height="10" />
              <TextBlock Text="Delete" FontSize="9" />
            </StackPanel>
          </Button>
          <Button Classes="action-button secondary" Width="60" Height="24" Command="{Binding ClearCommand}" ToolTip.Tip="Reset filters">
            <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="Refresh" Width="10" Height="10" />
              <TextBlock Text="Reset" FontSize="9" />
            </StackPanel>
          </Button>
          <Button Classes="action-button secondary" Width="60" Height="24" Command="{Binding PrintRemovalSummaryCommand}" ToolTip.Tip="Print removal summary">
            <StackPanel Orientation="Horizontal" Spacing="3" HorizontalAlignment="Center" VerticalAlignment="Center">
              <materialIcons:MaterialIcon Kind="Printer" Width="10" Height="10" />
              <TextBlock Text="Print" FontSize="9" />
            </StackPanel>
          </Button>
        </StackPanel>

        <!-- Right side button -->
        <Button Grid.Column="1" Classes="action-button secondary" Width="100" Height="24" Command="{Binding BackToNormalCommand}" ToolTip.Tip="Return to normal inventory view">
          <StackPanel Orientation="Horizontal" Spacing="4" HorizontalAlignment="Center" VerticalAlignment="Center">
            <materialIcons:MaterialIcon Kind="ArrowLeft" Width="10" Height="10" />
            <TextBlock Text="Back to Normal" FontSize="9" />
          </StackPanel>
        </Button>
      </Grid>
    </Border>

    </Grid>
</UserControl>
