# Copilot Continuation Prompt - Desktop-Focused MTM Custom Controls

> **Generated by MTM Audit System** - Version 1.0  
> **Target Branch**: copilot/fix-c2391caf-647c-4808-89e5-a392eba5e854  
> **Feature**: Desktop-Focused MTM Custom Controls Discovery and Implementation Roadmap  
> **Gap Report Date**: September 18, 2025

## Context Summary

You are continuing implementation of the Desktop-Focused MTM Custom Controls Discovery and Implementation Roadmap. The discovery and planning phase is **100% complete** with comprehensive documentation, but the implementation is **0% complete** - providing a perfect clean slate for Phase 1 implementation.

**Current Implementation Status**:

- ‚úÖ **Complete**: Discovery documentation with 40+ view analysis and 10+ custom control specifications
- ‚úÖ **Complete**: 24-week implementation roadmap with desktop-specific optimization focus
- ‚úÖ **Complete**: MTM architectural pattern documentation for all custom controls
- ‚ùå **Missing**: All Phase 1 custom control implementations (4 controls)
- ‚ùå **Missing**: Control directory structure and organization

**Previous Work Foundation**:

- Existing custom controls (`CustomDataGrid`, `CollapsiblePanel`, `SessionHistoryPanel`) demonstrate proper MTM patterns
- Complete theme system integration with `DynamicResource` bindings for `MTM_Shared_Logic.*`
- Established service layer with dependency injection patterns
- MVVM Community Toolkit patterns used throughout application

## üéØ Immediate Focus Areas (Critical Priority)

### **1. ManufacturingFormField Control (Priority #1) - 2-3 hours**

**Blocking Issue**: Core manufacturing data entry control missing - prevents high-speed desktop workflows

**Requirements**:

- **Desktop Keyboard-First**: Tab navigation, Enter-to-advance, Escape-to-cancel
- **Windows Integration**: Right-click context menu, clipboard paste with format detection
- **Manufacturing Intelligence**: Part ID validation, operation context (90-120), location awareness
- **Accessibility**: DPI scaling, screen reader support, high contrast themes
- **Performance**: 60+ WPM data entry optimization with sub-100ms validation

**Code Pattern Requirements**:

```csharp
// AXAML Structure Required
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="MTM_WIP_Application_Avalonia.Controls.ManufacturingFormField.ManufacturingFormField">
  
  <Border Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
          BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}" 
          BorderThickness="1" CornerRadius="4" Padding="8">
    
    <Grid x:Name="MainContainer" RowDefinitions="Auto,*,Auto" ColumnDefinitions="Auto,*,Auto">
      <!-- Label, Input Field, Validation sections -->
    </Grid>
  </Border>
</UserControl>

// Code-behind Pattern Required
[ObservableObject]
public partial class ManufacturingFormField : UserControl
{
    [ObservableProperty]
    private string fieldLabel = string.Empty;
    
    [ObservableProperty]
    private string fieldValue = string.Empty;
    
    [ObservableProperty]
    private ManufacturingFieldType fieldType = ManufacturingFieldType.Text;
    
    [ObservableProperty]
    private bool isRequired;
    
    // Constructor with proper null checking
    public ManufacturingFormField()
    {
        InitializeComponent();
        InitializeKeyboardShortcuts();
        InitializeClipboardIntegration();
    }
}
```

### **2. MTMTabViewContainer Control (Priority #2) - 1-2 hours**

**Blocking Issue**: No standardized container for manufacturing tab views - prevents consistent layouts

**Requirements**:

- **Layout Standardization**: Implement InventoryTabView pattern: `RowDefinitions="*,Auto"`
- **Multi-Monitor Support**: Proper window state management and DPI awareness
- **Keyboard Navigation**: Alt+number shortcuts for tab switching
- **Theme Integration**: Full `MTM_Shared_Logic.*` theme resource support

### **3. Control Directory Structure (Priority #3) - 30 minutes**

**Blocking Issue**: No organized structure for new custom controls

**Required Directories**:

```
Controls/
‚îú‚îÄ‚îÄ ManufacturingFormField/
‚îÇ   ‚îú‚îÄ‚îÄ ManufacturingFormField.axaml
‚îÇ   ‚îî‚îÄ‚îÄ ManufacturingFormField.axaml.cs
‚îú‚îÄ‚îÄ MTMTabViewContainer/
‚îÇ   ‚îú‚îÄ‚îÄ MTMTabViewContainer.axaml
‚îÇ   ‚îî‚îÄ‚îÄ MTMTabViewContainer.axaml.cs
‚îú‚îÄ‚îÄ DesktopActionButtonPanel/
‚îÇ   ‚îú‚îÄ‚îÄ DesktopActionButtonPanel.axaml
‚îÇ   ‚îî‚îÄ‚îÄ DesktopActionButtonPanel.axaml.cs
‚îî‚îÄ‚îÄ KeyboardOptimizedAutoComplete/
    ‚îú‚îÄ‚îÄ KeyboardOptimizedAutoComplete.axaml
    ‚îî‚îÄ‚îÄ KeyboardOptimizedAutoComplete.axaml.cs
```

## üèóÔ∏è MTM Architecture Requirements (MUST FOLLOW)

### **MVVM Community Toolkit Patterns (MANDATORY)**

```csharp
// ‚úÖ CORRECT: Use these patterns exclusively
[ObservableObject]
public partial class CustomControlViewModel : BaseViewModel
{
    [ObservableProperty]
    private string propertyName = string.Empty;

    [RelayCommand]
    private async Task ExecuteActionAsync()
    {
        try
        {
            // Implementation
        }
        catch (Exception ex)
        {
            await Services.ErrorHandling.HandleErrorAsync(ex, "Context");
        }
    }
}

// ‚ùå WRONG: Never use ReactiveUI patterns
// ReactiveObject, ReactiveCommand, RaiseAndSetIfChanged - DO NOT USE
```

### **Avalonia AXAML Syntax (CRITICAL)**

```xml
<!-- ‚úÖ CORRECT: Required Avalonia patterns -->
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  
  <Grid x:Name="MainContainer" RowDefinitions="*,Auto">
    <!-- Use x:Name, not Name -->
    <!-- Use RowDefinitions attribute form -->
  </Grid>
</UserControl>

<!-- ‚ùå WRONG: These will cause AVLN2000 compilation errors -->
<!-- <Grid Name="MainContainer"> - Use x:Name -->
<!-- xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" - Wrong namespace -->
```

### **Theme System Integration (MANDATORY)**

```xml
<!-- ‚úÖ CORRECT: Use DynamicResource for all theme elements -->
<Border Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
        BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}">

<Button Background="{DynamicResource MTM_Shared_Logic.PrimaryBrush}"
        Foreground="{DynamicResource MTM_Shared_Logic.OnPrimaryBrush}">

<!-- ‚ùå WRONG: Hard-coded colors break theme system -->
<!-- Background="#0078D4" - Use DynamicResource instead -->
```

### **Service Integration Patterns (REQUIRED)**

```csharp
// ‚úÖ CORRECT: Dependency injection with proper validation
public CustomControlViewModel(
    ILogger<CustomControlViewModel> logger,
    IConfigurationService configurationService)
    : base(logger)
{
    ArgumentNullException.ThrowIfNull(logger);
    ArgumentNullException.ThrowIfNull(configurationService);
    
    _configurationService = configurationService;
}

// ServiceCollectionExtensions registration
services.TryAddTransient<CustomControlViewModel>();
```

## üîÑ Current Implementation Status

### **Phase 1 Desktop Foundation Controls (0% Complete)**

1. **ManufacturingFormField**: 0% - Not started
   - Missing: AXAML file with desktop keyboard optimization
   - Missing: Code-behind with MVVM Community Toolkit patterns
   - Missing: Windows clipboard integration
   - Missing: Manufacturing intelligence validation

2. **MTMTabViewContainer**: 0% - Not started  
   - Missing: Standardized tab container layout
   - Missing: Multi-monitor support implementation
   - Missing: Keyboard navigation shortcuts

3. **DesktopActionButtonPanel**: 0% - Not started
   - Missing: Keyboard shortcut button panel
   - Missing: Accessibility and mnemonic support
   - Missing: Context menu integration

4. **KeyboardOptimizedAutoComplete**: 0% - Not started
   - Missing: High-speed auto-complete control
   - Missing: Arrow key navigation implementation
   - Missing: Manufacturing data source integration

### **Service Integration (0% Complete)**

- Missing: Custom control ViewModel registrations in ServiceCollectionExtensions
- Missing: Error handling integration via Services.ErrorHandling
- Missing: Theme service integration if needed

## üìã Implementation Priority Order

### **Phase 1: Core Structure (Session 1)**

1. **Create Control Directory Structure** (30 minutes)
   - Create all 4 control directories
   - Set up AXAML/code-behind file templates

2. **Implement ManufacturingFormField** (2-3 hours)
   - Priority #1 control with highest manufacturing impact
   - Desktop keyboard optimization focus
   - Windows clipboard and accessibility integration

3. **Implement MTMTabViewContainer** (1-2 hours)
   - Foundation layout pattern for all manufacturing views
   - Multi-monitor and theme integration

### **Phase 2: Action Controls (Session 2)**

1. **Implement DesktopActionButtonPanel** (2 hours)
   - Keyboard shortcuts and accessibility
   - Professional desktop button layouts

2. **Implement KeyboardOptimizedAutoComplete** (2-3 hours)
   - High-performance manufacturing data entry
   - Arrow key navigation and filtering

### **Phase 3: Integration (Session 3)**

1. **Service Integration** (1-2 hours)
   - Extend ServiceCollectionExtensions
   - Add proper dependency injection patterns

2. **Testing and Validation** (1 hour)
   - Validate MTM pattern compliance
   - Test theme integration across all controls

## üö® Critical Compliance Checks

### **Before Writing Any Code**

- [ ] Verify Avalonia namespace: `xmlns="https://github.com/avaloniaui"`
- [ ] Use `x:Name` not `Name` on Grid definitions
- [ ] Implement `RowDefinitions="*,Auto"` pattern where applicable
- [ ] Plan DynamicResource bindings for theme integration

### **MVVM Community Toolkit Compliance**

- [ ] Use `[ObservableObject]` for all ViewModels
- [ ] Use `[ObservableProperty]` for all bindable properties  
- [ ] Use `[RelayCommand]` for all command implementations
- [ ] Inherit from BaseViewModel where applicable
- [ ] NO ReactiveUI patterns anywhere

### **Service Integration Compliance**

- [ ] Constructor dependency injection with ArgumentNullException.ThrowIfNull
- [ ] TryAdd* methods in ServiceCollectionExtensions
- [ ] Services.ErrorHandling.HandleErrorAsync() for error handling
- [ ] Proper async/await patterns throughout

### **Desktop Manufacturing Optimization**

- [ ] Keyboard-first design with Tab navigation
- [ ] Right-click context menu support where appropriate
- [ ] Windows clipboard integration for data operations
- [ ] DPI scaling support for manufacturing monitors
- [ ] Screen reader and accessibility compliance

## üí° Code Examples for Current Context

### **ManufacturingFormField Implementation Starter**

```xml
<!-- ManufacturingFormField.axaml -->
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="MTM_WIP_Application_Avalonia.Controls.ManufacturingFormField.ManufacturingFormField"
             x:Name="FormFieldControl">

  <Border Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}"
          BorderBrush="{DynamicResource MTM_Shared_Logic.BorderLightBrush}" 
          BorderThickness="1" CornerRadius="4" Padding="12">
    
    <Grid x:Name="MainContainer" RowDefinitions="Auto,*,Auto" ColumnDefinitions="*,Auto">
      
      <!-- Label Section -->
      <TextBlock Grid.Row="0" Grid.Column="0"
                 Text="{Binding FieldLabel, RelativeSource={RelativeSource AncestorType=UserControl}}"
                 Foreground="{DynamicResource MTM_Shared_Logic.OnSurfaceBrush}"
                 FontWeight="Medium" Margin="0,0,0,4" />
      
      <!-- Input Section with Context Menu -->
      <TextBox Grid.Row="1" Grid.Column="0"
               Text="{Binding FieldValue, RelativeSource={RelativeSource AncestorType=UserControl}}"
               Background="{DynamicResource MTM_Shared_Logic.SurfaceBrush}"
               BorderBrush="{DynamicResource MTM_Shared_Logic.OutlineBrush}"
               KeyDown="OnFieldKeyDown"
               GotFocus="OnFieldGotFocus">
        
        <!-- Context Menu for Desktop Integration -->
        <TextBox.ContextMenu>
          <ContextMenu>
            <MenuItem Header="Cut" Command="{Binding CutCommand}" />
            <MenuItem Header="Copy" Command="{Binding CopyCommand}" />
            <MenuItem Header="Paste" Command="{Binding PasteCommand}" />
            <Separator />
            <MenuItem Header="Clear" Command="{Binding ClearCommand}" />
            <MenuItem Header="Validate" Command="{Binding ValidateCommand}" />
          </ContextMenu>
        </TextBox.ContextMenu>
      </TextBox>
      
      <!-- Validation Icon -->
      <Border Grid.Row="1" Grid.Column="1" Width="24" Height="24" Margin="8,0,0,0"
              Background="{DynamicResource MTM_Shared_Logic.SuccessBrush}"
              CornerRadius="12" IsVisible="{Binding IsValid}">
        <TextBlock Text="‚úì" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center" />
      </Border>
      
      <!-- Validation Message -->
      <TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                 Text="{Binding ValidationMessage}"
                 Foreground="{DynamicResource MTM_Shared_Logic.ErrorBrush}"
                 FontSize="12" Margin="0,4,0,0"
                 IsVisible="{Binding HasValidationError}" />
    </Grid>
  </Border>
</UserControl>
```

### **Code-Behind Pattern with MVVM Community Toolkit**

```csharp
// ManufacturingFormField.axaml.cs
using Avalonia.Controls;
using Avalonia.Input;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;

namespace MTM_WIP_Application_Avalonia.Controls.ManufacturingFormField;

[ObservableObject]
public partial class ManufacturingFormField : UserControl
{
    [ObservableProperty]
    private string fieldLabel = string.Empty;
    
    [ObservableProperty]
    private string fieldValue = string.Empty;
    
    [ObservableProperty]
    private ManufacturingFieldType fieldType = ManufacturingFieldType.Text;
    
    [ObservableProperty]
    private bool isRequired;
    
    [ObservableProperty]
    private bool isValid = true;
    
    [ObservableProperty]
    private string validationMessage = string.Empty;
    
    [ObservableProperty]
    private bool hasValidationError;

    public ManufacturingFormField()
    {
        InitializeComponent();
        DataContext = this;
        InitializeKeyboardShortcuts();
        InitializeClipboardIntegration();
    }

    [RelayCommand]
    private async Task CutAsync()
    {
        var textBox = this.FindControl<TextBox>("InputTextBox");
        if (textBox != null)
        {
            await TextCopyPaste.CutAsync(textBox);
        }
    }

    [RelayCommand] 
    private async Task CopyAsync()
    {
        var textBox = this.FindControl<TextBox>("InputTextBox");
        if (textBox != null)
        {
            await TextCopyPaste.CopyAsync(textBox);
        }
    }

    [RelayCommand]
    private async Task PasteAsync()
    {
        try
        {
            var textBox = this.FindControl<TextBox>("InputTextBox");
            if (textBox != null)
            {
                await TextCopyPaste.PasteAsync(textBox);
                await ValidateFieldAsync();
            }
        }
        catch (Exception ex)
        {
            await Services.ErrorHandling.HandleErrorAsync(ex, "Clipboard paste operation failed");
        }
    }

    [RelayCommand]
    private void Clear()
    {
        FieldValue = string.Empty;
        IsValid = true;
        HasValidationError = false;
        ValidationMessage = string.Empty;
    }

    [RelayCommand]
    private async Task ValidateAsync()
    {
        await ValidateFieldAsync();
    }

    private void OnFieldKeyDown(object? sender, KeyEventArgs e)
    {
        switch (e.Key)
        {
            case Key.Enter:
                // Move to next field or trigger save
                MoveFocusToNext();
                break;
            case Key.Escape:
                // Cancel/clear current input
                Clear();
                break;
            case Key.F2:
                // Trigger validation
                _ = Task.Run(ValidateAsync);
                break;
        }
    }

    private async Task ValidateFieldAsync()
    {
        try
        {
            // Manufacturing-specific validation logic
            switch (FieldType)
            {
                case ManufacturingFieldType.PartId:
                    await ValidatePartIdAsync();
                    break;
                case ManufacturingFieldType.Operation:
                    await ValidateOperationAsync();
                    break;
                case ManufacturingFieldType.Location:
                    await ValidateLocationAsync();
                    break;
                case ManufacturingFieldType.Quantity:
                    await ValidateQuantityAsync();
                    break;
            }
        }
        catch (Exception ex)
        {
            await Services.ErrorHandling.HandleErrorAsync(ex, $"Validation failed for {FieldType}");
            IsValid = false;
            HasValidationError = true;
            ValidationMessage = "Validation error occurred";
        }
    }
}

public enum ManufacturingFieldType
{
    Text,
    PartId,
    Operation,
    Location,
    Quantity,
    Date
}
```

## üîç Testing & Validation Checklist

### **Compilation Checks**

- [ ] All AXAML files compile without AVLN2000 errors
- [ ] No WPF namespace references in Avalonia files
- [ ] All x:Name attributes used correctly (not Name)
- [ ] DynamicResource bindings resolve correctly

### **MTM Pattern Validation**

- [ ] MVVM Community Toolkit patterns used exclusively
- [ ] No ReactiveUI patterns present anywhere
- [ ] BaseViewModel inheritance where applicable
- [ ] Proper dependency injection with ArgumentNullException.ThrowIfNull

### **Functionality Testing**

- [ ] Keyboard navigation works (Tab, Enter, Escape)
- [ ] Context menus appear on right-click
- [ ] Theme switching works across all controls
- [ ] DPI scaling renders correctly on high-DPI displays

### **Manufacturing Integration**

- [ ] Part ID validation connects to master data
- [ ] Operation sequence logic (90‚Üí100‚Üí110‚Üí120) works
- [ ] Location awareness functions properly
- [ ] Error handling integrates with Services.ErrorHandling

## üöÄ Execution Instruction

**Phase 1 Implementation Focus**: Create the 4 critical desktop foundation controls following the exact MTM patterns specified above. Prioritize ManufacturingFormField as the highest-impact control, then MTMTabViewContainer for layout standardization.

**Critical Success Factors**:

1. Follow Avalonia AXAML syntax precisely to avoid compilation errors
2. Use MVVM Community Toolkit patterns exclusively  
3. Integrate with existing MTM theme system via DynamicResource bindings
4. Implement desktop-specific optimizations (keyboard shortcuts, context menus, clipboard)
5. Add proper manufacturing intelligence and validation

**Quality Gates**: Each control must compile, follow MTM patterns, integrate with themes, and provide desktop-optimized manufacturing workflows before proceeding to the next control.

# github-pull-request_copilot-coding-agent

---

@copilot Implement Phase 1 Desktop Foundation Controls for the MTM Custom Controls system. Start with creating the directory structure for all 4 controls, then implement ManufacturingFormField as the highest priority control with desktop keyboard optimization, Windows clipboard integration, and manufacturing intelligence validation. Follow the exact MTM patterns specified above including MVVM Community Toolkit usage, Avalonia AXAML syntax with x:Name attributes, DynamicResource theme bindings, and proper service integration. Focus on desktop manufacturing workstation efficiency with keyboard-first design, context menus, and 60+ WPM data entry optimization. Ensure full compliance with established MTM architectural patterns and theme system integration.
