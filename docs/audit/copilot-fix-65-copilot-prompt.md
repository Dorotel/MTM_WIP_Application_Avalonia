@copilot Implement the critical UI improvements for AdvancedInventoryView: remove the right panel entirely (Grid.Column="2"), implement vertical text alignment for the left panel header with proper centering, and center the collapse/expand button text both vertically and horizontally in CollapsiblePanel. Focus on the three critical priority items identified in the gap analysis while ensuring perfect compliance with established MTM architectural patterns. The feature supports only Multiple Times and Multiple Locations modes - no Excel Import functionality needed, remove it.

# Copilot Continuation Prompt - Advanced Inventory View

> **Generated by MTM Audit System** - Version 1.0  
> **Target Branch**: copilot/fix-65  
> **Feature**: Advanced Inventory View - Enhanced Multi-Mode Inventory Operations  
> **Gap Report Date**: September 9, 2025

## Context Summary

You are continuing work on the Advanced Inventory View implementation for the MTM WIP Application (Avalonia .NET 8). The feature provides two specialized inventory operation modes: Multiple Times and Multiple Locations. The implementation follows MTM architectural patterns with MVVM Community Toolkit, stored procedures only, and comprehensive CollapsiblePanel integration.

**Current Implementation Status**: 85% complete with core functionality working but critical UI improvements needed.

**Previous Work Completed**:
- ‚úÖ AdvancedInventoryViewModel with MVVM Community Toolkit patterns
- ‚úÖ Multiple Times and Multiple Locations modes fully functional  
- ‚úÖ CollapsiblePanel control with header positioning support
- ‚úÖ Database integration using stored procedures exclusively
- ‚úÖ MTM theme integration with DynamicResource bindings
- ‚úÖ Master data loading with proper error handling

## üéØ Immediate Focus Areas (Critical Priority)

### 1. Remove Right Panel (30 minutes) - BLOCKING
**Current Issue**: Right panel (Analytics) still present in AXAML, requested to be removed
**Location**: `Views/MainForm/Panels/AdvancedInventoryView.axaml` line ~155-195
**Required Action**: 
- Remove entire `Grid.Column="2"` CollapsiblePanel section
- Change grid from `ColumnDefinitions="Auto,*,Auto"` to `ColumnDefinitions="Auto,*"`
- Remove all Analytics panel related properties from ViewModel

### 2. Left Panel Vertical Text Alignment (2 hours) - CRITICAL
**Current Issue**: "Mode & Entry" header text is horizontal, needs to be vertical and centered
**Location**: `Views/MainForm/Panels/AdvancedInventoryView.axaml` line ~75
**Required Action**: Implement vertical text with LayoutTransform rotation and proper centering

### 3. Collapse/Expand Button Text Centering (1 hour) - CRITICAL  
**Current Issue**: Toggle button text not perfectly centered vertically and horizontally
**Location**: `Controls/CollapsiblePanel.axaml.cs` UpdateButtonPositioning method
**Required Action**: Enhance button alignment properties for perfect centering

## üèóÔ∏è MTM Architecture Requirements (MUST FOLLOW)

### MVVM Community Toolkit Patterns (EXCLUSIVE)
```csharp
// ‚úÖ CORRECT: Continue using these patterns exclusively
[ObservableObject]
public partial class AdvancedInventoryViewModel : BaseViewModel
{
    [ObservableProperty]
    private string _statusMessage = "Ready";
    
    [ObservableProperty] 
    private ObservableCollection<string> _selectedLocations = new();
    
    [RelayCommand]
    private async Task AddMultipleTimesAsync() { /* implementation */ }
}
```

### Database Access (STORED PROCEDURES ONLY)
```csharp
// ‚úÖ CORRECT: Continue using Helper_Database_StoredProcedure exclusively
var result = await Helper_Database_StoredProcedure.ExecuteDataTableWithStatus(
    connectionString,
    "inv_inventory_Add_Item",
    parameters
);
```

### Avalonia AXAML Syntax Rules (CRITICAL)
```xml
<!-- ‚úÖ CORRECT: Use x:Name (not Name) and proper namespace -->
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="MTM_WIP_Application_Avalonia.Views.AdvancedInventoryView">
  
<Grid x:Name="MainContainer" RowDefinitions="*,Auto">
  <!-- Use DynamicResource for ALL theme colors -->
  <Border Background="{DynamicResource MTM_Shared_Logic.CardBackgroundBrush}">
```

### Error Handling Pattern (MANDATORY)
```csharp
// ‚úÖ CORRECT: Use centralized error handling
catch (Exception ex)
{
    await Services.ErrorHandling.HandleErrorAsync(ex, "Multiple Times Operation");
}
```

## üîÑ Current Implementation Status

### AdvancedInventoryView.axaml (85% complete)
**Completed Features**:
- Three-column layout with CollapsiblePanel integration (needs to be two-column)
- Multiple Times mode with complete form controls
- Multiple Locations mode with location selection
- Material Icons integration and comprehensive styling
- DynamicResource theme bindings throughout

**Missing Critical Elements**:
```xml
<!-- REQUIRED: Left Panel Vertical Text -->
<controls:CollapsiblePanel.Header>
  <TextBlock Text="Mode &amp; Entry">
    <TextBlock.LayoutTransform>
      <RotateTransform Angle="-90"/>
    </TextBlock.LayoutTransform>
  </TextBlock>
</controls:CollapsiblePanel.Header>

<!-- REQUIRED: Remove Right Panel Entirely -->
<!-- Delete Grid.Column="2" section completely -->
```

### AdvancedInventoryViewModel.cs (90% complete)
**Completed Features**:
- All MVVM Community Toolkit patterns
- Multiple Times and Multiple Locations full functionality
- Database integration with stored procedures
- Master data loading and error handling

**No Missing Properties**: All required functionality implemented

### CollapsiblePanel Control (95% complete)
**Working Features**:
- Header positioning (Left, Right, Top, Bottom)
- Expand/collapse functionality
- MTM theme integration
- Dynamic layout updates

**Required Enhancement**:
```csharp
// ENHANCE: Button centering in UpdateButtonPositioning()
_toggleButton.HorizontalAlignment = HorizontalAlignment.Center;
_toggleButton.VerticalAlignment = VerticalAlignment.Center;
_toggleButton.HorizontalContentAlignment = HorizontalAlignment.Center;
_toggleButton.VerticalContentAlignment = VerticalAlignment.Center;
```

## üìã Implementation Priority Order

### Phase 1: Critical UI Fixes (3 hours)
1. **Remove Right Panel**: Delete Grid.Column="2" CollapsiblePanel section
2. **Left Panel Vertical Text**: Add LayoutTransform with RotateTransform
3. **Center Toggle Button**: Enhance CollapsiblePanel button positioning
4. **Grid Layout**: Adjust to two-column layout (Auto,*)

### Phase 2: Enhanced Features (3 hours) 
1. **Transaction Preview Enhancement**: Improve DataGrid display
2. **Progress Indicators**: Visual feedback for bulk operations  
3. **Advanced DataGrid Features**: Sorting, filtering capabilities
4. **Performance Optimization**: Smooth UI interactions

### Phase 3: Integration & Testing (2 hours)
1. **Mode Switching**: Seamless transitions between modes
2. **Error Handling**: Comprehensive error scenarios  
3. **Final Testing**: All modes working seamlessly
4. **Documentation**: Update implementation status

## üö® Critical Compliance Checks

### AXAML Syntax Validation
- [ ] `x:Name` used instead of `Name` on all Grid elements
- [ ] `xmlns="https://github.com/avaloniaui"` namespace correct
- [ ] `RowDefinitions="*,Auto"` pattern maintained
- [ ] DynamicResource bindings for ALL theme colors
- [ ] ScrollViewer as root element for overflow handling

### MVVM Community Toolkit Validation  
- [ ] `[ObservableObject]` on ViewModel class
- [ ] `[ObservableProperty]` for all bindable properties
- [ ] `[RelayCommand]` for all command implementations
- [ ] NO ReactiveUI patterns anywhere
- [ ] BaseViewModel inheritance maintained

### Database Pattern Validation
- [ ] `Helper_Database_StoredProcedure.ExecuteDataTableWithStatus()` exclusively
- [ ] NO direct SQL queries anywhere
- [ ] Empty collections on database failure (no fallback data)
- [ ] Proper stored procedure parameter passing

### Error Handling Validation
- [ ] `await Services.ErrorHandling.HandleErrorAsync(ex, context)` for all exceptions
- [ ] Microsoft.Extensions.Logging usage throughout
- [ ] Proper try-catch blocks around all async operations

## üí° Code Examples for Current Context

### Left Panel Vertical Text Implementation
```xml
<!-- REPLACE in AdvancedInventoryView.axaml -->
<controls:CollapsiblePanel Grid.Column="0" 
                         IsExpanded="{Binding IsModeSelectionExpanded}"
                         HeaderPosition="Left"
                         MinWidth="200">
  <controls:CollapsiblePanel.Header>
    <TextBlock Text="Mode &amp; Entry" 
               VerticalAlignment="Center" 
               HorizontalAlignment="Center"
               FontSize="10" 
               FontWeight="SemiBold"
               Foreground="{DynamicResource MTM_Shared_Logic.OverlayTextBrush}">
      <TextBlock.LayoutTransform>
        <RotateTransform Angle="-90"/>
      </TextBlock.LayoutTransform>
    </TextBlock>
  </controls:CollapsiblePanel.Header>
  <!-- Existing content unchanged -->
</controls:CollapsiblePanel>
```

### Grid Layout Change (Remove Right Panel)
```xml
<!-- CHANGE FROM: -->
<Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">

<!-- CHANGE TO: -->
<Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">

<!-- REMOVE ENTIRE SECTION: Grid.Column="2" CollapsiblePanel -->
<!-- Delete all Analytics panel content -->
```

## üîç Testing & Validation Checklist

### Critical UI Validation
- [ ] Right panel completely removed from UI
- [ ] Left panel displays vertical text correctly centered  
- [ ] Toggle button text perfectly centered both ways
- [ ] Multiple Times mode shows all required controls
- [ ] Two-column layout displays properly

### Multiple Mode Functionality
- [ ] Multiple Times mode processes transactions correctly
- [ ] Multiple Locations mode adds to all selected locations
- [ ] Preview grid shows transaction data correctly
- [ ] Database records created successfully
- [ ] Progress updates work during bulk operations

### MTM Pattern Compliance
- [ ] All DynamicResource theme bindings functional
- [ ] MVVM Community Toolkit patterns maintained
- [ ] Stored procedure database access exclusive
- [ ] Centralized error handling working
- [ ] No ReactiveUI patterns present

## üöÄ Execution Instruction

Focus on implementing the critical UI improvements: remove right panel, vertical left text, and button centering. The implementation must follow established patterns from the existing codebase while delivering the specific enhancements requested for the two-mode inventory system (Multiple Times and Multiple Locations only).




#github-pull-request_copilot-coding-agent

