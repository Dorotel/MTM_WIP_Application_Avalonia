<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickButtonsViewModel - Technical Documentation</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-brand">üîß MTM Technical Docs</div>
        <div class="nav-links">
            <a href="../../index.html">üè† Home</a>
            <a href="../../PlainEnglish/index.html">üìñ Plain English</a>
            <a href="../index.html">üîß Technical</a>
            <a href="#" onclick="switchToPlainEnglish()" title="Switch to Plain English View (Alt+P)">üìñ Plain English</a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <!-- Header Section -->
        <header class="header-section">
            <div class="header-content">
                <div class="icon-container">
                    <span class="file-icon">‚ö°</span>
                </div>
                <div class="header-text">
                    <h1>QuickButtonsViewModel.cs</h1>
                    <p class="subtitle">Complex Quick Action Management System</p>
                </div>
            </div>
            <div class="file-info">
                <span class="file-path">üìÅ ViewModels/QuickButtonsViewModel.cs</span>
                <span class="file-type">üîß ReactiveUI ViewModel</span>
            </div>
        </header>

        <!-- Technical Overview -->
        <section class="content-section">
            <h2>üîç Technical Overview</h2>
            <div class="info-box info-primary">
                <p><strong>QuickButtonsViewModel</strong> is a sophisticated ReactiveUI ViewModel that manages a collection of 10 quick action buttons for rapid inventory operations. It features complex event-driven communication, automatic data management, and comprehensive button manipulation capabilities.</p>
            </div>

            <div class="code-block">
                <h3>üìã Class Definition</h3>
                <pre><code>public class QuickButtonsViewModel : ReactiveObject
{
    // Observable collection for 10 button slots
    public ObservableCollection&lt;QuickButtonItemViewModel&gt; QuickButtons { get; } = new();
    
    // Event for inter-component communication
    public event EventHandler&lt;QuickActionExecutedEventArgs&gt;? QuickActionExecuted;
    
    // Comprehensive command set for button management
    public ReactiveCommand&lt;Unit, Unit&gt; RefreshButtonsCommand { get; }
    public ReactiveCommand&lt;QuickButtonItemViewModel, Unit&gt; ExecuteQuickActionCommand { get; }
    public ReactiveCommand&lt;QuickButtonItemViewModel, Unit&gt; EditButtonCommand { get; }
    public ReactiveCommand&lt;QuickButtonItemViewModel, Unit&gt; RemoveButtonCommand { get; }
}</code></pre>
            </div>
        </section>

        <!-- Architecture Analysis -->
        <section class="content-section">
            <h2>üèóÔ∏è Architecture & Design Patterns</h2>
            <div class="architecture-grid">
                <div class="pattern-card">
                    <h3>üîÑ Command Pattern Implementation</h3>
                    <div class="code-block">
                        <pre><code>// Parameterized commands for button-specific operations
ExecuteQuickActionCommand = ReactiveCommand.CreateFromTask&lt;QuickButtonItemViewModel&gt;(async (button) =&gt;
{
    await ExecuteQuickActionAsync(button);
});

EditButtonCommand = ReactiveCommand.Create&lt;QuickButtonItemViewModel&gt;((button) =&gt;
{
    // TODO: Open edit dialog for button
});

RemoveButtonCommand = ReactiveCommand.CreateFromTask&lt;QuickButtonItemViewModel&gt;(async (button) =&gt;
{
    await RemoveButtonAsync(button);
});</code></pre>
                    </div>
                </div>
                <div class="pattern-card">
                    <h3>üì° Event-Driven Communication</h3>
                    <div class="code-block">
                        <pre><code>// Event definition for external communication
public event EventHandler&lt;QuickActionExecutedEventArgs&gt;? QuickActionExecuted;

// Event firing with structured data
private async Task ExecuteQuickActionAsync(QuickButtonItemViewModel button)
{
    QuickActionExecuted?.Invoke(this, new QuickActionExecutedEventArgs
    {
        PartId = button.PartId,
        Operation = button.Operation,  // Workflow step number
        Quantity = button.Quantity
    });
    
    await Task.CompletedTask;
}</code></pre>
                    </div>
                </div>
                <div class="pattern-card">
                    <h3>üîß Centralized Error Handling</h3>
                    <div class="code-block">
                        <pre><code>// Subscribe all commands to centralized error handling
RefreshButtonsCommand.ThrownExceptions.Subscribe(HandleException);
ExecuteQuickActionCommand.ThrownExceptions.Subscribe(HandleException);
EditButtonCommand.ThrownExceptions.Subscribe(HandleException);
RemoveButtonCommand.ThrownExceptions.Subscribe(HandleException);
ClearAllButtonsCommand.ThrownExceptions.Subscribe(HandleException);
ResetOrderCommand.ThrownExceptions.Subscribe(HandleException);

private void HandleException(Exception ex)
{
    // TODO: Log and present user-friendly error
}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Button Management System -->
        <section class="content-section">
            <h2>üéõÔ∏è Button Management Implementation</h2>
            <div class="management-details">
                <h3>üîÑ Dynamic Button Updates</h3>
                <div class="code-block">
                    <pre><code>/// &lt;summary&gt;
/// Adds a new quick button based on a successful operation
/// This is called when an inventory operation is completed to update the quick buttons
/// &lt;/summary&gt;
public void AddQuickButtonFromOperation(string partId, string operation, int quantity)
{
    // Check for existing button with same part and operation
    var existingButton = QuickButtons.FirstOrDefault(b =&gt; b.PartId == partId && b.Operation == operation);
    if (existingButton != null)
    {
        // Update existing button with new quantity
        existingButton.Quantity = quantity;
        existingButton.DisplayText = $"{partId}";
        existingButton.SubText = $"{quantity} parts.";
        existingButton.ToolTipText = $"Position {existingButton.Position}: Click to populate Part ID: {partId}, Operation: {operation}, Quantity: {quantity} in the active tab. Right-click for options.";
    }
    else
    {
        // Find first empty slot or shift existing buttons
        var emptySlot = QuickButtons.FirstOrDefault(b =&gt; b.IsEmpty);
        if (emptySlot != null)
        {
            // Fill empty slot
            PopulateButton(emptySlot, partId, operation, quantity);
        }
        else
        {
            // Shift all buttons down and add new one at position 1
            ShiftButtonsAndAddNew(partId, operation, quantity);
        }
    }
}</code></pre>
                </div>

                <h3>üîÑ Button Shifting Algorithm</h3>
                <div class="code-block">
                    <pre><code>// Shift all buttons and add new one at position 1
for (int i = QuickButtons.Count - 1; i &gt; 0; i--)
{
    var current = QuickButtons[i];
    var previous = QuickButtons[i - 1];
    
    // Copy data from previous button to current position
    current.PartId = previous.PartId;
    current.Operation = previous.Operation;
    current.Quantity = previous.Quantity;
    current.DisplayText = previous.DisplayText;
    current.SubText = previous.SubText;
    current.ToolTipText = previous.ToolTipText?.Replace($"Position {previous.Position}", $"Position {current.Position}");
}

// Update first button with new data
var firstButton = QuickButtons[0];
PopulateButton(firstButton, partId, operation, quantity);</code></pre>
                </div>

                <h3>üóëÔ∏è Button Removal with Position Updates</h3>
                <div class="code-block">
                    <pre><code>private async Task RemoveButtonAsync(QuickButtonItemViewModel button)
{
    // TODO: Implement Dao_QuickButtons.RemoveQuickButtonAndShiftAsync()
    QuickButtons.Remove(button);
    
    // Reorder remaining buttons to maintain sequential positions
    UpdateButtonPositions();
    await Task.CompletedTask;
}

private void UpdateButtonPositions()
{
    for (int i = 0; i &lt; QuickButtons.Count; i++)
    {
        QuickButtons[i].Position = i + 1;
    }
}</code></pre>
                </div>
            </div>
        </section>

        <!-- Data Loading Patterns -->
        <section class="content-section">
            <h2>üìä Data Loading & Management</h2>
            <div class="data-patterns">
                <h3>üóÑÔ∏è Database Integration Pattern</h3>
                <div class="code-block">
                    <pre><code>private async Task LoadLast10TransactionsAsync()
{
    // TODO: Implement database loading with stored procedures
    // var dataResult = await Helper_Database_StoredProcedure.ExecuteDataTableWithStatus(
    //     Model_AppVariables.ConnectionString,
    //     "sys_last_10_transactions_Get_ByUser",
    //     new Dictionary&lt;string, object&gt; { ["User"] = currentUser }
    // );
    //
    // Process dataResult.DataTable to populate QuickButtons collection
    // Each row becomes a QuickButtonItemViewModel with:
    // - PartId from database
    // - Operation from database (workflow step number)
    // - Quantity from last transaction
    // - Position based on transaction timestamp order
    
    await Task.CompletedTask;
    LoadSampleData(); // Temporary implementation
}</code></pre>
                </div>

                <h3>üìã Sample Data Structure</h3>
                <div class="code-block">
                    <pre><code>private void LoadSampleData()
{
    QuickButtons.Clear();
    
    // Always maintain exactly 10 slots
    var sampleOperations = new[] { "90", "100", "110", "120", "130" };
    var sampleParts = new[] { "PART001", "PART002", "PART003", "PART004", "PART005", "PART006", "PART007", "PART008", "PART009", "PART010" };
    
    for (int i = 1; i &lt;= 10; i++)
    {
        if (i &lt;= 7) // Show 7 sample buttons, leave 3 empty slots
        {
            var operation = sampleOperations[(i - 1) % sampleOperations.Length];
            var partId = sampleParts[i - 1];
            var quantity = i * 5;
            
            QuickButtons.Add(new QuickButtonItemViewModel
            {
                Position = i,
                PartId = partId,
                Operation = operation,
                Quantity = quantity,
                DisplayText = $"{partId}",
                SubText = $"{quantity} parts.",
                ToolTipText = $"Position {i}: Click to populate Part ID: {partId}, Operation: {operation}, Quantity: {quantity} in the active tab. Right-click for options."
            });
        }
        else
        {
            // Empty slot
            QuickButtons.Add(new QuickButtonItemViewModel
            {
                Position = i,
                PartId = string.Empty,
                Operation = "EMPTY",
                Quantity = 0,
                DisplayText = "Empty Slot",
                SubText = "Click to assign",
                ToolTipText = $"Empty slot {i} - Click to assign a quick action. Right-click for options."
            });
        }
    }
}</code></pre>
                </div>
            </div>
        </section>

        <!-- Supporting Classes -->
        <section class="content-section">
            <h2>üß© Supporting Classes</h2>
            <div class="classes-details">
                <h3>üìù QuickButtonItemViewModel</h3>
                <div class="code-block">
                    <pre><code>public class QuickButtonItemViewModel : ReactiveObject
{
    // Core button properties with reactive notifications
    private int _position;
    public int Position
    {
        get =&gt; _position;
        set =&gt; this.RaiseAndSetIfChanged(ref _position, value);
    }

    private string _partId = string.Empty;
    public string PartId
    {
        get =&gt; _partId;
        set =&gt; this.RaiseAndSetIfChanged(ref _partId, value);
    }

    private string _operation = string.Empty;
    public string Operation
    {
        get =&gt; _operation;
        set =&gt; this.RaiseAndSetIfChanged(ref _operation, value);
    }

    private int _quantity;
    public int Quantity
    {
        get =&gt; _quantity;
        set =&gt; this.RaiseAndSetIfChanged(ref _quantity, value);
    }

    // UI display properties
    private string _displayText = string.Empty;
    public string DisplayText
    {
        get =&gt; _displayText;
        set =&gt; this.RaiseAndSetIfChanged(ref _displayText, value);
    }

    private string _subText = string.Empty;
    public string SubText
    {
        get =&gt; _subText;
        set =&gt; this.RaiseAndSetIfChanged(ref _subText, value);
    }

    private string _toolTipText = string.Empty;
    public string ToolTipText
    {
        get =&gt; _toolTipText;
        set =&gt; this.RaiseAndSetIfChanged(ref _toolTipText, value);
    }

    // Computed property for empty state detection
    public bool IsEmpty =&gt; string.IsNullOrEmpty(PartId) || Operation == "EMPTY";
}</code></pre>
                </div>

                <h3>üì° QuickActionExecutedEventArgs</h3>
                <div class="code-block">
                    <pre><code>public class QuickActionExecutedEventArgs : EventArgs
{
    public string PartId { get; set; } = string.Empty;
    public string Operation { get; set; } = string.Empty;  // Workflow step number
    public int Quantity { get; set; }
}

// Usage example in parent component:
QuickButtonsViewModel.QuickActionExecuted += (sender, e) =&gt;
{
    // Populate inventory form with button data
    InventoryTabViewModel.SelectedPart = e.PartId;
    InventoryTabViewModel.SelectedOperation = e.Operation;
    InventoryTabViewModel.Quantity = e.Quantity.ToString();
    
    // Switch to inventory tab
    SelectedTabIndex = 0;
};</code></pre>
                </div>
            </div>
        </section>

        <!-- Future Implementation -->
        <section class="content-section">
            <h2>üöß Implementation Completion Requirements</h2>
            <div class="requirements-grid">
                <div class="requirement-card">
                    <h3>üíâ Service Injection</h3>
                    <ul>
                        <li>Inject <code>IQuickButtonsService</code> for database operations</li>
                        <li>Inject <code>IProgressService</code> for operation feedback</li>
                        <li>Add constructor with proper dependency injection</li>
                        <li>Replace TODO comments with actual service calls</li>
                    </ul>
                </div>
                <div class="requirement-card">
                    <h3>üóÑÔ∏è Database Integration</h3>
                    <ul>
                        <li>Replace sample data with stored procedure calls</li>
                        <li>Implement <code>sys_last_10_transactions_Get_ByUser</code> procedure</li>
                        <li>Add <code>Dao_QuickButtons</code> class for button persistence</li>
                        <li>Support user-specific button configurations</li>
                    </ul>
                </div>
                <div class="requirement-card">
                    <h3>üé® UI Features</h3>
                    <ul>
                        <li>Implement Edit Button dialog functionality</li>
                        <li>Add drag-and-drop reordering support</li>
                        <li>Enhanced visual feedback for button states</li>
                        <li>Context menu implementation with all management options</li>
                    </ul>
                </div>
                <div class="requirement-card">
                    <h3>üîß Advanced Features</h3>
                    <ul>
                        <li>Button persistence across application sessions</li>
                        <li>Import/export button configurations</li>
                        <li>Keyboard shortcuts for button execution (1-9, 0)</li>
                        <li>Integration with transaction history for automatic updates</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- MTM Business Rules -->
        <section class="content-section">
            <h2>üìã MTM Business Rules Implementation</h2>
            <div class="rules-container">
                <div class="rule-box rule-critical">
                    <h3>üö® Critical Implementation Rules</h3>
                    <ul>
                        <li><strong>Form Population Only:</strong> Buttons populate forms but don't execute transactions</li>
                        <li><strong>Operation Numbers:</strong> Treat operations as workflow steps, not transaction types</li>
                        <li><strong>10 Slot Limit:</strong> Always maintain exactly 10 button positions</li>
                        <li><strong>User-Specific Data:</strong> Load only current user's transaction history</li>
                    </ul>
                </div>
                <div class="rule-box rule-warning">
                    <h3>‚ö†Ô∏è Data Management Rules</h3>
                    <ul>
                        <li><strong>Automatic Shifting:</strong> When adding new buttons, shift older ones down</li>
                        <li><strong>Empty Slot Handling:</strong> Clearly indicate and handle empty button slots</li>
                        <li><strong>Position Integrity:</strong> Always maintain sequential position numbering (1-10)</li>
                        <li><strong>Event Communication:</strong> Use events for all inter-component communication</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Related Files -->
        <section class="content-section">
            <h2>üîó Related Files & Dependencies</h2>
            <div class="nav-grid">
                <a href="InventoryTabViewModel.html" class="nav-card">
                    <div class="nav-icon">üìä</div>
                    <div class="nav-content">
                        <h3>InventoryTabViewModel.cs</h3>
                        <p>Target component that receives quick button data</p>
                    </div>
                </a>
                <a href="MainViewViewModel.html" class="nav-card">
                    <div class="nav-icon">üèóÔ∏è</div>
                    <div class="nav-content">
                        <h3>MainViewViewModel.cs</h3>
                        <p>Parent coordinator that manages event communication</p>
                    </div>
                </a>
                <a href="UserAndTransactionServices.html" class="nav-card">
                    <div class="nav-icon">üë§</div>
                    <div class="nav-content">
                        <h3>UserAndTransactionServices.cs</h3>
                        <p>Source of transaction history data for button population</p>
                    </div>
                </a>
                <a href="../../../Views/QuickButtonsView.axaml" class="nav-card">
                    <div class="nav-icon">üé®</div>
                    <div class="nav-content">
                        <h3>QuickButtonsView.axaml</h3>
                        <p>UI view with 10-button layout and context menus</p>
                    </div>
                </a>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>üìö Documentation</h3>
                    <ul>
                        <li><a href="../../PlainEnglish/index.html">Plain English Docs</a></li>
                        <li><a href="../index.html">Technical Docs</a></li>
                        <li><a href="../../index.html">Documentation Home</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>üîß Development</h3>
                    <ul>
                        <li><a href="#" onclick="switchToPlainEnglish()">Plain English View</a></li>
                        <li><a href="../../../README.md">Project README</a></li>
                        <li><a href="../../../Development/">Development Docs</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 MTM WIP Application - Technical Documentation</p>
            </div>
        </footer>
    </main>

    <script>
        function switchToPlainEnglish() {
            window.location.href = '../../PlainEnglish/QuickButtonsViewModel.html';
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.altKey && e.key === 'p') {
                e.preventDefault();
                switchToPlainEnglish();
            }
        });
    </script>
</body>
</html>