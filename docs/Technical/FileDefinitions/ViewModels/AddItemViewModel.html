<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AddItemViewModel - Technical Documentation</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-brand">üîß MTM Technical Docs</div>
        <div class="nav-links">
            <a href="../../index.html">üè† Home</a>
            <a href="../../PlainEnglish/index.html">üìñ Plain English</a>
            <a href="../index.html">üîß Technical</a>
            <a href="#" onclick="switchToPlainEnglish()" title="Switch to Plain English View (Alt+P)">üìñ Plain English</a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <!-- Header Section -->
        <header class="header-section">
            <div class="header-content">
                <div class="icon-container">
                    <span class="file-icon">üìù</span>
                </div>
                <div class="header-text">
                    <h1>AddItemViewModel.cs</h1>
                    <p class="subtitle">Inventory Addition ViewModel Implementation</p>
                </div>
            </div>
            <div class="file-info">
                <span class="file-path">üìÅ ViewModels/AddItemViewModel.cs</span>
                <span class="file-type">üîß ViewModel Class</span>
            </div>
        </header>

        <!-- Technical Overview -->
        <section class="content-section">
            <h2>üîç Technical Overview</h2>
            <div class="info-box info-primary">
                <p><strong>AddItemViewModel</strong> is a ReactiveUI-based ViewModel that inherits from <code>BaseViewModel</code> and manages the UI logic for adding inventory items to the MTM WIP system. It uses dependency injection for service management and follows the MVVM pattern for clean separation of concerns.</p>
            </div>

            <div class="code-block">
                <h3>üìã Class Definition</h3>
                <pre><code>public class AddItemViewModel : BaseViewModel
{
    private readonly MTM.Services.IInventoryService _inventoryService;
    private readonly IApplicationStateService _applicationState;
    
    public AddItemViewModel(
        MTM.Services.IInventoryService inventoryService,
        IApplicationStateService applicationState,
        ILogger&lt;AddItemViewModel&gt; logger) : base(logger)
}</code></pre>
            </div>
        </section>

        <!-- Constructor Analysis -->
        <section class="content-section">
            <h2>üèóÔ∏è Constructor & Dependency Injection</h2>
            <div class="implementation-details">
                <h3>üì• Injected Dependencies</h3>
                <div class="dependency-grid">
                    <div class="dependency-card">
                        <h4>MTM.Services.IInventoryService</h4>
                        <p><strong>Purpose:</strong> Core inventory management operations</p>
                        <p><strong>Usage:</strong> Adding items, validation, database operations</p>
                        <p><strong>Type:</strong> Business Logic Service</p>
                    </div>
                    <div class="dependency-card">
                        <h4>IApplicationStateService</h4>
                        <p><strong>Purpose:</strong> Global application state management</p>
                        <p><strong>Usage:</strong> Real-time updates, state synchronization</p>
                        <p><strong>Type:</strong> Infrastructure Service</p>
                    </div>
                    <div class="dependency-card">
                        <h4>ILogger&lt;AddItemViewModel&gt;</h4>
                        <p><strong>Purpose:</strong> Logging and diagnostics</p>
                        <p><strong>Usage:</strong> Error logging, operation tracking</p>
                        <p><strong>Type:</strong> Infrastructure Service (via BaseViewModel)</p>
                    </div>
                </div>

                <div class="code-block">
                    <h3>üîß Constructor Implementation</h3>
                    <pre><code>public AddItemViewModel(
    MTM.Services.IInventoryService inventoryService,
    IApplicationStateService applicationState,
    ILogger&lt;AddItemViewModel&gt; logger) : base(logger)
{
    // Null guard validation
    _inventoryService = inventoryService ?? throw new ArgumentNullException(nameof(inventoryService));
    _applicationState = applicationState ?? throw new ArgumentNullException(nameof(applicationState));

    // Initialization logging
    Logger.LogInformation("AddItemViewModel initialized with dependency injection");

    // Command and property setup
    InitializeCommands();
}</code></pre>
                </div>
            </div>
        </section>

        <!-- Implementation Patterns -->
        <section class="content-section">
            <h2>‚öôÔ∏è Implementation Patterns</h2>
            <div class="pattern-grid">
                <div class="pattern-card">
                    <h3>üèóÔ∏è MVVM Architecture</h3>
                    <ul>
                        <li>Inherits from <code>BaseViewModel</code></li>
                        <li>Uses ReactiveUI for property change notifications</li>
                        <li>Implements command pattern for user interactions</li>
                        <li>Clean separation between UI and business logic</li>
                    </ul>
                </div>
                <div class="pattern-card">
                    <h3>üíâ Dependency Injection</h3>
                    <ul>
                        <li>Constructor-based injection</li>
                        <li>Null guard validation for all dependencies</li>
                        <li>Service lifetime managed by DI container</li>
                        <li>Follows MTM service registration patterns</li>
                    </ul>
                </div>
                <div class="pattern-card">
                    <h3>üìù Logging Integration</h3>
                    <ul>
                        <li>Structured logging through ILogger</li>
                        <li>Initialization tracking</li>
                        <li>Error logging and diagnostics</li>
                        <li>Audit trail for inventory operations</li>
                    </ul>
                </div>
                <div class="pattern-card">
                    <h3>üîß Command Initialization</h3>
                    <ul>
                        <li>Deferred command setup via <code>InitializeCommands()</code></li>
                        <li>ReactiveCommand implementation</li>
                        <li>Async operation support</li>
                        <li>Error handling and validation</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Service Integration -->
        <section class="content-section">
            <h2>üîó Service Integration</h2>
            <div class="integration-details">
                <h3>üìä InventoryService Integration</h3>
                <div class="code-block">
                    <pre><code>// Typical inventory addition pattern
private async Task AddInventoryItemAsync()
{
    try
    {
        var result = await _inventoryService.AddItemAsync(new AddItemRequest
        {
            PartId = SelectedPartId,
            Operation = SelectedOperation, // Workflow step number
            Quantity = EnteredQuantity,
            Location = SelectedLocation,
            TransactionType = TransactionType.IN, // Always IN for additions
            UserId = _applicationState.CurrentUser.Id,
            Notes = ItemNotes
        });

        if (result.IsSuccess)
        {
            Logger.LogInformation($"Successfully added {EnteredQuantity} of {SelectedPartId}");
            await RefreshData();
        }
        else
        {
            Logger.LogWarning($"Failed to add inventory item: {result.ErrorMessage}");
            // Handle error display
        }
    }
    catch (Exception ex)
    {
        Logger.LogError(ex, "Error adding inventory item");
        // Handle exception
    }
}</code></pre>
                </div>

                <h3>üåê ApplicationStateService Integration</h3>
                <div class="code-block">
                    <pre><code>// State management integration
private void UpdateApplicationState()
{
    _applicationState.UpdateLastInventoryAction(new InventoryAction
    {
        ActionType = "ADD",
        PartId = SelectedPartId,
        Quantity = EnteredQuantity,
        Timestamp = DateTime.UtcNow,
        UserId = _applicationState.CurrentUser.Id
    });

    // Trigger real-time updates across the application
    _applicationState.NotifyInventoryChanged();
}</code></pre>
                </div>
            </div>
        </section>

        <!-- Future Implementation -->
        <section class="content-section">
            <h2>üöß Future Implementation Requirements</h2>
            <div class="requirements-grid">
                <div class="requirement-card">
                    <h3>üìã Form Properties</h3>
                    <ul>
                        <li><code>SelectedPartId</code> - Part selection with validation</li>
                        <li><code>SelectedOperation</code> - Operation number selection</li>
                        <li><code>SelectedLocation</code> - Location selection</li>
                        <li><code>EnteredQuantity</code> - Quantity with numeric validation</li>
                        <li><code>ItemNotes</code> - Optional notes field</li>
                    </ul>
                </div>
                <div class="requirement-card">
                    <h3>‚ö° Command Properties</h3>
                    <ul>
                        <li><code>AddItemCommand</code> - Main addition command</li>
                        <li><code>ResetFormCommand</code> - Form reset functionality</li>
                        <li><code>LoadDataCommand</code> - Load dropdown data</li>
                        <li><code>ValidateCommand</code> - Form validation</li>
                    </ul>
                </div>
                <div class="requirement-card">
                    <h3>üîç Validation Logic</h3>
                    <ul>
                        <li>Part ID existence validation</li>
                        <li>Operation number format validation</li>
                        <li>Quantity positive integer validation</li>
                        <li>Location availability validation</li>
                        <li>User authorization validation</li>
                    </ul>
                </div>
                <div class="requirement-card">
                    <h3>üîÑ Reactive Patterns</h3>
                    <ul>
                        <li><code>WhenAnyValue</code> for form validation</li>
                        <li><code>ObservableAsPropertyHelper</code> for computed properties</li>
                        <li>Exception handling subscriptions</li>
                        <li>Property change notifications</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- MTM Business Rules -->
        <section class="content-section">
            <h2>üìã MTM Business Rules Implementation</h2>
            <div class="rules-container">
                <div class="rule-box rule-critical">
                    <h3>üö® Critical Implementation Rules</h3>
                    <ul>
                        <li><strong>TransactionType.IN:</strong> Always use IN for inventory additions</li>
                        <li><strong>Stored Procedures:</strong> All database operations via stored procedures only</li>
                        <li><strong>Operation Numbers:</strong> Treat as workflow step identifiers, not transaction types</li>
                        <li><strong>User Context:</strong> Always include current user in operations</li>
                    </ul>
                </div>
                <div class="rule-box rule-warning">
                    <h3>‚ö†Ô∏è Validation Requirements</h3>
                    <ul>
                        <li><strong>Required Fields:</strong> PartId, Operation, Location, Quantity</li>
                        <li><strong>Quantity Validation:</strong> Must be positive integer</li>
                        <li><strong>Authorization:</strong> User must have ADD_INVENTORY permission</li>
                        <li><strong>Data Integrity:</strong> Validate against existing parts and locations</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Related Files -->
        <section class="content-section">
            <h2>üîó Related Files & Dependencies</h2>
            <div class="nav-grid">
                <a href="BaseViewModel.html" class="nav-card">
                    <div class="nav-icon">üèóÔ∏è</div>
                    <div class="nav-content">
                        <h3>BaseViewModel.cs</h3>
                        <p>Base class providing common ViewModel functionality and logging</p>
                    </div>
                </a>
                <a href="InventoryService.html" class="nav-card">
                    <div class="nav-icon">üè™</div>
                    <div class="nav-content">
                        <h3>InventoryService.cs</h3>
                        <p>Business service for inventory management operations</p>
                    </div>
                </a>
                <a href="ApplicationStateService.html" class="nav-card">
                    <div class="nav-icon">üåê</div>
                    <div class="nav-content">
                        <h3>ApplicationStateService.cs</h3>
                        <p>Global application state management service</p>
                    </div>
                </a>
                <a href="../../../Views/AddItemView.axaml" class="nav-card">
                    <div class="nav-icon">üé®</div>
                    <div class="nav-content">
                        <h3>AddItemView.axaml</h3>
                        <p>Associated UI view for inventory addition interface</p>
                    </div>
                </a>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>üìö Documentation</h3>
                    <ul>
                        <li><a href="../../PlainEnglish/index.html">Plain English Docs</a></li>
                        <li><a href="../index.html">Technical Docs</a></li>
                        <li><a href="../../index.html">Documentation Home</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>üîß Development</h3>
                    <ul>
                        <li><a href="#" onclick="switchToPlainEnglish()">Plain English View</a></li>
                        <li><a href="../../../README.md">Project README</a></li>
                        <li><a href="../../../Development/">Development Docs</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 MTM WIP Application - Technical Documentation</p>
            </div>
        </footer>
    </main>

    <script>
        function switchToPlainEnglish() {
            window.location.href = '../../PlainEnglish/AddItemViewModel.html';
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.altKey && e.key === 'p') {
                e.preventDefault();
                switchToPlainEnglish();
            }
        });
    </script>
</body>
</html>