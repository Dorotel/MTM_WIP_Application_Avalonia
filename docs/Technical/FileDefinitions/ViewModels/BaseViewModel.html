<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BaseViewModel - Technical Documentation | MTM WIP Application</title>
    <link rel="stylesheet" href="../../../styles.css">
</head>
<body>
    <div class="container">
        <header>
            <nav class="breadcrumb">
                <a href="../../../index.html">üìö Documentation Hub</a>
                <span>‚Ä∫</span>
                <a href="../../index.html">üîß Technical</a>
                <span>‚Ä∫</span>
                <a href="../index.html">üìÑ File Definitions</a>
                <span>‚Ä∫</span>
                <a href="index.html">ViewModels</a>
                <span>‚Ä∫</span>
                <span>BaseViewModel</span>
            </nav>
            <div class="file-header">
                <h1>üîß BaseViewModel - Technical Documentation</h1>
                <div class="file-meta">
                    <span class="file-type">Abstract Base Class</span>
                    <span class="complexity">üü¢ Low Complexity</span>
                    <span class="maintainability">üü¢ High Maintainability</span>
                </div>
            </div>
        </header>

        <main>
            <!-- Class Overview -->
            <section class="hero-section">
                <div class="card">
                    <h2>üìã Class Overview</h2>
                    <div class="class-signature">
                        <pre><code>public abstract class BaseViewModel : ReactiveObject, IDisposable</code></pre>
                    </div>
                    <p>Abstract base class providing common functionality for all ViewModels in the MTM WIP Application. Implements the ReactiveUI pattern with proper resource disposal and logging infrastructure.</p>
                </div>
            </section>

            <!-- Architecture & Design -->
            <section>
                <h2>üèóÔ∏è Architecture & Design</h2>
                <div class="grid-2">
                    <div class="card">
                        <h3>üìê Design Patterns</h3>
                        <ul>
                            <li><strong>Template Method Pattern:</strong> Defines common structure for all ViewModels</li>
                            <li><strong>Dependency Injection:</strong> Constructor injection for ILogger</li>
                            <li><strong>Observer Pattern:</strong> Inherits from ReactiveObject for property notifications</li>
                            <li><strong>Disposable Pattern:</strong> Implements IDisposable for resource cleanup</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h3>üéØ MVVM Role</h3>
                        <ul>
                            <li><strong>Base ViewModel:</strong> Foundation for all screen controllers</li>
                            <li><strong>ReactiveUI Integration:</strong> Provides reactive property change notifications</li>
                            <li><strong>Logging Infrastructure:</strong> Standardized logging across all ViewModels</li>
                            <li><strong>Resource Management:</strong> Ensures proper cleanup and disposal</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Public API -->
            <section>
                <h2>üìö Public API</h2>
                
                <!-- Constructor -->
                <div class="card">
                    <h3>üèóÔ∏è Constructor</h3>
                    <div class="method-card">
                        <div class="method-signature">
                            <pre><code>protected BaseViewModel(ILogger logger)</code></pre>
                        </div>
                        <div class="method-details">
                            <h4>Parameters</h4>
                            <ul>
                                <li><code>logger</code> (ILogger): Logger instance for this ViewModel, injected via DI</li>
                            </ul>
                            <h4>Behavior</h4>
                            <ul>
                                <li>Validates logger parameter (throws ArgumentNullException if null)</li>
                                <li>Stores logger reference for use by derived classes</li>
                                <li>Initializes ReactiveObject base functionality</li>
                            </ul>
                            <h4>Usage Example</h4>
                            <pre><code>public class InventoryViewModel : BaseViewModel
{
    public InventoryViewModel(ILogger&lt;InventoryViewModel&gt; logger) : base(logger)
    {
        // ViewModel-specific initialization
    }
}</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Disposal Methods -->
                <div class="card">
                    <h3>üßπ Disposal Methods</h3>
                    
                    <div class="method-card">
                        <div class="method-signature">
                            <pre><code>protected virtual void Dispose(bool disposing)</code></pre>
                        </div>
                        <div class="method-details">
                            <h4>Parameters</h4>
                            <ul>
                                <li><code>disposing</code> (bool): True if disposing managed resources, false if called from finalizer</li>
                            </ul>
                            <h4>Behavior</h4>
                            <ul>
                                <li>Implements standard Disposable Pattern</li>
                                <li>Prevents multiple disposal with _isDisposed flag</li>
                                <li>Virtual method allows derived classes to override for custom cleanup</li>
                                <li>Currently no managed resources to dispose in base class</li>
                            </ul>
                            <h4>Override Example</h4>
                            <pre><code>protected override void Dispose(bool disposing)
{
    if (disposing)
    {
        // Dispose ViewModel-specific resources
        subscription?.Dispose();
        cancellationTokenSource?.Dispose();
    }
    base.Dispose(disposing);
}</code></pre>
                        </div>
                    </div>

                    <div class="method-card">
                        <div class="method-signature">
                            <pre><code>public void Dispose()</code></pre>
                        </div>
                        <div class="method-details">
                            <h4>Behavior</h4>
                            <ul>
                                <li>Public entry point for resource disposal</li>
                                <li>Calls Dispose(true) to dispose managed resources</li>
                                <li>Calls GC.SuppressFinalize(this) to prevent finalizer execution</li>
                                <li>Thread-safe disposal implementation</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Protected Members -->
            <section>
                <h2>üîí Protected Members</h2>
                <div class="card">
                    <h3>Available to Derived Classes</h3>
                    <div class="member-grid">
                        <div class="member-card">
                            <h4>üìù Logger Property</h4>
                            <pre><code>protected readonly ILogger Logger;</code></pre>
                            <p><strong>Purpose:</strong> Logging infrastructure for derived ViewModels</p>
                            <p><strong>Usage:</strong> <code>Logger.LogInformation("User action performed")</code></p>
                            <p><strong>Thread Safety:</strong> ILogger implementations are thread-safe</p>
                        </div>
                        <div class="member-card">
                            <h4>üè∑Ô∏è Disposal Flag</h4>
                            <pre><code>private bool _isDisposed = false;</code></pre>
                            <p><strong>Purpose:</strong> Prevents multiple disposal attempts</p>
                            <p><strong>Access:</strong> Private to base class, managed automatically</p>
                            <p><strong>Thread Safety:</strong> Protected by disposal pattern implementation</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ReactiveUI Integration -->
            <section>
                <h2>‚ö° ReactiveUI Integration</h2>
                <div class="card">
                    <h3>üîó Inherited Functionality</h3>
                    <p>By inheriting from ReactiveObject, BaseViewModel provides all derived ViewModels with:</p>
                    
                    <div class="grid-2">
                        <div class="feature-card">
                            <h4>üîî Property Change Notifications</h4>
                            <pre><code>// In derived ViewModel
private string _title;
public string Title
{
    get => _title;
    set => this.RaiseAndSetIfChanged(ref _title, value);
}</code></pre>
                            <p>Automatic UI updates when properties change</p>
                        </div>
                        
                        <div class="feature-card">
                            <h4>üéØ Reactive Commands</h4>
                            <pre><code>// In derived ViewModel
public ReactiveCommand&lt;Unit, Unit&gt; SaveCommand { get; }

// In constructor
SaveCommand = ReactiveCommand.CreateFromTask(async () => 
{
    Logger.LogInformation("Save command executed");
    await SaveDataAsync();
});</code></pre>
                            <p>Command pattern with async support and automatic UI binding</p>
                        </div>
                        
                        <div class="feature-card">
                            <h4>üåä Observable Streams</h4>
                            <pre><code>// In derived ViewModel
this.WhenAnyValue(vm => vm.SearchText)
    .Throttle(TimeSpan.FromMilliseconds(300))
    .DistinctUntilChanged()
    .Subscribe(text => 
    {
        Logger.LogDebug($"Search text changed: {text}");
        PerformSearch(text);
    });</code></pre>
                            <p>Reactive programming patterns for UI interactions</p>
                        </div>
                        
                        <div class="feature-card">
                            <h4>üîó Property Dependencies</h4>
                            <pre><code>// In derived ViewModel
private readonly ObservableAsPropertyHelper&lt;bool&gt; _canSave;
public bool CanSave => _canSave.Value;

// In constructor
_canSave = this.WhenAnyValue(
    vm => vm.Name,
    vm => vm.Location,
    (name, location) => !string.IsNullOrEmpty(name) && 
                       !string.IsNullOrEmpty(location))
    .ToProperty(this, vm => vm.CanSave);</code></pre>
                            <p>Derived properties that automatically update based on dependencies</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Usage Patterns -->
            <section>
                <h2>üéØ Usage Patterns</h2>
                <div class="card">
                    <h3>üìã Implementation Guidelines</h3>
                    
                    <div class="pattern-card">
                        <h4>‚úÖ Correct Usage Pattern</h4>
                        <pre><code>public class InventoryViewModel : BaseViewModel
{
    private readonly IInventoryService _inventoryService;
    private string _searchText = string.Empty;
    
    public InventoryViewModel(
        IInventoryService inventoryService,
        ILogger&lt;InventoryViewModel&gt; logger) : base(logger)
    {
        _inventoryService = inventoryService ?? 
            throw new ArgumentNullException(nameof(inventoryService));
        
        // Initialize commands and observables
        InitializeCommands();
        Logger.LogInformation("InventoryViewModel initialized");
    }
    
    public string SearchText
    {
        get => _searchText;
        set => this.RaiseAndSetIfChanged(ref _searchText, value);
    }
    
    protected override void Dispose(bool disposing)
    {
        if (disposing)
        {
            // Dispose ViewModel-specific resources
            Logger.LogInformation("InventoryViewModel disposing");
        }
        base.Dispose(disposing);
    }
}</code></pre>
                    </div>
                    
                    <div class="antipattern-card">
                        <h4>‚ùå Anti-Patterns to Avoid</h4>
                        <pre><code>// DON'T: Skip null validation
public BadViewModel(ILogger logger) : base(logger) { }

// DON'T: Ignore disposal in derived classes
protected override void Dispose(bool disposing)
{
    // Missing: base.Dispose(disposing);
}

// DON'T: Use blocking calls in commands without logging
SaveCommand = ReactiveCommand.Create(() => 
{
    SomeBlockingOperation(); // No logging, blocks UI
});</code></pre>
                    </div>
                </div>
            </section>

            <!-- Dependency Injection -->
            <section>
                <h2>üíâ Dependency Injection Integration</h2>
                <div class="card">
                    <h3>üîß Service Registration</h3>
                    <p>ViewModels are registered as Transient services in the DI container:</p>
                    <pre><code>// In Program.cs or ServiceCollectionExtensions
services.AddTransient&lt;InventoryViewModel&gt;();
services.AddTransient&lt;MainViewModel&gt;();
services.AddTransient&lt;UserManagementViewModel&gt;();

// Logger is automatically injected by DI container
// ILogger&lt;T&gt; is provided by logging infrastructure</code></pre>
                    
                    <h3>üéØ Lifetime Management</h3>
                    <ul>
                        <li><strong>Transient:</strong> New instance created each time requested</li>
                        <li><strong>Logger:</strong> Scoped per ViewModel type (ILogger&lt;ViewModelType&gt;)</li>
                        <li><strong>Disposal:</strong> ViewModels must be disposed when view is closed</li>
                        <li><strong>Memory:</strong> Proper disposal prevents memory leaks</li>
                    </ul>
                </div>
            </section>

            <!-- Performance Considerations -->
            <section>
                <h2>‚ö° Performance Considerations</h2>
                <div class="grid-2">
                    <div class="card">
                        <h3>üöÄ Optimizations</h3>
                        <ul>
                            <li><strong>Lightweight Base:</strong> Minimal overhead in base class</li>
                            <li><strong>Lazy Initialization:</strong> Properties initialized only when needed</li>
                            <li><strong>Efficient Disposal:</strong> Quick cleanup prevents resource leaks</li>
                            <li><strong>Logger Injection:</strong> Shared logger instances across ViewModels</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h3>‚ö†Ô∏è Potential Issues</h3>
                        <ul>
                            <li><strong>Memory Leaks:</strong> Forgetting to dispose ViewModels</li>
                            <li><strong>Subscription Leaks:</strong> Not disposing ReactiveUI subscriptions</li>
                            <li><strong>Heavy Operations:</strong> Blocking UI thread in constructors</li>
                            <li><strong>Circular References:</strong> ViewModels referencing each other</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Testing -->
            <section>
                <h2>üß™ Testing Considerations</h2>
                <div class="card">
                    <h3>üìã Unit Testing Guidelines</h3>
                    <pre><code>[Test]
public void Constructor_WithValidLogger_InitializesCorrectly()
{
    // Arrange
    var mockLogger = new Mock&lt;ILogger&lt;TestViewModel&gt;&gt;();
    
    // Act
    var viewModel = new TestViewModel(mockLogger.Object);
    
    // Assert
    Assert.NotNull(viewModel);
    // Verify logger was stored (access via protected member if needed)
}

[Test]
public void Dispose_Called_SetsIsDisposedFlag()
{
    // Arrange
    var mockLogger = new Mock&lt;ILogger&lt;TestViewModel&gt;&gt;();
    var viewModel = new TestViewModel(mockLogger.Object);
    
    // Act
    viewModel.Dispose();
    
    // Assert
    // Verify disposal behavior
    viewModel.Dispose(); // Should not throw on second call
}</code></pre>
                </div>
            </section>

            <!-- Navigation -->
            <section class="navigation-section">
                <h2>üß≠ Related Documentation</h2>
                <div class="nav-grid">
                    <a href="../../../PlainEnglish/FileDefinitions/ViewModels/BaseViewModel.html" class="nav-card plain-english">
                        <span class="nav-icon">üìñ</span>
                        <div class="nav-content">
                            <h3>Plain English Guide</h3>
                            <p>Business-friendly explanation</p>
                        </div>
                    </a>
                    <a href="../Services/InventoryService.html" class="nav-card">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <div class="nav-content">
                            <h3>InventoryService</h3>
                            <p>Service layer documentation</p>
                        </div>
                    </a>
                    <a href="../Extensions/ServiceCollectionExtensions.html" class="nav-card">
                        <span class="nav-icon">üîß</span>
                        <div class="nav-content">
                            <h3>DI Configuration</h3>
                            <p>Service registration patterns</p>
                        </div>
                    </a>
                </div>
            </section>
        </main>

        <footer>
            <div class="file-info">
                <div class="file-path">
                    <strong>File:</strong> <code>ViewModels/BaseViewModel.cs</code>
                </div>
                <div class="last-updated">
                    <strong>Namespace:</strong> <code>MTM_WIP_Application_Avalonia.ViewModels</code>
                </div>
            </div>
        </footer>
    </div>

    <!-- Copy to Clipboard -->
    <script>
        document.querySelectorAll('pre code').forEach(block => {
            block.addEventListener('click', () => {
                navigator.clipboard.writeText(block.textContent).then(() => {
                    // Show feedback
                    block.style.background = '#d4edda';
                    setTimeout(() => {
                        block.style.background = '';
                    }, 1000);
                });
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.altKey) {
                switch(event.key) {
                    case 'p':
                    case 'P':
                        event.preventDefault();
                        window.location.href = '../../../PlainEnglish/FileDefinitions/ViewModels/BaseViewModel.html';
                        break;
                    case 'h':
                    case 'H':
                        event.preventDefault();
                        window.location.href = '../../../index.html';
                        break;
                }
            }
        });
    </script>
</body>
</html>