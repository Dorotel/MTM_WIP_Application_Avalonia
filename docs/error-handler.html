<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Error Handling & Logging | Avalonia Project Help</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1><span class="icon">&#9888;</span>Error Handling & Logging</h1>
  </header>
  <nav class="topbar">
    <a href="index.html"><span class="icon">&#8962;</span>Home</a>
    <a href="coding-conventions.html"><span class="icon">&#128295;</span>Coding Conventions</a>
    <a href="ui-generation.html"><span class="icon">&#128187;</span>UI Generation</a>
    <a href="ui-mapping.html"><span class="icon">&#128247;</span>UI Mapping</a>
    <a href="error-handler.html" class="active"><span class="icon">&#9888;</span>Error Handling</a>
    <a href="github-workflow.html"><span class="icon">&#128736;</span>GitHub Workflow</a>
    <a href="naming-conventions.html"><span class="icon">&#128221;</span>Naming Conventions</a>
    <a href="custom-prompts.html"><span class="icon">&#128161;</span>Custom Prompts</a>
    <a href="personas.html"><span class="icon">&#128100;</span>Personas</a>
    <a href="custom-prompts-examples.html"><span class="icon">&#9998;</span>Prompt Examples</a>
    <a href="needs-repair.html"><span class="icon">&#128679;</span>Quality Assurance</a>
    <a href="missing-systems.html"><span class="icon">&#128295;</span>Missing Systems</a>
  </nav>
  <main>
    <h2><span class="icon">&#9888;</span>Error Handler Requirements and Instructions</h2>
    
    <blockquote class="tip">
      <span class="icon">&#128204;</span>
      <strong>Status:</strong> Error handling infrastructure is <span class="status-success">implemented</span>. Structured logging enhancement needed - see <a href="missing-systems.html#prompt-34">Prompt 34</a>.
    </blockquote>
    
    <blockquote>
      For prompt and persona standards related to error and logging, see <a href="custom-prompts.html">Custom Prompts</a> and <a href="personas.html">Personas</a>.
    </blockquote>
    
    <details open>
      <summary><span class="icon icon-chevron">&#9654;</span>Current Implementation Status</summary>
      <div class="metrics">
        <div class="metric-card success">
          <h4>Service_ErrorHandler</h4>
          <div class="metric-value">‚úÖ</div>
          <div class="metric-status">IMPLEMENTED</div>
        </div>
        <div class="metric-card success">
          <h4>LoggingUtility</h4>
          <div class="metric-value">‚úÖ</div>
          <div class="metric-status">IMPLEMENTED</div>
        </div>
        <div class="metric-card warning">
          <h4>Structured Logging</h4>
          <div class="metric-value">üî∂</div>
          <div class="metric-status">NEEDS ENHANCEMENT</div>
        </div>
        <div class="metric-card success">
          <h4>UI Error Controls</h4>
          <div class="metric-value">‚úÖ</div>
          <div class="metric-status">IMPLEMENTED</div>
        </div>
      </div>
    </details>
    
    <details open>
      <summary><span class="icon icon-chevron">&#9654;</span>Logging to File Server</summary>
      <ul>
        <li><strong>Each user</strong> gets their own subfolder in a central folder on the work file server.
          <ul>
            <li>The application creates the subfolder automatically if it doesn't exist.</li>
            <li>Subfolder naming is based on the user's identity (<code>userId</code> or equivalent).</li>
          </ul>
        </li>
        <li><strong>Log files</strong> are in CSV format, one file per error category (e.g., <code>ui_errors.csv</code>, <code>mysql_errors.csv</code>), per user.
          <ul>
            <li>Each error is logged as a new row.</li>
            <li>The file includes a header row.</li>
            <li>Do not log duplicate errors for the current session.</li>
          </ul>
        </li>
        <li><strong>Integration Status:</strong> <span class="status-success">LoggingUtility implemented</span> with CSV file logging support</li>
      </ul>
    </details>
    
    <details>
      <summary><span class="icon icon-chevron">&#9654;</span>Log Entry Details</summary>
      <ul>
        <li>Timestamp</li>
        <li>User ID</li>
        <li>Machine name (computer name)</li>
        <li>Error category</li>
        <li>Error message</li>
        <li>File name</li>
        <li>Method name</li>
        <li>Line number</li>
        <li>Stack trace</li>
      </ul>
      <p>
        Include extra information to help diagnose and fix the error if the log entry is pasted into a chat window (as long as it doesn't duplicate existing fields).
      </p>
    </details>
    
    <details>
      <summary><span class="icon icon-chevron">&#9654;</span>Error Categories</summary>
      <ul>
        <li><strong>UI</strong> - User interface errors and validation issues</li>
        <li><strong>Business Logic</strong> - Service layer and data processing errors</li>
        <li><strong>MySQL</strong> - Database connection and query errors</li>
        <li><strong>Network</strong> - Connection and communication errors</li>
        <li><strong>Other</strong> - Miscellaneous system errors</li>
      </ul>
      <p><strong>Implementation Status:</strong> <span class="status-success">ErrorCategory enum implemented</span> in Services/ErrorCategory.cs</p>
    </details>
    
    <details>
      <summary><span class="icon icon-chevron">&#9654;</span>MySQL Logging</summary>
      <ul>
        <li>Log errors to MySQL as well.</li>
        <li>Each category has a separate table, all tables use the same structure/columns as above.</li>
        <li><strong>Implementation Status:</strong> <span class="status-success">MySQL logging stubs implemented</span> - requires database connection setup</li>
        <li><strong>Dependency:</strong> Requires <a href="missing-systems.html#prompt-26">Database Service Layer</a> implementation</li>
      </ul>
    </details>
    
    <details>
      <summary><span class="icon icon-chevron">&#9654;</span>ReactiveUI Integration</summary>
      <h3>Command Error Handling Pattern</h3>
      <p>All ReactiveCommands should integrate with the error handling system:</p>
      <pre><code>public ReactiveCommand&lt;Unit, Unit&gt; SaveCommand { get; }

public InventoryViewModel()
{
    SaveCommand = ReactiveCommand.CreateFromTask(SaveAsync);
    
    // Centralized error handling
    SaveCommand.ThrownExceptions.Subscribe(ex =>
    {
        Service_ErrorHandler.HandleException(ex, ErrorSeverity.High,
            source: nameof(InventoryViewModel));
    });
}</code></pre>
      
      <h3>Result Pattern Integration</h3>
      <p>Service methods should return Result&lt;T&gt; for consistent error handling:</p>
      <pre><code>public async Task&lt;Result&lt;InventoryItem&gt;&gt; GetInventoryAsync(string partId)
{
    try
    {
        var item = await _repository.GetByIdAsync(partId);
        return Result&lt;InventoryItem&gt;.Success(item);
    }
    catch (Exception ex)
    {
        Service_ErrorHandler.HandleException(ex, ErrorSeverity.High,
            source: nameof(InventoryService));
        return Result&lt;InventoryItem&gt;.Failure("Failed to retrieve inventory item");
    }
}</code></pre>
    </details>
    
    <details>
      <summary><span class="icon icon-chevron">&#9654;</span>UI Error Display</summary>
      <h3>Available Error UI Components</h3>
      <ul>
        <li><strong>Control_ErrorMessage.axaml</strong> - Inline error display for non-blocking notifications</li>
        <li><strong>ErrorDialog_Enhanced.axaml</strong> - Modal dialog for critical errors requiring user attention</li>
      </ul>
      
      <h3>Usage Example</h3>
      <pre><code>// Inline error display
var errorMessage = this.FindControl&lt;UserControl&gt;("ErrorMessageControl");
if (errorMessage is Control_ErrorMessage errorControl)
{
    await errorControl.ShowErrorAsync("Error message", ErrorSeverity.High);
}

// Modal error dialog  
await ErrorDialog_Enhanced.ShowErrorAsync("Critical error", 
    "Detailed error description", ErrorSeverity.Critical);</code></pre>
    </details>
    
    <details>
      <summary><span class="icon icon-chevron">&#9654;</span>Missing Enhancements</summary>
      <p>The following enhancements are needed for complete error handling integration:</p>
      
      <div class="system-card warning">
        <h4>Structured Logging Enhancement</h4>
        <div class="system-status">üî∂ PARTIAL</div>
        <p>Enhance existing LoggingUtility with Microsoft.Extensions.Logging patterns, log levels, correlation IDs, and Serilog integration.</p>
        <p><strong>Custom Prompt:</strong> <a href="custom-prompts-examples.html#prompt-34">Implement Structured Logging</a></p>
      </div>
      
      <div class="system-card info">
        <h4>Configuration Service Integration</h4>
        <div class="system-status">‚ùå MISSING</div>
        <p>Error handling configuration (file paths, MySQL settings) currently uses hardcoded values. Needs configuration service integration.</p>
        <p><strong>Custom Prompt:</strong> <a href="custom-prompts-examples.html#prompt-28">Implement Configuration Service</a></p>
      </div>
    </details>
    
    <details>
      <summary><span class="icon icon-chevron">&#9654;</span>Duplicate Error Detection</summary>
      <ul>
        <li>For the current application session, do not log the same error more than once (per user, per category).</li>
        <li><strong>Implementation Status:</strong> <span class="status-success">Session duplicate detection implemented</span> in Service_ErrorHandler</li>
      </ul>
    </details>
    
    <details>
      <summary><span class="icon icon-chevron">&#9654;</span>Additional Info</summary>
      <ul>
        <li>The error handler should NOT capture process/thread details.</li>
        <li>Log files and database tables should focus on user, machine, and error details only.</li>
        <li><strong>Quality Assurance:</strong> Use <a href="needs-repair.html">compliance reports</a> to verify error handling implementation</li>
      </ul>
    </details>
  </main>
</body>
</html>