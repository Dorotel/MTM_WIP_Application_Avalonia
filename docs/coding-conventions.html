<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Coding Conventions | Avalonia Project Help</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1><span class="icon">&#128295;</span>Coding Conventions</h1>
  </header>
  <nav class="topbar">
    <a href="index.html"><span class="icon">&#8962;</span>Home</a>
    <a href="coding-conventions.html" class="active"><span class="icon">&#128295;</span>Coding Conventions</a>
    <a href="ui-generation.html"><span class="icon">&#128187;</span>UI Generation</a>
    <a href="ui-mapping.html"><span class="icon">&#128247;</span>UI Mapping</a>
    <a href="error-handler.html"><span class="icon">&#9888;</span>Error Handling</a>
    <a href="github-workflow.html"><span class="icon">&#128736;</span>GitHub Workflow</a>
    <a href="naming-conventions.html"><span class="icon">&#128221;</span>Naming Conventions</a>
    <a href="custom-prompts.html"><span class="icon">&#128161;</span>Custom Prompts</a>
    <a href="personas.html"><span class="icon">&#128100;</span>Personas</a>
    <a href="custom-prompts-examples.html"><span class="icon">&#9998;</span>Prompt Examples</a>
    <a href="needs-repair.html"><span class="icon">&#128679;</span>Quality Assurance</a>
    <a href="missing-systems.html"><span class="icon">&#128295;</span>Missing Systems</a>
  </nav>
  <main>
    <h2><span class="icon">&#128295;</span>Coding Conventions</h2>
    
    <blockquote class="info">
      <span class="icon">&#128161;</span>
      <strong>GitHub Instructions:</strong> Complete coding guidelines are available in <a href="../.github/codingconventions.instruction.md">GitHub Instructions - Coding Conventions</a>. This page provides quick reference for common patterns.
    </blockquote>
    
    <details open>
      <summary><span class="icon icon-chevron">&#9654;</span>Standard Rules</summary>
      <ul>
        <li>Use <strong>PascalCase</strong> for classes, methods, and properties.</li>
        <li>Use <strong>camelCase</strong> for variables and parameters.</li>
        <li>Use <strong>_camelCase</strong> for private fields.</li>
        <li>Prefix interfaces with <strong>I</strong> (e.g., <code>IMyService</code>).</li>
        <li>Add XML documentation for all public members.</li>
        <li>Do <strong>NOT</strong> add business logic in UI files. Only navigation logic (such as navigation between views, dialogs, or windows) is allowed.</li>
        <li>Always include navigation event handlers as specified; other events should be empty stubs with <code>TODO</code> comments.</li>
        <li><strong>NEW:</strong> All services must implement Result&lt;T&gt; pattern for consistent error handling.</li>
        <li><strong>CRITICAL:</strong> All services must use <code>services.AddMTMServices(configuration)</code> for proper dependency injection.</li>
      </ul>
    </details>
    
    <details>
      <summary><span class="icon icon-chevron">&#9654;</span>ReactiveUI Patterns (Required)</summary>
      <ul>
        <li>All ViewModels must inherit from <code>ReactiveObject</code></li>
        <li>Use <code>RaiseAndSetIfChanged</code> for all properties with backing fields</li>
        <li>Implement commands using <code>ReactiveCommand</code> with proper error handling</li>
        <li>Use <code>WhenAnyValue</code> for derived properties and validation logic</li>
        <li>Handle command exceptions using <code>ThrownExceptions.Subscribe()</code></li>
        <li>Use <code>ObservableCollection</code> for collections that change</li>
        <li>Prepare ViewModels for dependency injection with constructor parameters</li>
      </ul>
      <p>Example:</p>
      <pre><code>public class InventoryViewModel : ReactiveObject
{
    private string _partId = string.Empty;
    public string PartId
    {
        get => _partId;
        set => this.RaiseAndSetIfChanged(ref _partId, value);
    }

    public ReactiveCommand&lt;Unit, Unit&gt; SaveCommand { get; }

    public InventoryViewModel(IInventoryService inventoryService)
    {
        SaveCommand = ReactiveCommand.CreateFromTask(SaveAsync);
        SaveCommand.ThrownExceptions.Subscribe(HandleException);
    }
}</code></pre>
    </details>
    
    <details>
      <summary><span class="icon icon-chevron">&#9654;</span>Service Registration Patterns (CRITICAL)</summary>
      <ul>
        <li><strong>ALWAYS Use AddMTMServices:</strong> Never register MTM services individually</li>
        <li><strong>Dependency Chain:</strong> AddMTMServices registers all required dependencies</li>
        <li><strong>ViewModel Registration:</strong> All ViewModels must be registered as Transient</li>
        <li><strong>Service Overrides:</strong> Avalonia-specific services registered AFTER AddMTMServices</li>
        <li><strong>Proper Order:</strong> Configuration → AddMTMServices → Overrides → ViewModels</li>
        <li><strong>Validation:</strong> Test service resolution before production deployment</li>
      </ul>
      <p>Example service registration:</p>
      <pre><code>// ✅ CORRECT: Use comprehensive service registration
services.AddMTMServices(configuration);

// ✅ Override Avalonia-specific services AFTER AddMTMServices
services.AddSingleton&lt;IConfigurationService, ConfigurationService&gt;();

// ✅ Register all ViewModels as Transient
services.AddTransient&lt;InventoryViewModel&gt;();

// ❌ WRONG: Manual registration misses dependencies
services.AddScoped&lt;IInventoryService, InventoryService&gt;(); // Missing IValidationService!</code></pre>
    </details>
    
    <details>
      <summary><span class="icon icon-chevron">&#9654;</span>Database Access Patterns</summary>
      <ul>
        <li><strong>CRITICAL Rule:</strong> All database operations MUST use stored procedures only</li>
        <li><strong>NO Direct SQL:</strong> Zero hard-coded SQL commands allowed in application code</li>
        <li><strong>Standard Pattern:</strong> Use Helper_Database_StoredProcedure.ExecuteDataTableWithStatus()</li>
        <li><strong>Error Handling:</strong> All procedures return standardized status codes</li>
        <li><strong>Parameter Validation:</strong> All inputs validated by stored procedures</li>
        <li><strong>Transaction Management:</strong> Proper START/COMMIT/ROLLBACK in procedures</li>
      </ul>
      <p>Example database access:</p>
      <pre><code>// ✅ CORRECT: Using stored procedure
var result = await Helper_Database_StoredProcedure.ExecuteDataTableWithStatus(
    Model_AppVariables.ConnectionString,
    "inv_inventory_Add_Item_Enhanced",
    new Dictionary&lt;string, object&gt; 
    {
        ["p_PartID"] = partId,
        ["p_OperationID"] = operationId,
        ["p_LocationID"] = locationId,
        ["p_Quantity"] = quantity,
        ["p_UserID"] = userId
    }
);

// ❌ PROHIBITED: Direct SQL
// var query = "SELECT * FROM inventory WHERE part_id = @partId"; // NEVER DO THIS</code></pre>
    </details>
    
    <details>
      <summary><span class="icon icon-chevron">&#9654;</span>MTM Business Logic Rules</summary>
      <ul>
        <li><strong>CRITICAL:</strong> TransactionType determined by USER INTENT, NOT Operation number</li>
        <li><strong>IN:</strong> User is adding stock to inventory (regardless of operation number)</li>
        <li><strong>OUT:</strong> User is removing stock from inventory (regardless of operation number)</li>
        <li><strong>TRANSFER:</strong> User is moving stock between locations (regardless of operation number)</li>
        <li><strong>Operation Numbers:</strong> Workflow step identifiers only ("90", "100", "110")</li>
        <li><strong>Part ID:</strong> Always use string format (e.g., "PART001")</li>
        <li><strong>Quantity:</strong> Integer values for all quantity fields</li>
      </ul>
    </details>
    
    <blockquote class="tip">
      <span class="icon">&#128204;</span>
      For comprehensive patterns, see <a href="../.github/copilot-instructions.md">GitHub Instructions Master File</a>. For UI structure, see <a href="ui-generation.html">UI Generation</a>. For quality verification, use <a href="needs-repair.html">Quality Assurance</a>.
    </blockquote>
  </main>
</body>
</html>